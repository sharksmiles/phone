import t from"tsignaling-wx";import e from"trtc-wx-sdk";import n from"tim-wx-sdk";function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function u(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{u({},"")}catch(t){u=function(t,e,n){return t[e]=n}}function l(t,e,n,i){var a=e&&e.prototype instanceof d?e:d,o=Object.create(a.prototype),s=new R(i||[]);return r(o,"_invoke",{value:D(t,n,s)}),o}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=l;var f={};function d(){}function p(){}function v(){}var g={};u(g,o,(function(){return this}));var y=Object.getPrototypeOf,I=y&&y(y(S([])));I&&I!==e&&n.call(I,o)&&(g=I);var m=v.prototype=d.prototype=Object.create(g);function E(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function T(t,e){function i(r,a,o,s){var c=h(t[r],t,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){i("next",t,o,s)}),(function(t){i("throw",t,o,s)})):e.resolve(l).then((function(t){u.value=t,o(u)}),(function(t){return i("throw",t,o,s)}))}s(c.arg)}var a;r(this,"_invoke",{value:function(t,n){function r(){return new e((function(e,r){i(t,n,e,r)}))}return a=a?a.then(r,r):r()}})}function D(t,e,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return w()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=h(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function b(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,b(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),f;var i=h(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,f;var a=i.arg;return a?a.done?(e[t.resultName]=a.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,f)}function _(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(_,this),this.reset(!0)}function S(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:w}}function w(){return{value:void 0,done:!0}}return p.prototype=v,r(m,"constructor",{value:v,configurable:!0}),r(v,"constructor",{value:p,configurable:!0}),p.displayName=u(v,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,c,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},E(T.prototype),u(T.prototype,s,(function(){return this})),t.AsyncIterator=T,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new T(l(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},E(m),u(m,c,"Generator"),u(m,o,(function(){return this})),u(m,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=S,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:S(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function s(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(r,i)}function c(t){return function(){var e=this,n=arguments;return new Promise((function(r,i){var a=t.apply(e,n);function o(t){s(a,r,i,o,c,"next",t)}function c(t){s(a,r,i,o,c,"throw",t)}o(void 0)}))}}function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_(r.key),r)}}function h(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return(e=_(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function d(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&v(t,e)}function p(t){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},p(t)}function v(t,e){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},v(t,e)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function y(t,e,n){return y=g()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&v(i,n.prototype),i},y.apply(null,arguments)}function I(t){var e="function"==typeof Map?new Map:void 0;return I=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return y(t,arguments,p(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),v(r,t)},I(t)}function m(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++)n=a[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}function E(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function T(t){var e=g();return function(){var n,r=p(t);if(e){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return E(t)}(this,n)}}function D(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function _(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}function C(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,S(t,e,"get"))}function R(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,S(t,e,"set"),n),n}function S(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function w(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O=function(t){return t&&t.Math==Math&&t},k=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||x||Function("return this")(),A={},L=function(t){try{return!!t()}catch(t){return!0}},N=!L((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),U=!L((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=U,P=Function.prototype.call,j=M?P.bind(P):function(){return P.apply(P,arguments)},V={},G={}.propertyIsEnumerable,H=Object.getOwnPropertyDescriptor,F=H&&!G.call({1:2},1);V.f=F?function(t){var e=H(this,t);return!!e&&e.enumerable}:G;var K,B,z=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},$=U,J=Function.prototype,Y=J.call,q=$&&J.bind.bind(Y,Y),W=$?q:function(t){return function(){return Y.apply(t,arguments)}},X=W,Q=X({}.toString),Z=X("".slice),tt=function(t){return Z(Q(t),8,-1)},et=L,nt=tt,rt=Object,it=W("".split),at=et((function(){return!rt("z").propertyIsEnumerable(0)}))?function(t){return"String"==nt(t)?it(t,""):rt(t)}:rt,ot=function(t){return null==t},st=ot,ct=TypeError,ut=function(t){if(st(t))throw ct("Can't call method on "+t);return t},lt=at,ht=ut,ft=function(t){return lt(ht(t))},dt="object"==typeof document&&document.all,pt={all:dt,IS_HTMLDDA:void 0===dt&&void 0!==dt},vt=pt.all,gt=pt.IS_HTMLDDA?function(t){return"function"==typeof t||t===vt}:function(t){return"function"==typeof t},yt=gt,It=pt.all,mt=pt.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:yt(t)||t===It}:function(t){return"object"==typeof t?null!==t:yt(t)},Et=k,Tt=gt,Dt=function(t,e){return arguments.length<2?(n=Et[t],Tt(n)?n:void 0):Et[t]&&Et[t][e];var n},bt=W({}.isPrototypeOf),_t="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Ct=k,Rt=_t,St=Ct.process,wt=Ct.Deno,xt=St&&St.versions||wt&&wt.version,Ot=xt&&xt.v8;Ot&&(B=(K=Ot.split("."))[0]>0&&K[0]<4?1:+(K[0]+K[1])),!B&&Rt&&(!(K=Rt.match(/Edge\/(\d+)/))||K[1]>=74)&&(K=Rt.match(/Chrome\/(\d+)/))&&(B=+K[1]);var kt=B,At=kt,Lt=L,Nt=k.String,Ut=!!Object.getOwnPropertySymbols&&!Lt((function(){var t=Symbol();return!Nt(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&At&&At<41})),Mt=Ut&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Pt=Dt,jt=gt,Vt=bt,Gt=Object,Ht=Mt?function(t){return"symbol"==typeof t}:function(t){var e=Pt("Symbol");return jt(e)&&Vt(e.prototype,Gt(t))},Ft=String,Kt=function(t){try{return Ft(t)}catch(t){return"Object"}},Bt=gt,zt=Kt,$t=TypeError,Jt=function(t){if(Bt(t))return t;throw $t(zt(t)+" is not a function")},Yt=Jt,qt=ot,Wt=function(t,e){var n=t[e];return qt(n)?void 0:Yt(n)},Xt=j,Qt=gt,Zt=mt,te=TypeError,ee={exports:{}},ne=k,re=Object.defineProperty,ie=function(t,e){try{re(ne,t,{value:e,configurable:!0,writable:!0})}catch(n){ne[t]=e}return e},ae=ie,oe="__core-js_shared__",se=k[oe]||ae(oe,{}),ce=se;(ee.exports=function(t,e){return ce[t]||(ce[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"});var ue=ut,le=Object,he=function(t){return le(ue(t))},fe=he,de=W({}.hasOwnProperty),pe=Object.hasOwn||function(t,e){return de(fe(t),e)},ve=W,ge=0,ye=Math.random(),Ie=ve(1..toString),me=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Ie(++ge+ye,36)},Ee=k,Te=ee.exports,De=pe,be=me,_e=Ut,Ce=Mt,Re=Ee.Symbol,Se=Te("wks"),we=Ce?Re.for||Re:Re&&Re.withoutSetter||be,xe=function(t){return De(Se,t)||(Se[t]=_e&&De(Re,t)?Re[t]:we("Symbol."+t)),Se[t]},Oe=j,ke=mt,Ae=Ht,Le=Wt,Ne=function(t,e){var n,r;if("string"===e&&Qt(n=t.toString)&&!Zt(r=Xt(n,t)))return r;if(Qt(n=t.valueOf)&&!Zt(r=Xt(n,t)))return r;if("string"!==e&&Qt(n=t.toString)&&!Zt(r=Xt(n,t)))return r;throw te("Can't convert object to primitive value")},Ue=TypeError,Me=xe("toPrimitive"),Pe=function(t,e){if(!ke(t)||Ae(t))return t;var n,r=Le(t,Me);if(r){if(void 0===e&&(e="default"),n=Oe(r,t,e),!ke(n)||Ae(n))return n;throw Ue("Can't convert object to primitive value")}return void 0===e&&(e="number"),Ne(t,e)},je=Pe,Ve=Ht,Ge=function(t){var e=je(t,"string");return Ve(e)?e:e+""},He=mt,Fe=k.document,Ke=He(Fe)&&He(Fe.createElement),Be=function(t){return Ke?Fe.createElement(t):{}},ze=Be,$e=!N&&!L((function(){return 7!=Object.defineProperty(ze("div"),"a",{get:function(){return 7}}).a})),Je=N,Ye=j,qe=V,We=z,Xe=ft,Qe=Ge,Ze=pe,tn=$e,en=Object.getOwnPropertyDescriptor;A.f=Je?en:function(t,e){if(t=Xe(t),e=Qe(e),tn)try{return en(t,e)}catch(t){}if(Ze(t,e))return We(!Ye(qe.f,t,e),t[e])};var nn={},rn=N&&L((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),an=mt,on=String,sn=TypeError,cn=function(t){if(an(t))return t;throw sn(on(t)+" is not an object")},un=N,ln=$e,hn=rn,fn=cn,dn=Ge,pn=TypeError,vn=Object.defineProperty,gn=Object.getOwnPropertyDescriptor,yn="enumerable",In="configurable",mn="writable";nn.f=un?hn?function(t,e,n){if(fn(t),e=dn(e),fn(n),"function"==typeof t&&"prototype"===e&&"value"in n&&mn in n&&!n[mn]){var r=gn(t,e);r&&r[mn]&&(t[e]=n.value,n={configurable:In in n?n[In]:r[In],enumerable:yn in n?n[yn]:r[yn],writable:!1})}return vn(t,e,n)}:vn:function(t,e,n){if(fn(t),e=dn(e),fn(n),ln)try{return vn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw pn("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var En=nn,Tn=z,Dn=N?function(t,e,n){return En.f(t,e,Tn(1,n))}:function(t,e,n){return t[e]=n,t},bn={exports:{}},_n=N,Cn=pe,Rn=Function.prototype,Sn=_n&&Object.getOwnPropertyDescriptor,wn=Cn(Rn,"name"),xn={EXISTS:wn,PROPER:wn&&"something"===function(){}.name,CONFIGURABLE:wn&&(!_n||_n&&Sn(Rn,"name").configurable)},On=gt,kn=se,An=W(Function.toString);On(kn.inspectSource)||(kn.inspectSource=function(t){return An(t)});var Ln,Nn,Un,Mn=kn.inspectSource,Pn=gt,jn=k.WeakMap,Vn=Pn(jn)&&/native code/.test(String(jn)),Gn=ee.exports,Hn=me,Fn=Gn("keys"),Kn=function(t){return Fn[t]||(Fn[t]=Hn(t))},Bn={},zn=Vn,$n=k,Jn=mt,Yn=Dn,qn=pe,Wn=se,Xn=Kn,Qn=Bn,Zn="Object already initialized",tr=$n.TypeError,er=$n.WeakMap;if(zn||Wn.state){var nr=Wn.state||(Wn.state=new er);nr.get=nr.get,nr.has=nr.has,nr.set=nr.set,Ln=function(t,e){if(nr.has(t))throw tr(Zn);return e.facade=t,nr.set(t,e),e},Nn=function(t){return nr.get(t)||{}},Un=function(t){return nr.has(t)}}else{var rr=Xn("state");Qn[rr]=!0,Ln=function(t,e){if(qn(t,rr))throw tr(Zn);return e.facade=t,Yn(t,rr,e),e},Nn=function(t){return qn(t,rr)?t[rr]:{}},Un=function(t){return qn(t,rr)}}var ir={set:Ln,get:Nn,has:Un,enforce:function(t){return Un(t)?Nn(t):Ln(t,{})},getterFor:function(t){return function(e){var n;if(!Jn(e)||(n=Nn(e)).type!==t)throw tr("Incompatible receiver, "+t+" required");return n}}},ar=W,or=L,sr=gt,cr=pe,ur=N,lr=xn.CONFIGURABLE,hr=Mn,fr=ir.enforce,dr=ir.get,pr=String,vr=Object.defineProperty,gr=ar("".slice),yr=ar("".replace),Ir=ar([].join),mr=ur&&!or((function(){return 8!==vr((function(){}),"length",{value:8}).length})),Er=String(String).split("String"),Tr=bn.exports=function(t,e,n){"Symbol("===gr(pr(e),0,7)&&(e="["+yr(pr(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!cr(t,"name")||lr&&t.name!==e)&&(ur?vr(t,"name",{value:e,configurable:!0}):t.name=e),mr&&n&&cr(n,"arity")&&t.length!==n.arity&&vr(t,"length",{value:n.arity});try{n&&cr(n,"constructor")&&n.constructor?ur&&vr(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var r=fr(t);return cr(r,"source")||(r.source=Ir(Er,"string"==typeof e?e:"")),t};Function.prototype.toString=Tr((function(){return sr(this)&&dr(this).source||hr(this)}),"toString");var Dr=gt,br=nn,_r=bn.exports,Cr=ie,Rr=function(t,e,n,r){r||(r={});var i=r.enumerable,a=void 0!==r.name?r.name:e;if(Dr(n)&&_r(n,a,r),r.global)i?t[e]=n:Cr(e,n);else{try{r.unsafe?t[e]&&(i=!0):delete t[e]}catch(t){}i?t[e]=n:br.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},Sr={},wr=Math.ceil,xr=Math.floor,Or=Math.trunc||function(t){var e=+t;return(e>0?xr:wr)(e)},kr=function(t){var e=+t;return e!=e||0===e?0:Or(e)},Ar=kr,Lr=Math.max,Nr=Math.min,Ur=function(t,e){var n=Ar(t);return n<0?Lr(n+e,0):Nr(n,e)},Mr=kr,Pr=Math.min,jr=function(t){return t>0?Pr(Mr(t),9007199254740991):0},Vr=jr,Gr=function(t){return Vr(t.length)},Hr=ft,Fr=Ur,Kr=Gr,Br=function(t){return function(e,n,r){var i,a=Hr(e),o=Kr(a),s=Fr(r,o);if(t&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((t||s in a)&&a[s]===n)return t||s||0;return!t&&-1}},zr={includes:Br(!0),indexOf:Br(!1)},$r=pe,Jr=ft,Yr=zr.indexOf,qr=Bn,Wr=W([].push),Xr=function(t,e){var n,r=Jr(t),i=0,a=[];for(n in r)!$r(qr,n)&&$r(r,n)&&Wr(a,n);for(;e.length>i;)$r(r,n=e[i++])&&(~Yr(a,n)||Wr(a,n));return a},Qr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Zr=Xr,ti=Qr.concat("length","prototype");Sr.f=Object.getOwnPropertyNames||function(t){return Zr(t,ti)};var ei={};ei.f=Object.getOwnPropertySymbols;var ni=Dt,ri=Sr,ii=ei,ai=cn,oi=W([].concat),si=ni("Reflect","ownKeys")||function(t){var e=ri.f(ai(t)),n=ii.f;return n?oi(e,n(t)):e},ci=pe,ui=si,li=A,hi=nn,fi=L,di=gt,pi=/#|\.prototype\./,vi=function(t,e){var n=yi[gi(t)];return n==mi||n!=Ii&&(di(e)?fi(e):!!e)},gi=vi.normalize=function(t){return String(t).replace(pi,".").toLowerCase()},yi=vi.data={},Ii=vi.NATIVE="N",mi=vi.POLYFILL="P",Ei=vi,Ti=k,Di=A.f,bi=Dn,_i=Rr,Ci=ie,Ri=function(t,e,n){for(var r=ui(e),i=hi.f,a=li.f,o=0;o<r.length;o++){var s=r[o];ci(t,s)||n&&ci(n,s)||i(t,s,a(e,s))}},Si=Ei,wi=function(t,e){var n,r,i,a,o,s=t.target,c=t.global,u=t.stat;if(n=c?Ti:u?Ti[s]||Ci(s,{}):(Ti[s]||{}).prototype)for(r in e){if(a=e[r],i=t.dontCallGetSet?(o=Di(n,r))&&o.value:n[r],!Si(c?r:s+(u?".":"#")+r,t.forced)&&void 0!==i){if(typeof a==typeof i)continue;Ri(a,i)}(t.sham||i&&i.sham)&&bi(a,"sham",!0),_i(n,r,a,t)}},xi=tt,Oi=Array.isArray||function(t){return"Array"==xi(t)},ki=TypeError,Ai=function(t){if(t>9007199254740991)throw ki("Maximum allowed index exceeded");return t},Li=Ge,Ni=nn,Ui=z,Mi=function(t,e,n){var r=Li(e);r in t?Ni.f(t,r,Ui(0,n)):t[r]=n},Pi={};Pi[xe("toStringTag")]="z";var ji="[object z]"===String(Pi),Vi=ji,Gi=gt,Hi=tt,Fi=xe("toStringTag"),Ki=Object,Bi="Arguments"==Hi(function(){return arguments}()),zi=Vi?Hi:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Ki(t),Fi))?n:Bi?Hi(e):"Object"==(r=Hi(e))&&Gi(e.callee)?"Arguments":r},$i=W,Ji=L,Yi=gt,qi=zi,Wi=Mn,Xi=function(){},Qi=[],Zi=Dt("Reflect","construct"),ta=/^\s*(?:class|function)\b/,ea=$i(ta.exec),na=!ta.exec(Xi),ra=function(t){if(!Yi(t))return!1;try{return Zi(Xi,Qi,t),!0}catch(t){return!1}},ia=function(t){if(!Yi(t))return!1;switch(qi(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return na||!!ea(ta,Wi(t))}catch(t){return!0}};ia.sham=!0;var aa=!Zi||Ji((function(){var t;return ra(ra.call)||!ra(Object)||!ra((function(){t=!0}))||t}))?ia:ra,oa=Oi,sa=aa,ca=mt,ua=xe("species"),la=Array,ha=function(t){var e;return oa(t)&&(e=t.constructor,(sa(e)&&(e===la||oa(e.prototype))||ca(e)&&null===(e=e[ua]))&&(e=void 0)),void 0===e?la:e},fa=function(t,e){return new(ha(t))(0===e?0:e)},da=L,pa=kt,va=xe("species"),ga=function(t){return pa>=51||!da((function(){var e=[];return(e.constructor={})[va]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},ya=wi,Ia=L,ma=Oi,Ea=mt,Ta=he,Da=Gr,ba=Ai,_a=Mi,Ca=fa,Ra=ga,Sa=kt,wa=xe("isConcatSpreadable"),xa=Sa>=51||!Ia((function(){var t=[];return t[wa]=!1,t.concat()[0]!==t})),Oa=function(t){if(!Ea(t))return!1;var e=t[wa];return void 0!==e?!!e:ma(t)};ya({target:"Array",proto:!0,arity:1,forced:!xa||!Ra("concat")},{concat:function(t){var e,n,r,i,a,o=Ta(this),s=Ca(o,0),c=0;for(e=-1,r=arguments.length;e<r;e++)if(Oa(a=-1===e?o:arguments[e]))for(i=Da(a),ba(c+i),n=0;n<i;n++,c++)n in a&&_a(s,c,a[n]);else ba(c+1),_a(s,c++,a);return s.length=c,s}});var ka=tt,Aa=W,La=function(t){if("Function"===ka(t))return Aa(t)},Na=L,Ua=function(t,e){var n=[][t];return!!n&&Na((function(){n.call(null,e||function(){return 1},1)}))},Ma=wi,Pa=zr.indexOf,ja=Ua,Va=La([].indexOf),Ga=!!Va&&1/Va([1],1,-0)<0;Ma({target:"Array",proto:!0,forced:Ga||!ja("indexOf")},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return Ga?Va(this,t,e)||0:Pa(this,t,e)}});var Ha=Jt,Fa=U,Ka=La(La.bind),Ba=function(t,e){return Ha(t),void 0===e?t:Fa?Ka(t,e):function(){return t.apply(e,arguments)}},za=Ba,$a=at,Ja=he,Ya=Gr,qa=fa,Wa=W([].push),Xa=function(t){var e=1==t,n=2==t,r=3==t,i=4==t,a=6==t,o=7==t,s=5==t||a;return function(c,u,l,h){for(var f,d,p=Ja(c),v=$a(p),g=za(u,l),y=Ya(v),I=0,m=h||qa,E=e?m(c,y):n||o?m(c,0):void 0;y>I;I++)if((s||I in v)&&(d=g(f=v[I],I,p),t))if(e)E[I]=d;else if(d)switch(t){case 3:return!0;case 5:return f;case 6:return I;case 2:Wa(E,f)}else switch(t){case 4:return!1;case 7:Wa(E,f)}return a?-1:r||i?i:E}},Qa={forEach:Xa(0),map:Xa(1),filter:Xa(2),some:Xa(3),every:Xa(4),find:Xa(5),findIndex:Xa(6),filterReject:Xa(7)},Za=Qa.filter;wi({target:"Array",proto:!0,forced:!ga("filter")},{filter:function(t){return Za(this,t,arguments.length>1?arguments[1]:void 0)}});var to=zi,eo=ji?{}.toString:function(){return"[object "+to(this)+"]"};ji||Rr(Object.prototype,"toString",eo,{unsafe:!0});var no=W,ro=Rr,io=Date.prototype,ao="Invalid Date",oo="toString",so=no(io[oo]),co=no(io.getTime);String(new Date(NaN))!=ao&&ro(io,oo,(function(){var t=co(this);return t==t?so(this):ao}));var uo=Qa.map;wi({target:"Array",proto:!0,forced:!ga("map")},{map:function(t){return uo(this,t,arguments.length>1?arguments[1]:void 0)}});var lo=wi,ho=Date,fo=W(ho.prototype.getTime);lo({target:"Date",stat:!0},{now:function(){return fo(new ho)}});var po=Xr,vo=Qr,go=Object.keys||function(t){return po(t,vo)},yo=N,Io=W,mo=j,Eo=L,To=go,Do=ei,bo=V,_o=he,Co=at,Ro=Object.assign,So=Object.defineProperty,wo=Io([].concat),xo=!Ro||Eo((function(){if(yo&&1!==Ro({b:1},Ro(So({},"a",{enumerable:!0,get:function(){So(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=Ro({},t)[n]||To(Ro({},e)).join("")!=r}))?function(t,e){for(var n=_o(t),r=arguments.length,i=1,a=Do.f,o=bo.f;r>i;)for(var s,c=Co(arguments[i++]),u=a?wo(To(c),a(c)):To(c),l=u.length,h=0;l>h;)s=u[h++],yo&&!mo(o,c,s)||(n[s]=c[s]);return n}:Ro,Oo=xo;wi({target:"Object",stat:!0,arity:2,forced:Object.assign!==Oo},{assign:Oo});var ko,Ao,Lo,No,Uo="undefined"!=typeof process&&"process"==tt(process),Mo=W,Po=Jt,jo=gt,Vo=String,Go=TypeError,Ho=function(t,e,n){try{return Mo(Po(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(t){}},Fo=cn,Ko=function(t){if("object"==typeof t||jo(t))return t;throw Go("Can't set "+Vo(t)+" as a prototype")},Bo=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Ho(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return Fo(n),Ko(r),e?t(n,r):n.__proto__=r,n}}():void 0),zo=nn.f,$o=pe,Jo=xe("toStringTag"),Yo=function(t,e,n){t&&!n&&(t=t.prototype),t&&!$o(t,Jo)&&zo(t,Jo,{configurable:!0,value:e})},qo=bn.exports,Wo=nn,Xo=function(t,e,n){return n.get&&qo(n.get,e,{getter:!0}),n.set&&qo(n.set,e,{setter:!0}),Wo.f(t,e,n)},Qo=Dt,Zo=Xo,ts=N,es=xe("species"),ns=function(t){var e=Qo(t);ts&&e&&!e[es]&&Zo(e,es,{configurable:!0,get:function(){return this}})},rs=bt,is=TypeError,as=function(t,e){if(rs(e,t))return t;throw is("Incorrect invocation")},os=aa,ss=Kt,cs=TypeError,us=cn,ls=function(t){if(os(t))return t;throw cs(ss(t)+" is not a constructor")},hs=ot,fs=xe("species"),ds=U,ps=Function.prototype,vs=ps.apply,gs=ps.call,ys="object"==typeof Reflect&&Reflect.apply||(ds?gs.bind(vs):function(){return gs.apply(vs,arguments)}),Is=Dt("document","documentElement"),ms=W([].slice),Es=TypeError,Ts=function(t,e){if(t<e)throw Es("Not enough arguments");return t},Ds=/(?:ipad|iphone|ipod).*applewebkit/i.test(_t),bs=k,_s=ys,Cs=Ba,Rs=gt,Ss=pe,ws=L,xs=Is,Os=ms,ks=Be,As=Ts,Ls=Ds,Ns=Uo,Us=bs.setImmediate,Ms=bs.clearImmediate,Ps=bs.process,js=bs.Dispatch,Vs=bs.Function,Gs=bs.MessageChannel,Hs=bs.String,Fs=0,Ks={},Bs="onreadystatechange";ws((function(){ko=bs.location}));var zs=function(t){if(Ss(Ks,t)){var e=Ks[t];delete Ks[t],e()}},$s=function(t){return function(){zs(t)}},Js=function(t){zs(t.data)},Ys=function(t){bs.postMessage(Hs(t),ko.protocol+"//"+ko.host)};Us&&Ms||(Us=function(t){As(arguments.length,1);var e=Rs(t)?t:Vs(t),n=Os(arguments,1);return Ks[++Fs]=function(){_s(e,void 0,n)},Ao(Fs),Fs},Ms=function(t){delete Ks[t]},Ns?Ao=function(t){Ps.nextTick($s(t))}:js&&js.now?Ao=function(t){js.now($s(t))}:Gs&&!Ls?(No=(Lo=new Gs).port2,Lo.port1.onmessage=Js,Ao=Cs(No.postMessage,No)):bs.addEventListener&&Rs(bs.postMessage)&&!bs.importScripts&&ko&&"file:"!==ko.protocol&&!ws(Ys)?(Ao=Ys,bs.addEventListener("message",Js,!1)):Ao=Bs in ks("script")?function(t){xs.appendChild(ks("script"))[Bs]=function(){xs.removeChild(this),zs(t)}}:function(t){setTimeout($s(t),0)});var qs={set:Us,clear:Ms},Ws=function(){this.head=null,this.tail=null};Ws.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var Xs,Qs,Zs,tc,ec,nc=Ws,rc=/ipad|iphone|ipod/i.test(_t)&&"undefined"!=typeof Pebble,ic=/web0s(?!.*chrome)/i.test(_t),ac=k,oc=Ba,sc=A.f,cc=qs.set,uc=nc,lc=Ds,hc=rc,fc=ic,dc=Uo,pc=ac.MutationObserver||ac.WebKitMutationObserver,vc=ac.document,gc=ac.process,yc=ac.Promise,Ic=sc(ac,"queueMicrotask"),mc=Ic&&Ic.value;if(!mc){var Ec=new uc,Tc=function(){var t,e;for(dc&&(t=gc.domain)&&t.exit();e=Ec.get();)try{e()}catch(t){throw Ec.head&&Xs(),t}t&&t.enter()};lc||dc||fc||!pc||!vc?!hc&&yc&&yc.resolve?((tc=yc.resolve(void 0)).constructor=yc,ec=oc(tc.then,tc),Xs=function(){ec(Tc)}):dc?Xs=function(){gc.nextTick(Tc)}:(cc=oc(cc,ac),Xs=function(){cc(Tc)}):(Qs=!0,Zs=vc.createTextNode(""),new pc(Tc).observe(Zs,{characterData:!0}),Xs=function(){Zs.data=Qs=!Qs}),mc=function(t){Ec.head||Xs(),Ec.add(t)}}var Dc=mc,bc=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},_c=k.Promise,Cc="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Rc=!Cc&&!Uo&&"object"==typeof window&&"object"==typeof document,Sc=k,wc=_c,xc=gt,Oc=Ei,kc=Mn,Ac=xe,Lc=Rc,Nc=Cc,Uc=kt;wc&&wc.prototype;var Mc=Ac("species"),Pc=!1,jc=xc(Sc.PromiseRejectionEvent),Vc=Oc("Promise",(function(){var t=kc(wc),e=t!==String(wc);if(!e&&66===Uc)return!0;if(!Uc||Uc<51||!/native code/.test(t)){var n=new wc((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};if((n.constructor={})[Mc]=r,!(Pc=n.then((function(){}))instanceof r))return!0}return!e&&(Lc||Nc)&&!jc})),Gc={CONSTRUCTOR:Vc,REJECTION_EVENT:jc,SUBCLASSING:Pc},Hc={},Fc=Jt,Kc=TypeError,Bc=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw Kc("Bad Promise constructor");e=t,n=r})),this.resolve=Fc(e),this.reject=Fc(n)};Hc.f=function(t){return new Bc(t)};var zc,$c,Jc,Yc=wi,qc=Uo,Wc=k,Xc=j,Qc=Rr,Zc=Bo,tu=Yo,eu=ns,nu=Jt,ru=gt,iu=mt,au=as,ou=function(t,e){var n,r=us(t).constructor;return void 0===r||hs(n=us(r)[fs])?e:ls(n)},su=qs.set,cu=Dc,uu=function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}},lu=bc,hu=nc,fu=ir,du=_c,pu=Hc,vu="Promise",gu=Gc.CONSTRUCTOR,yu=Gc.REJECTION_EVENT,Iu=Gc.SUBCLASSING,mu=fu.getterFor(vu),Eu=fu.set,Tu=du&&du.prototype,Du=du,bu=Tu,_u=Wc.TypeError,Cu=Wc.document,Ru=Wc.process,Su=pu.f,wu=Su,xu=!!(Cu&&Cu.createEvent&&Wc.dispatchEvent),Ou="unhandledrejection",ku=function(t){var e;return!(!iu(t)||!ru(e=t.then))&&e},Au=function(t,e){var n,r,i,a=e.value,o=1==e.state,s=o?t.ok:t.fail,c=t.resolve,u=t.reject,l=t.domain;try{s?(o||(2===e.rejection&&Pu(e),e.rejection=1),!0===s?n=a:(l&&l.enter(),n=s(a),l&&(l.exit(),i=!0)),n===t.promise?u(_u("Promise-chain cycle")):(r=ku(n))?Xc(r,n,c,u):c(n)):u(a)}catch(t){l&&!i&&l.exit(),u(t)}},Lu=function(t,e){t.notified||(t.notified=!0,cu((function(){for(var n,r=t.reactions;n=r.get();)Au(n,t);t.notified=!1,e&&!t.rejection&&Uu(t)})))},Nu=function(t,e,n){var r,i;xu?((r=Cu.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),Wc.dispatchEvent(r)):r={promise:e,reason:n},!yu&&(i=Wc["on"+t])?i(r):t===Ou&&uu("Unhandled promise rejection",n)},Uu=function(t){Xc(su,Wc,(function(){var e,n=t.facade,r=t.value;if(Mu(t)&&(e=lu((function(){qc?Ru.emit("unhandledRejection",r,n):Nu(Ou,n,r)})),t.rejection=qc||Mu(t)?2:1,e.error))throw e.value}))},Mu=function(t){return 1!==t.rejection&&!t.parent},Pu=function(t){Xc(su,Wc,(function(){var e=t.facade;qc?Ru.emit("rejectionHandled",e):Nu("rejectionhandled",e,t.value)}))},ju=function(t,e,n){return function(r){t(e,r,n)}},Vu=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Lu(t,!0))},Gu=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw _u("Promise can't be resolved itself");var r=ku(e);r?cu((function(){var n={done:!1};try{Xc(r,e,ju(Gu,n,t),ju(Vu,n,t))}catch(e){Vu(n,e,t)}})):(t.value=e,t.state=1,Lu(t,!1))}catch(e){Vu({done:!1},e,t)}}};if(gu&&(bu=(Du=function(t){au(this,bu),nu(t),Xc(zc,this);var e=mu(this);try{t(ju(Gu,e),ju(Vu,e))}catch(t){Vu(e,t)}}).prototype,(zc=function(t){Eu(this,{type:vu,done:!1,notified:!1,parent:!1,reactions:new hu,rejection:!1,state:0,value:void 0})}).prototype=Qc(bu,"then",(function(t,e){var n=mu(this),r=Su(ou(this,Du));return n.parent=!0,r.ok=!ru(t)||t,r.fail=ru(e)&&e,r.domain=qc?Ru.domain:void 0,0==n.state?n.reactions.add(r):cu((function(){Au(r,n)})),r.promise})),$c=function(){var t=new zc,e=mu(t);this.promise=t,this.resolve=ju(Gu,e),this.reject=ju(Vu,e)},pu.f=Su=function(t){return t===Du||undefined===t?new $c(t):wu(t)},ru(du)&&Tu!==Object.prototype)){Jc=Tu.then,Iu||Qc(Tu,"then",(function(t,e){var n=this;return new Du((function(t,e){Xc(Jc,n,t,e)})).then(t,e)}),{unsafe:!0});try{delete Tu.constructor}catch(t){}Zc&&Zc(Tu,bu)}Yc({global:!0,constructor:!0,wrap:!0,forced:gu},{Promise:Du}),tu(Du,vu,!1),eu(vu);var Hu={},Fu=Hu,Ku=xe("iterator"),Bu=Array.prototype,zu=function(t){return void 0!==t&&(Fu.Array===t||Bu[Ku]===t)},$u=zi,Ju=Wt,Yu=ot,qu=Hu,Wu=xe("iterator"),Xu=function(t){if(!Yu(t))return Ju(t,Wu)||Ju(t,"@@iterator")||qu[$u(t)]},Qu=j,Zu=Jt,tl=cn,el=Kt,nl=Xu,rl=TypeError,il=function(t,e){var n=arguments.length<2?nl(t):e;if(Zu(n))return tl(Qu(n,t));throw rl(el(t)+" is not iterable")},al=j,ol=cn,sl=Wt,cl=function(t,e,n){var r,i;ol(t);try{if(!(r=sl(t,"return"))){if("throw"===e)throw n;return n}r=al(r,t)}catch(t){i=!0,r=t}if("throw"===e)throw n;if(i)throw r;return ol(r),n},ul=Ba,ll=j,hl=cn,fl=Kt,dl=zu,pl=Gr,vl=bt,gl=il,yl=Xu,Il=cl,ml=TypeError,El=function(t,e){this.stopped=t,this.result=e},Tl=El.prototype,Dl=function(t,e,n){var r,i,a,o,s,c,u,l=n&&n.that,h=!(!n||!n.AS_ENTRIES),f=!(!n||!n.IS_RECORD),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),v=ul(e,l),g=function(t){return r&&Il(r,"normal",t),new El(!0,t)},y=function(t){return h?(hl(t),p?v(t[0],t[1],g):v(t[0],t[1])):p?v(t,g):v(t)};if(f)r=t.iterator;else if(d)r=t;else{if(!(i=yl(t)))throw ml(fl(t)+" is not iterable");if(dl(i)){for(a=0,o=pl(t);o>a;a++)if((s=y(t[a]))&&vl(Tl,s))return s;return new El(!1)}r=gl(t,i)}for(c=f?t.next:r.next;!(u=ll(c,r)).done;){try{s=y(u.value)}catch(t){Il(r,"throw",t)}if("object"==typeof s&&s&&vl(Tl,s))return s}return new El(!1)},bl=xe("iterator"),_l=!1;try{var Cl=0,Rl={next:function(){return{done:!!Cl++}},return:function(){_l=!0}};Rl[bl]=function(){return this},Array.from(Rl,(function(){throw 2}))}catch(t){}var Sl=function(t,e){if(!e&&!_l)return!1;var n=!1;try{var r={};r[bl]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},wl=_c,xl=Gc.CONSTRUCTOR||!Sl((function(t){wl.all(t).then(void 0,(function(){}))})),Ol=j,kl=Jt,Al=Hc,Ll=bc,Nl=Dl;wi({target:"Promise",stat:!0,forced:xl},{all:function(t){var e=this,n=Al.f(e),r=n.resolve,i=n.reject,a=Ll((function(){var n=kl(e.resolve),a=[],o=0,s=1;Nl(t,(function(t){var c=o++,u=!1;s++,Ol(n,e,t).then((function(t){u||(u=!0,a[c]=t,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise}});var Ul=wi,Ml=Gc.CONSTRUCTOR,Pl=_c,jl=Dt,Vl=gt,Gl=Rr,Hl=Pl&&Pl.prototype;if(Ul({target:"Promise",proto:!0,forced:Ml,real:!0},{catch:function(t){return this.then(void 0,t)}}),Vl(Pl)){var Fl=jl("Promise").prototype.catch;Hl.catch!==Fl&&Gl(Hl,"catch",Fl,{unsafe:!0})}var Kl=j,Bl=Jt,zl=Hc,$l=bc,Jl=Dl;wi({target:"Promise",stat:!0,forced:xl},{race:function(t){var e=this,n=zl.f(e),r=n.reject,i=$l((function(){var i=Bl(e.resolve);Jl(t,(function(t){Kl(i,e,t).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Yl=j,ql=Hc;wi({target:"Promise",stat:!0,forced:Gc.CONSTRUCTOR},{reject:function(t){var e=ql.f(this);return Yl(e.reject,void 0,t),e.promise}});var Wl=cn,Xl=mt,Ql=Hc,Zl=wi,th=Gc.CONSTRUCTOR,eh=function(t,e){if(Wl(t),Xl(e)&&e.constructor===t)return e;var n=Ql.f(t);return(0,n.resolve)(e),n.promise};Dt("Promise"),Zl({target:"Promise",stat:!0,forced:th},{resolve:function(t){return eh(this,t)}});var nh="function"==typeof Bun&&Bun&&"string"==typeof Bun.version,rh=k,ih=ys,ah=gt,oh=nh,sh=_t,ch=ms,uh=Ts,lh=rh.Function,hh=/MSIE .\./.test(sh)||oh&&function(){var t=rh.Bun.version.split(".");return t.length<3||0==t[0]&&(t[1]<3||3==t[1]&&0==t[2])}(),fh=function(t,e){var n=e?2:1;return hh?function(r,i){var a=uh(arguments.length,1)>n,o=ah(r)?r:lh(r),s=a?ch(arguments,n):[],c=a?function(){ih(o,this,s)}:o;return e?t(c,i):t(c)}:t},dh=wi,ph=k,vh=fh(ph.setInterval,!0);dh({global:!0,bind:!0,forced:ph.setInterval!==vh},{setInterval:vh});var gh=wi,yh=k,Ih=fh(yh.setTimeout,!0);gh({global:!0,bind:!0,forced:yh.setTimeout!==Ih},{setTimeout:Ih});var mh=zi,Eh=String,Th=function(t){if("Symbol"===mh(t))throw TypeError("Cannot convert a Symbol value to a string");return Eh(t)},Dh=W,bh=kr,_h=Th,Ch=ut,Rh=Dh("".charAt),Sh=Dh("".charCodeAt),wh=Dh("".slice),xh=function(t){return function(e,n){var r,i,a=_h(Ch(e)),o=bh(n),s=a.length;return o<0||o>=s?t?"":void 0:(r=Sh(a,o))<55296||r>56319||o+1===s||(i=Sh(a,o+1))<56320||i>57343?t?Rh(a,o):r:t?wh(a,o,o+2):i-56320+(r-55296<<10)+65536}},Oh={codeAt:xh(!1),charAt:xh(!0)},kh={},Ah=N,Lh=rn,Nh=nn,Uh=cn,Mh=ft,Ph=go;kh.f=Ah&&!Lh?Object.defineProperties:function(t,e){Uh(t);for(var n,r=Mh(e),i=Ph(e),a=i.length,o=0;a>o;)Nh.f(t,n=i[o++],r[n]);return t};var jh,Vh=cn,Gh=kh,Hh=Qr,Fh=Bn,Kh=Is,Bh=Be,zh="prototype",$h="script",Jh=Kn("IE_PROTO"),Yh=function(){},qh=function(t){return"<"+$h+">"+t+"</"+$h+">"},Wh=function(t){t.write(qh("")),t.close();var e=t.parentWindow.Object;return t=null,e},Xh=function(){try{jh=new ActiveXObject("htmlfile")}catch(t){}var t,e,n;Xh="undefined"!=typeof document?document.domain&&jh?Wh(jh):(e=Bh("iframe"),n="java"+$h+":",e.style.display="none",Kh.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(qh("document.F=Object")),t.close(),t.F):Wh(jh);for(var r=Hh.length;r--;)delete Xh[zh][Hh[r]];return Xh()};Fh[Jh]=!0;var Qh,Zh,tf,ef=Object.create||function(t,e){var n;return null!==t?(Yh[zh]=Vh(t),n=new Yh,Yh[zh]=null,n[Jh]=t):n=Xh(),void 0===e?n:Gh.f(n,e)},nf=!L((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),rf=pe,af=gt,of=he,sf=nf,cf=Kn("IE_PROTO"),uf=Object,lf=uf.prototype,hf=sf?uf.getPrototypeOf:function(t){var e=of(t);if(rf(e,cf))return e[cf];var n=e.constructor;return af(n)&&e instanceof n?n.prototype:e instanceof uf?lf:null},ff=L,df=gt,pf=mt,vf=hf,gf=Rr,yf=xe("iterator"),If=!1;[].keys&&("next"in(tf=[].keys())?(Zh=vf(vf(tf)))!==Object.prototype&&(Qh=Zh):If=!0);var mf=!pf(Qh)||ff((function(){var t={};return Qh[yf].call(t)!==t}));mf&&(Qh={}),df(Qh[yf])||gf(Qh,yf,(function(){return this}));var Ef={IteratorPrototype:Qh,BUGGY_SAFARI_ITERATORS:If},Tf=Ef.IteratorPrototype,Df=ef,bf=z,_f=Yo,Cf=Hu,Rf=function(){return this},Sf=wi,wf=j,xf=gt,Of=function(t,e,n,r){var i=e+" Iterator";return t.prototype=Df(Tf,{next:bf(+!r,n)}),_f(t,i,!1),Cf[i]=Rf,t},kf=hf,Af=Bo,Lf=Yo,Nf=Dn,Uf=Rr,Mf=Hu,Pf=xn.PROPER,jf=xn.CONFIGURABLE,Vf=Ef.IteratorPrototype,Gf=Ef.BUGGY_SAFARI_ITERATORS,Hf=xe("iterator"),Ff="keys",Kf="values",Bf="entries",zf=function(){return this},$f=function(t,e,n,r,i,a,o){Of(n,e,r);var s,c,u,l=function(t){if(t===i&&v)return v;if(!Gf&&t in d)return d[t];switch(t){case Ff:case Kf:case Bf:return function(){return new n(this,t)}}return function(){return new n(this)}},h=e+" Iterator",f=!1,d=t.prototype,p=d[Hf]||d["@@iterator"]||i&&d[i],v=!Gf&&p||l(i),g="Array"==e&&d.entries||p;if(g&&(s=kf(g.call(new t)))!==Object.prototype&&s.next&&(kf(s)!==Vf&&(Af?Af(s,Vf):xf(s[Hf])||Uf(s,Hf,zf)),Lf(s,h,!0)),Pf&&i==Kf&&p&&p.name!==Kf&&(jf?Nf(d,"name",Kf):(f=!0,v=function(){return wf(p,this)})),i)if(c={values:l(Kf),keys:a?v:l(Ff),entries:l(Bf)},o)for(u in c)(Gf||f||!(u in d))&&Uf(d,u,c[u]);else Sf({target:e,proto:!0,forced:Gf||f},c);return d[Hf]!==v&&Uf(d,Hf,v,{name:i}),Mf[e]=v,c},Jf=function(t,e){return{value:t,done:e}},Yf=Oh.charAt,qf=Th,Wf=ir,Xf=$f,Qf=Jf,Zf="String Iterator",td=Wf.set,ed=Wf.getterFor(Zf);Xf(String,"String",(function(t){td(this,{type:Zf,string:qf(t),index:0})}),(function(){var t,e=ed(this),n=e.string,r=e.index;return r>=n.length?Qf(void 0,!0):(t=Yf(n,r),e.index+=t.length,Qf(t,!1))}));var nd=xe,rd=ef,id=nn.f,ad=nd("unscopables"),od=Array.prototype;null==od[ad]&&id(od,ad,{configurable:!0,value:rd(null)});var sd=function(t){od[ad][t]=!0},cd=ft,ud=sd,ld=Hu,hd=ir,fd=nn.f,dd=$f,pd=Jf,vd=N,gd="Array Iterator",yd=hd.set,Id=hd.getterFor(gd),md=dd(Array,"Array",(function(t,e){yd(this,{type:gd,target:cd(t),index:0,kind:e})}),(function(){var t=Id(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,pd(void 0,!0)):pd("keys"==n?r:"values"==n?e[r]:[r,e[r]],!1)}),"values"),Ed=ld.Arguments=ld.Array;if(ud("keys"),ud("values"),ud("entries"),vd&&"values"!==Ed.name)try{fd(Ed,"name",{value:"values"})}catch(t){}var Td={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Dd=Be("span").classList,bd=Dd&&Dd.constructor&&Dd.constructor.prototype,_d=bd===Object.prototype?void 0:bd,Cd=k,Rd=Td,Sd=_d,wd=md,xd=Dn,Od=xe,kd=Od("iterator"),Ad=Od("toStringTag"),Ld=wd.values,Nd=function(t,e){if(t){if(t[kd]!==Ld)try{xd(t,kd,Ld)}catch(e){t[kd]=Ld}if(t[Ad]||xd(t,Ad,e),Rd[e])for(var n in wd)if(t[n]!==wd[n])try{xd(t,n,wd[n])}catch(e){t[n]=wd[n]}}};for(var Ud in Rd)Nd(Cd[Ud]&&Cd[Ud].prototype,Ud);Nd(Sd,"DOMTokenList");var Md=wi,Pd=Oi,jd=aa,Vd=mt,Gd=Ur,Hd=Gr,Fd=ft,Kd=Mi,Bd=xe,zd=ms,$d=ga("slice"),Jd=Bd("species"),Yd=Array,qd=Math.max;Md({target:"Array",proto:!0,forced:!$d},{slice:function(t,e){var n,r,i,a=Fd(this),o=Hd(a),s=Gd(t,o),c=Gd(void 0===e?o:e,o);if(Pd(a)&&(n=a.constructor,(jd(n)&&(n===Yd||Pd(n.prototype))||Vd(n)&&null===(n=n[Jd]))&&(n=void 0),n===Yd||void 0===n))return zd(a,s,c);for(r=new(void 0===n?Yd:n)(qd(c-s,0)),i=0;s<c;s++,i++)s in a&&Kd(r,i,a[s]);return r.length=i,r}});var Wd=Qa.forEach,Xd=Ua("forEach")?[].forEach:function(t){return Wd(this,t,arguments.length>1?arguments[1]:void 0)};wi({target:"Array",proto:!0,forced:[].forEach!=Xd},{forEach:Xd});var Qd=k,Zd=Td,tp=_d,ep=Xd,np=Dn,rp=function(t){if(t&&t.forEach!==ep)try{np(t,"forEach",ep)}catch(e){t.forEach=ep}};for(var ip in Zd)Zd[ip]&&rp(Qd[ip]&&Qd[ip].prototype);rp(tp);var ap=he,op=go;wi({target:"Object",stat:!0,forced:L((function(){op(1)}))},{keys:function(t){return op(ap(t))}});var sp=cn,cp=cl,up=Ba,lp=j,hp=he,fp=function(t,e,n,r){try{return r?e(sp(n)[0],n[1]):e(n)}catch(e){cp(t,"throw",e)}},dp=zu,pp=aa,vp=Gr,gp=Mi,yp=il,Ip=Xu,mp=Array,Ep=function(t){var e=hp(t),n=pp(this),r=arguments.length,i=r>1?arguments[1]:void 0,a=void 0!==i;a&&(i=up(i,r>2?arguments[2]:void 0));var o,s,c,u,l,h,f=Ip(e),d=0;if(!f||this===mp&&dp(f))for(o=vp(e),s=n?new this(o):mp(o);o>d;d++)h=a?i(e[d],d):e[d],gp(s,d,h);else for(l=(u=yp(e,f)).next,s=n?new this:[];!(c=lp(l,u)).done;d++)h=a?fp(u,i,[c.value,d],!0):c.value,gp(s,d,h);return s.length=d,s};wi({target:"Array",stat:!0,forced:!Sl((function(t){Array.from(t)}))},{from:Ep});var Tp={exports:{}},Dp={},bp=Ur,_p=Gr,Cp=Mi,Rp=Array,Sp=Math.max,wp=tt,xp=ft,Op=Sr.f,kp=function(t,e,n){for(var r=_p(t),i=bp(e,r),a=bp(void 0===n?r:n,r),o=Rp(Sp(a-i,0)),s=0;i<a;i++,s++)Cp(o,s,t[i]);return o.length=s,o},Ap="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Dp.f=function(t){return Ap&&"Window"==wp(t)?function(t){try{return Op(t)}catch(t){return kp(Ap)}}(t):Op(xp(t))};var Lp=L((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),Np=L,Up=mt,Mp=tt,Pp=Lp,jp=Object.isExtensible,Vp=Np((function(){jp(1)}))||Pp?function(t){return!!Up(t)&&((!Pp||"ArrayBuffer"!=Mp(t))&&(!jp||jp(t)))}:jp,Gp=!L((function(){return Object.isExtensible(Object.preventExtensions({}))})),Hp=wi,Fp=W,Kp=Bn,Bp=mt,zp=pe,$p=nn.f,Jp=Sr,Yp=Dp,qp=Vp,Wp=Gp,Xp=!1,Qp=me("meta"),Zp=0,tv=function(t){$p(t,Qp,{value:{objectID:"O"+Zp++,weakData:{}}})},ev=Tp.exports={enable:function(){ev.enable=function(){},Xp=!0;var t=Jp.f,e=Fp([].splice),n={};n[Qp]=1,t(n).length&&(Jp.f=function(n){for(var r=t(n),i=0,a=r.length;i<a;i++)if(r[i]===Qp){e(r,i,1);break}return r},Hp({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:Yp.f}))},fastKey:function(t,e){if(!Bp(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!zp(t,Qp)){if(!qp(t))return"F";if(!e)return"E";tv(t)}return t[Qp].objectID},getWeakData:function(t,e){if(!zp(t,Qp)){if(!qp(t))return!0;if(!e)return!1;tv(t)}return t[Qp].weakData},onFreeze:function(t){return Wp&&Xp&&qp(t)&&!zp(t,Qp)&&tv(t),t}};Kp[Qp]=!0;var nv=gt,rv=mt,iv=Bo,av=function(t,e,n){var r,i;return iv&&nv(r=e.constructor)&&r!==n&&rv(i=r.prototype)&&i!==n.prototype&&iv(t,i),t},ov=wi,sv=k,cv=W,uv=Ei,lv=Rr,hv=Tp.exports,fv=Dl,dv=as,pv=gt,vv=ot,gv=mt,yv=L,Iv=Sl,mv=Yo,Ev=av,Tv=function(t,e,n){var r=-1!==t.indexOf("Map"),i=-1!==t.indexOf("Weak"),a=r?"set":"add",o=sv[t],s=o&&o.prototype,c=o,u={},l=function(t){var e=cv(s[t]);lv(s,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(i&&!gv(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return i&&!gv(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(i&&!gv(t))&&e(this,0===t?0:t)}:function(t,n){return e(this,0===t?0:t,n),this})};if(uv(t,!pv(o)||!(i||s.forEach&&!yv((function(){(new o).entries().next()})))))c=n.getConstructor(e,t,r,a),hv.enable();else if(uv(t,!0)){var h=new c,f=h[a](i?{}:-0,1)!=h,d=yv((function(){h.has(1)})),p=Iv((function(t){new o(t)})),v=!i&&yv((function(){for(var t=new o,e=5;e--;)t[a](e,e);return!t.has(-0)}));p||((c=e((function(t,e){dv(t,s);var n=Ev(new o,t,c);return vv(e)||fv(e,n[a],{that:n,AS_ENTRIES:r}),n}))).prototype=s,s.constructor=c),(d||v)&&(l("delete"),l("has"),r&&l("get")),(v||f)&&l(a),i&&s.clear&&delete s.clear}return u[t]=c,ov({global:!0,constructor:!0,forced:c!=o},u),mv(c,t),i||n.setStrong(c,t,r),c},Dv=Rr,bv=function(t,e,n){for(var r in e)Dv(t,r,e[r],n);return t},_v=ef,Cv=Xo,Rv=bv,Sv=Ba,wv=as,xv=ot,Ov=Dl,kv=$f,Av=Jf,Lv=ns,Nv=N,Uv=Tp.exports.fastKey,Mv=ir.set,Pv=ir.getterFor,jv={getConstructor:function(t,e,n,r){var i=t((function(t,i){wv(t,a),Mv(t,{type:e,index:_v(null),first:void 0,last:void 0,size:0}),Nv||(t.size=0),xv(i)||Ov(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=Pv(e),s=function(t,e,n){var r,i,a=o(t),s=c(t,e);return s?s.value=n:(a.last=s={index:i=Uv(e,!0),key:e,value:n,previous:r=a.last,next:void 0,removed:!1},a.first||(a.first=s),r&&(r.next=s),Nv?a.size++:t.size++,"F"!==i&&(a.index[i]=s)),t},c=function(t,e){var n,r=o(t),i=Uv(e);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==e)return n};return Rv(a,{clear:function(){for(var t=o(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,Nv?t.size=0:this.size=0},delete:function(t){var e=this,n=o(e),r=c(e,t);if(r){var i=r.next,a=r.previous;delete n.index[r.index],r.removed=!0,a&&(a.next=i),i&&(i.previous=a),n.first==r&&(n.first=i),n.last==r&&(n.last=a),Nv?n.size--:e.size--}return!!r},forEach:function(t){for(var e,n=o(this),r=Sv(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!c(this,t)}}),Rv(a,n?{get:function(t){var e=c(this,t);return e&&e.value},set:function(t,e){return s(this,0===t?0:t,e)}}:{add:function(t){return s(this,t=0===t?0:t,t)}}),Nv&&Cv(a,"size",{configurable:!0,get:function(){return o(this).size}}),i},setStrong:function(t,e,n){var r=e+" Iterator",i=Pv(e),a=Pv(r);kv(t,e,(function(t,e){Mv(this,{type:r,target:t,state:i(t),kind:e,last:void 0})}),(function(){for(var t=a(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?Av("keys"==e?n.key:"values"==e?n.value:[n.key,n.value],!1):(t.target=void 0,Av(void 0,!0))}),n?"entries":"values",!n,!0),Lv(e)}};Tv("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),jv);var Vv=N,Gv=Oi,Hv=TypeError,Fv=Object.getOwnPropertyDescriptor,Kv=Vv&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(Gv(t)&&!Fv(t,"length").writable)throw Hv("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},Bv=Kt,zv=TypeError,$v=wi,Jv=he,Yv=Ur,qv=kr,Wv=Gr,Xv=Kv,Qv=Ai,Zv=fa,tg=Mi,eg=function(t,e){if(!delete t[e])throw zv("Cannot delete property "+Bv(e)+" of "+Bv(t))},ng=ga("splice"),rg=Math.max,ig=Math.min;$v({target:"Array",proto:!0,forced:!ng},{splice:function(t,e){var n,r,i,a,o,s,c=Jv(this),u=Wv(c),l=Yv(t,u),h=arguments.length;for(0===h?n=r=0:1===h?(n=0,r=u-l):(n=h-2,r=ig(rg(qv(e),0),u-l)),Qv(u+n-r),i=Zv(c,r),a=0;a<r;a++)(o=l+a)in c&&tg(i,a,c[o]);if(i.length=r,n<r){for(a=l;a<u-r;a++)s=a+n,(o=a+r)in c?c[s]=c[o]:eg(c,s);for(a=u;a>u-r+n;a--)eg(c,a-1)}else if(n>r)for(a=u-r;a>l;a--)s=a+n-1,(o=a+r-1)in c?c[s]=c[o]:eg(c,s);for(a=0;a<n;a++)c[a+l]=arguments[a+2];return Xv(c,u-r+n),i}});var ag=function(){function t(){u(this,t)}return h(t,[{key:"on",value:function(t,e,n){"function"==typeof e?(this._stores=this._stores||{},(this._stores[t]=this._stores[t]||[]).push({cb:e,ctx:n})):console.error("listener must be a function")}},{key:"emit",value:function(t){this._stores=this._stores||{};var e,n=this._stores[t];if(n){n=n.slice(0),(e=[].slice.call(arguments,1))[0]={eventCode:t,data:e[0]};for(var r=0,i=n.length;r<i;r++)n[r].cb.apply(n[r].ctx,e)}}},{key:"off",value:function(t,e){if(this._stores=this._stores||{},arguments.length){var n=this._stores[t];if(n)if(1!==arguments.length){for(var r=0,i=n.length;r<i;r++)if(n[r].cb===e){n.splice(r,1);break}}else delete this._stores[t]}else this._stores={}}}]),t}(),og={INVITED:"INVITED",GROUP_CALL_INVITEE_LIST_UPDATE:"GROUP_CALL_INVITEE_LIST_UPDATE",USER_ENTER:"USER_ENTER",USER_LEAVE:"USER_LEAVE",USER_ACCEPT:"USER_ACCEPT",USER_UPDATE:"USER_UPDATE",REJECT:"REJECT",NO_RESP:"NO_RESP",LINE_BUSY:"LINE_BUSY",CALLING_CANCEL:"CALLING_CANCEL",CALLING_TIMEOUT:"CALLING_TIMEOUT",CALL_END:"CALL_END",USER_VIDEO_AVAILABLE:"USER_VIDEO_AVAILABLE",USER_AUDIO_AVAILABLE:"USER_AUDIO_AVAILABLE",USER_VOICE_VOLUME:"USER_VOICE_VOLUME",SDK_READY:"SDK_READY",KICKED_OUT:"KICKED_OUT",CALL_MODE:"CALL_MODE",HANG_UP:"HANG_UP",MESSAGE_SENT_BY_ME:"onMessageSentByMe",ERROR:"ERROR"},sg={IDLE:"idle",CALLING:"calling",CONNECTED:"connected"},cg=1,ug=2,lg=3,hg=4,fg=5,dg=1,pg={AUDIO:1,VIDEO:2},vg="",gg="inviter",yg="invitee",Ig=0,mg=1,Eg=2,Tg=["","audioCall","videoCall"],Dg="audio",bg="video",_g={EAR:"ear",SPEAKER:"speaker"},Cg={BASE:Math.pow(2,16),PRO:Math.pow(2,17),ULTIMATE:Math.pow(2,18)},Rg=2147483647,Sg="video",wg="audio",xg="normal",Og="reject",kg="timeout",Ag="cancel",Lg="busyline",Ng="unknown",Ug="SingleCall",Mg="groupCall",Pg="caller",jg="callee",Vg="devtools",Gg="av_call",Hg={MIC_TITLE:"麦克风权限授权",MIC_CONTENT:"使用语音通话，需要在设置中对麦克风进行授权允许",CAMERA_TITLE:"麦克风、摄像头权限授权",CAMERA_CONTENT:"使用视频通话，需要在设置中对麦克风、摄像头进行授权允许",CONFIRM_TEXT:"去设置"},Fg="微信开发者工具不支持原生推拉流组件(即 <live-pusher> 和 <live-player> 标签)，请使用真机调试或者扫码预览。",Kg={RECORD:"scope.record",CAMERA:"scope.camera"},Bg="\t\n\v\f\r                　\u2028\u2029\ufeff",zg=ut,$g=Th,Jg=Bg,Yg=W("".replace),qg=RegExp("^["+Jg+"]+"),Wg=RegExp("(^|[^"+Jg+"])["+Jg+"]+$"),Xg=function(t){return function(e){var n=$g(zg(e));return 1&t&&(n=Yg(n,qg,"")),2&t&&(n=Yg(n,Wg,"$1")),n}},Qg={start:Xg(1),end:Xg(2),trim:Xg(3)},Zg=k,ty=L,ey=W,ny=Th,ry=Qg.trim,iy=Bg,ay=Zg.parseInt,oy=Zg.Symbol,sy=oy&&oy.iterator,cy=/^[+-]?0x/i,uy=ey(cy.exec),ly=8!==ay(iy+"08")||22!==ay(iy+"0x16")||sy&&!ty((function(){ay(Object(sy))}))?function(t,e){var n=ry(ny(t));return ay(n,e>>>0||(uy(cy,n)?16:10))}:ay;function hy(t){var e=new Date(t);return"".concat(e.getFullYear(),"-")+"".concat(e.getMonth()+1<10?"0".concat(e.getMonth()+1):e.getMonth()+1,"-")+fy(e.getDate()," ")+fy(e.getHours(),":")+fy(e.getMinutes(),":")+fy(e.getSeconds(),"")}function fy(t,e){return"".concat(t<10?"0".concat(t).concat(e):"".concat(t).concat(e))}wi({global:!0,forced:parseInt!=ly},{parseInt:ly});var dy=N,py=xn.EXISTS,vy=W,gy=Xo,yy=Function.prototype,Iy=vy(yy.toString),my=/function\b(?:\s|\/\*[\S\s]*?\*\/|\/\/[^\n\r]*[\n\r]+)*([^\s(/]*)/,Ey=vy(my.exec);dy&&!py&&gy(yy,"name",{configurable:!0,get:function(){try{return Ey(my,Iy(this))[1]}catch(t){return""}}});var Ty={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:20003},Dy="未连接到网络",by='The package you purchased does not support this ability. You can refer to "Service Activation" to purchase: https://buy.cloud.tencent.com/avc',_y="TIM SDK version is too old. Please upgrade version",Cy="init is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",Ry="The API is support use in the state of. Please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",Sy={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无帐户类型",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",NOT_MICROPHONE_LIST:"没有麦克风权限",NOT_CAMERA_LIST:"没有摄像头权限",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您目前没有 TUICallKit 包，请在控制台开启免费体验或购买官方包",ERROR_PACKAGE_NOT_SUPPORTED:"您购买的套餐不支持该功能。可参考“服务开通”购买: https://buy.cloud.tencent.com/avc",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧，请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝。解决方案请前往: https://cloud.tencent.com/document/product/647/78770",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine init 未完成，需要在 init 完成后使用此 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"inviteID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送方或接收方 UserID 无效或不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误"},wy=function(t){d(n,I(Error));var e=T(n);function n(t){var r,i=t.message,a=t.code,o=void 0===a?Ty.UNKNOWN:a;return u(this,n),r=e.call(this,"".concat(i).concat(function(t){for(var e=0,n=Object.keys(Sy);e<n.length;e++){var r=n[e];if(Ty[r]===t)return Sy[r]}return"UNKNOWN"}(o))+" <".concat(function(t){for(var e=0,n=Object.keys(Ty);e<n.length;e++){var r=n[e];if(Ty[r]===t)return r}return"UNKNOWN"}(o),": ").concat(o,">")),r.code=o,r.name="TUICallEngineError",r.message_=i,r}return h(n,[{key:"getCode",value:function(){return this.code}}]),n}(),xy=["inviteID","type"],Oy=function(){function t(e){u(this,t),this.TSignaling=e.TSignaling}var e,n,r,o,s,l,f;return h(t,[{key:"handleNewSignaling",value:function(t,e){return i(i({extInfo:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")||""},t),{},{version:4,businessID:"av_call",platform:"MiniApp",data:i({cmd:Tg[t.call_type],room_id:t.room_id,message:""},e)})}},{key:"extractCallingInfoFromMessage",value:function(t){if(!t||"TIMCustomElem"!==t.type)return"";var e=JSON.parse(t.payload.data);if(e.businessID!==dg)return"";switch(e.actionType){case cg:var n=JSON.parse(e.data);return n.call_end>0&&!e.groupID?n.call_end:0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case ug:return"取消通话";case lg:return"已接听";case hg:return"拒绝通话";case fg:return"无应答";default:return""}}},{key:"handleError",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.code,n=void 0===e?"":e,r=t.message;if(n)throw new wy({message:void 0===r?"":r,code:n})}},{key:"_handleInviteData",value:function(t){var e=t.type,n=t.roomID,r=t.userIDList,i=t.hangup,a=t.switchMode,o=t.userData;if(i)return JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:i.callEnd},{cmd:"hangup"}));if(a){var s={version:0,call_type:e,room_id:n},c={cmd:"switchToVideo"};return a===Dg&&(s.switch_to_audio_call="switch_to_audio_call",c.cmd="switchToAudio"),JSON.stringify(this.handleNewSignaling(s,c))}return JSON.stringify(this.handleNewSignaling({version:0,call_type:e,room_id:n},{userIDs:r},o))}},{key:"_handleInviteGroupData",value:function(t){var e=t.type,n=t.roomID,r=t.hangup,i=t.userData;return r?JSON.stringify(this.handleNewSignaling({version:0,call_type:e,call_end:r.call_end},{cmd:"hangup"},i)):JSON.stringify(this.handleNewSignaling({version:0,call_type:e,room_id:n}))}},{key:"invite",value:(f=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.offlinePushInfo,i=e.hangup,o=e.switchMode,t.prev=1,t.next=4,this.TSignaling.invite({userID:n,data:this._handleInviteData(e),timeout:i?0:30,offlinePushInfo:r});case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),!i){t.next=11;break}return t.abrupt("return",this.handleError(t.t0,"hangup C2C"));case 11:if(!o){t.next=13;break}return t.abrupt("return",this.handleError(t.t0,o));case 13:return t.abrupt("return",this.handleError(t.t0,"invite"));case 14:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t){return f.apply(this,arguments)})},{key:"inviteGroup",value:(l=c(a().mark((function t(e){var n,r,i,o,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.groupID,r=e.userIDList,i=e.offlinePushInfo,o=e.hangup,s=e.inCallUserIDs,c=void 0===s?[]:s,t.prev=1,t.next=4,this.TSignaling.inviteInGroup({groupID:n,inviteeList:r,timeout:o?0:30,data:this._handleInviteGroupData(e),offlinePushInfo:i,inCallUserIDs:c});case 4:return t.abrupt("return",t.sent);case 7:if(t.prev=7,t.t0=t.catch(1),!o){t.next=11;break}return t.abrupt("return",this.handleError(t.t0,"hangup group"));case 11:return t.abrupt("return",this.handleError(t.t0,"inviteGroup"));case 12:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t){return l.apply(this,arguments)})},{key:"accept",value:(s=c(a().mark((function t(e,n){var r,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.inviteID,o=e.type,s=m(e,xy),t.prev=1,t.next=4,this.TSignaling.accept({inviteID:r,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:o},s),n))});case 4:return t.abrupt("return",t.sent);case 7:return t.prev=7,t.t0=t.catch(1),t.abrupt("return",this.handleError(t.t0,"accept"));case 10:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(t,e){return s.apply(this,arguments)})},{key:"reject",value:(o=c(a().mark((function t(e){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviteID,r=e.type,i=e.lineBusy,o={version:0,call_type:r},s=null,i?(o.line_busy=i,s=JSON.stringify(this.handleNewSignaling(o,{message:"lineBusy"}))):s=JSON.stringify(this.handleNewSignaling(o)),t.prev=4,t.next=7,this.TSignaling.reject({inviteID:n,data:s});case 7:return t.abrupt("return",t.sent);case 10:if(t.prev=10,t.t0=t.catch(4),!i){t.next=14;break}return t.abrupt("return",this.handleError(t.t0,"line_busy"));case 14:return t.abrupt("return",this.handleError(t.t0,"reject"));case 15:case"end":return t.stop()}}),t,this,[[4,10]])}))),function(t){return o.apply(this,arguments)})},{key:"cancel",value:(r=c(a().mark((function t(e){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviteID,r=e.callType,t.prev=1,t.next=4,this.TSignaling.cancel({inviteID:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:r}))});case 4:return i=t.sent,t.abrupt("return",i);case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",this.handleError(t.t0,"cancel"));case 11:case"end":return t.stop()}}),t,this,[[1,8]])}))),function(t){return r.apply(this,arguments)})},{key:"hangup",value:(n=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,f,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.userIDList,r=e.callType,i=e.callEnd,o=void 0===i?0:i,s=e.isGroupCall,c=void 0!==s&&s,u=e.groupID,l=void 0===u?"":u,h={version:0,call_type:r,call_end:o},f={cmd:"hangup"},d=JSON.stringify(this.handleNewSignaling(h,f)),!c||!l){t.next=9;break}return t.next=7,this.TSignaling.inviteInGroup({inviteeList:n,groupID:l,data:d,timeout:0});case 7:t.next=11;break;case 9:return t.next=11,this.TSignaling.invite({userID:n[0],data:d,timeout:0});case 11:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"switchCallMode",value:(e=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.callType,i=e.roomID,o=e.mode,t.abrupt("return",this.invite({userID:n,type:r,roomID:i,switchMode:o}));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"destroyed",value:function(){this.TSignaling=null}},{key:"setLogLevel",value:function(t){this.TSignaling.setLogLevel(t)}}]),t}(),ky=function(){function t(e){u(this,t),this._emitter=e.emitter}return h(t,[{key:"onError",value:function(t){this._emitter.emit(og.ERROR,t)}},{key:"onCallEnd",value:function(t){var e=t.userID,n=t.callEnd,r=t.message,i=t.roomID,a=t.callMediaType,o=t.callRole,s=t.totalTime;this._emitter.emit(og.CALL_END,{userID:e,callEnd:n,message:r,roomID:i,callMediaType:a,callRole:o,totalTime:s})}},{key:"onInvited",value:function(t){var e=t.sponsor,n=t.inviteeList,r=t.isFromGroup,i=t.inviteData,a=t.inviteID,o=t.userIDList,s=t.userData,c=void 0===s?"":s;this._emitter.emit(og.INVITED,{sponsor:e,inviteeList:n,userIDList:o,isFromGroup:r,inviteID:a,inviteData:i,userData:c})}},{key:"onLineBusy",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(og.LINE_BUSY,{inviteID:e,invitee:n,userID:r,reason:"line busy"})}},{key:"onReject",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(og.REJECT,{inviteID:e,invitee:n,userID:r,reason:"reject"})}},{key:"onNoResp",value:function(t){var e=t.groupID,n=void 0===e?"":e,r=t.inviteID,i=t.sponsor,a=t.timeoutUserList,o=t.userIDList;this._emitter.emit(og.NO_RESP,{groupID:n,inviteID:r,sponsor:i,timeoutUserList:a,userIDList:o})}},{key:"onCancel",value:function(t){var e=t.inviteID,n=t.invitee,r=t.userID;this._emitter.emit(og.CALLING_CANCEL,{inviteID:e,invitee:n,userID:r})}},{key:"onTimeout",value:function(t){var e=t.inviteID,n=t.groupID,r=t.sponsor,i=t.timeoutUserList;this._emitter.emit(og.CALLING_TIMEOUT,{groupID:n,inviteID:e,sponsor:r,timeoutUserList:i})}},{key:"onUserAccept",value:function(t){var e=t.userID,n=t.userList;this._emitter.emit(og.USER_ACCEPT,{userID:e,userList:n})}},{key:"onUserEnter",value:function(t){var e=t.userID,n=t.playerList;this._emitter.emit(og.USER_ENTER,{userID:e,playerList:n})}},{key:"onUserLeave",value:function(t){var e=t.userID,n=t.playerList;this._emitter.emit(og.USER_LEAVE,{userID:e,playerList:n})}},{key:"onUserUpdate",value:function(t){var e=t.pusher,n=t.playerList;this._emitter.emit(og.USER_UPDATE,{pusher:e,playerList:n})}},{key:"onSdkReady",value:function(t){this._emitter.emit(og.SDK_READY,t)}},{key:"onKickedOut",value:function(t){this._emitter.emit(og.KICKED_OUT,t)}},{key:"onCallMode",value:function(t){this._emitter.emit(og.CALL_MODE,t)}},{key:"onMessageSentByMe",value:function(t){this._emitter.emit(og.MESSAGE_SENT_BY_ME,t)}},{key:"destroyed",value:function(){this._emitter=null}}]),t}(),Ay="1.5.0";Tv("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),jv);var Ly=cn,Ny=function(){var t=Ly(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Uy=j,My=pe,Py=bt,jy=Ny,Vy=RegExp.prototype,Gy=xn.PROPER,Hy=Rr,Fy=cn,Ky=Th,By=L,zy=function(t){var e=t.flags;return void 0!==e||"flags"in Vy||My(t,"flags")||!Py(Vy,t)?e:Uy(jy,t)},$y="toString",Jy=RegExp.prototype[$y],Yy=By((function(){return"/a/b"!=Jy.call({source:"a",flags:"b"})})),qy=Gy&&Jy.name!=$y;(Yy||qy)&&Hy(RegExp.prototype,$y,(function(){var t=Fy(this);return"/"+Ky(t.source)+"/"+Ky(zy(t))}),{unsafe:!0});var Wy,Xy,Qy=Vp;wi({target:"Object",stat:!0,forced:Object.isExtensible!==Qy},{isExtensible:Qy}),Wy="undefined"!=typeof console?console:"undefined"!=typeof global&&global.console?global.console:"undefined"!=typeof window&&window.console?window.console:{};for(var Zy=function(){},tI=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],eI=tI.length-1;eI;)Xy=tI[eI],console[Xy]||(Wy[Xy]=Zy),eI-=1;Object.isExtensible(Wy)&&(Wy.methods=tI);var nI,rI,iI=Wy,aI=L,oI=k.RegExp,sI=aI((function(){var t=oI("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),cI=sI||aI((function(){return!oI("a","y").sticky})),uI={BROKEN_CARET:sI||aI((function(){var t=oI("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:cI,UNSUPPORTED_Y:sI},lI=L,hI=k.RegExp,fI=lI((function(){var t=hI(".","s");return!(t.dotAll&&t.exec("\n")&&"s"===t.flags)})),dI=L,pI=k.RegExp,vI=dI((function(){var t=pI("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),gI=j,yI=W,II=Th,mI=Ny,EI=uI,TI=ee.exports,DI=ef,bI=ir.get,_I=fI,CI=vI,RI=TI("native-string-replace",String.prototype.replace),SI=RegExp.prototype.exec,wI=SI,xI=yI("".charAt),OI=yI("".indexOf),kI=yI("".replace),AI=yI("".slice),LI=(rI=/b*/g,gI(SI,nI=/a/,"a"),gI(SI,rI,"a"),0!==nI.lastIndex||0!==rI.lastIndex),NI=EI.BROKEN_CARET,UI=void 0!==/()??/.exec("")[1];(LI||UI||NI||_I||CI)&&(wI=function(t){var e,n,r,i,a,o,s,c=this,u=bI(c),l=II(t),h=u.raw;if(h)return h.lastIndex=c.lastIndex,e=gI(wI,h,l),c.lastIndex=h.lastIndex,e;var f=u.groups,d=NI&&c.sticky,p=gI(mI,c),v=c.source,g=0,y=l;if(d&&(p=kI(p,"y",""),-1===OI(p,"g")&&(p+="g"),y=AI(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==xI(l,c.lastIndex-1))&&(v="(?: "+v+")",y=" "+y,g++),n=new RegExp("^(?:"+v+")",p)),UI&&(n=new RegExp("^"+v+"$(?!\\s)",p)),LI&&(r=c.lastIndex),i=gI(SI,d?n:c,y),d?i?(i.input=AI(i.input,g),i[0]=AI(i[0],g),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:LI&&i&&(c.lastIndex=c.global?i.index+i[0].length:r),UI&&i&&i.length>1&&gI(RI,i[0],n,(function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)})),i&&f)for(i.groups=o=DI(null),a=0;a<f.length;a++)o[(s=f[a])[0]]=i[s[1]];return i});var MI=wI;wi({target:"RegExp",proto:!0,forced:/./.exec!==MI},{exec:MI});var PI=La,jI=Rr,VI=MI,GI=L,HI=xe,FI=Dn,KI=HI("species"),BI=RegExp.prototype,zI=function(t,e,n,r){var i=HI(t),a=!GI((function(){var e={};return e[i]=function(){return 7},7!=""[t](e)})),o=a&&!GI((function(){var e=!1,n=/a/;return"split"===t&&((n={}).constructor={},n.constructor[KI]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return e=!0,null},n[i](""),!e}));if(!a||!o||n){var s=PI(/./[i]),c=e(i,""[t],(function(t,e,n,r,i){var o=PI(t),c=e.exec;return c===VI||c===BI.exec?a&&!i?{done:!0,value:s(e,n,r)}:{done:!0,value:o(n,e,r)}:{done:!1}}));jI(String.prototype,t,c[0]),jI(BI,i,c[1])}r&&FI(BI[i],"sham",!0)},$I=Oh.charAt,JI=function(t,e,n){return e+(n?$I(t,e).length:1)},YI=j,qI=cn,WI=gt,XI=tt,QI=MI,ZI=TypeError,tm=function(t,e){var n=t.exec;if(WI(n)){var r=YI(n,t,e);return null!==r&&qI(r),r}if("RegExp"===XI(t))return YI(QI,t,e);throw ZI("RegExp#exec called on incompatible receiver")},em=j,nm=cn,rm=ot,im=jr,am=Th,om=ut,sm=Wt,cm=JI,um=tm;zI("match",(function(t,e,n){return[function(e){var n=om(this),r=rm(e)?void 0:sm(e,t);return r?em(r,e,n):new RegExp(e)[t](am(n))},function(t){var r=nm(this),i=am(t),a=n(e,r,i);if(a.done)return a.value;if(!r.global)return um(r,i);var o=r.unicode;r.lastIndex=0;for(var s,c=[],u=0;null!==(s=um(r,i));){var l=am(s[0]);c[u]=l,""===l&&(r.lastIndex=cm(i,im(r.lastIndex),o)),u++}return 0===u?null:c}]})),wi({target:"Array",stat:!0},{isArray:Oi});var lm=k,hm=W(1..valueOf),fm=wi,dm=N,pm=k,vm=lm,gm=W,ym=Ei,Im=pe,mm=av,Em=bt,Tm=Ht,Dm=Pe,bm=L,_m=Sr.f,Cm=A.f,Rm=nn.f,Sm=hm,wm=Qg.trim,xm="Number",Om=pm[xm];vm[xm];var km=Om.prototype,Am=pm.TypeError,Lm=gm("".slice),Nm=gm("".charCodeAt),Um=function(t){var e,n,r,i,a,o,s,c,u=Dm(t,"number");if(Tm(u))throw Am("Cannot convert a Symbol value to a number");if("string"==typeof u&&u.length>2)if(u=wm(u),43===(e=Nm(u,0))||45===e){if(88===(n=Nm(u,2))||120===n)return NaN}else if(48===e){switch(Nm(u,1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+u}for(o=(a=Lm(u,2)).length,s=0;s<o;s++)if((c=Nm(a,s))<48||c>i)return NaN;return parseInt(a,r)}return+u},Mm=ym(xm,!Om(" 0o1")||!Om("0b1")||Om("+0x1")),Pm=function(t){var e,n=arguments.length<1?0:Om(function(t){var e=Dm(t,"number");return"bigint"==typeof e?e:Um(e)}(t));return Em(km,e=this)&&bm((function(){Sm(e)}))?mm(Object(n),this,Pm):n};Pm.prototype=km,Mm&&(km.constructor=Pm),fm({global:!0,constructor:!0,wrap:!0,forced:Mm},{Number:Pm});Mm&&function(t,e){for(var n,r=dm?_m(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),i=0;r.length>i;i++)Im(e,n=r[i])&&!Im(t,n)&&Rm(t,n,Cm(e,n))}(vm[xm],Om);var jm=kr,Vm=Th,Gm=ut,Hm=RangeError,Fm=W,Km=jr,Bm=Th,zm=ut,$m=Fm((function(t){var e=Vm(Gm(this)),n="",r=jm(t);if(r<0||r==1/0)throw Hm("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(n+=e);return n})),Jm=Fm("".slice),Ym=Math.ceil,qm=function(t){return function(e,n,r){var i,a,o=Bm(zm(e)),s=Km(n),c=o.length,u=void 0===r?" ":Bm(r);return s<=c||""==u?o:((a=$m(u,Ym((i=s-c)/u.length))).length>i&&(a=Jm(a,0,i)),t?o+a:a+o)}},Wm=W,Xm=L,Qm={start:qm(!1),end:qm(!0)}.start,Zm=RangeError,tE=isFinite,eE=Math.abs,nE=Date.prototype,rE=nE.toISOString,iE=Wm(nE.getTime),aE=Wm(nE.getUTCDate),oE=Wm(nE.getUTCFullYear),sE=Wm(nE.getUTCHours),cE=Wm(nE.getUTCMilliseconds),uE=Wm(nE.getUTCMinutes),lE=Wm(nE.getUTCMonth),hE=Wm(nE.getUTCSeconds),fE=Xm((function(){return"0385-07-25T07:06:39.999Z"!=rE.call(new Date(-50000000000001))}))||!Xm((function(){rE.call(new Date(NaN))}))?function(){if(!tE(iE(this)))throw Zm("Invalid time value");var t=this,e=oE(t),n=cE(t),r=e<0?"-":e>9999?"+":"";return r+Qm(eE(e),r?6:4,0)+"-"+Qm(lE(t)+1,2,0)+"-"+Qm(aE(t),2,0)+"T"+Qm(sE(t),2,0)+":"+Qm(uE(t),2,0)+":"+Qm(hE(t),2,0)+"."+Qm(n,3,0)+"Z"}:rE;wi({target:"Date",proto:!0,forced:Date.prototype.toISOString!==fE},{toISOString:fE});var dE=W,pE=he,vE=Math.floor,gE=dE("".charAt),yE=dE("".replace),IE=dE("".slice),mE=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,EE=/\$([$&'`]|\d{1,2})/g,TE=ys,DE=j,bE=W,_E=zI,CE=L,RE=cn,SE=gt,wE=ot,xE=kr,OE=jr,kE=Th,AE=ut,LE=JI,NE=Wt,UE=function(t,e,n,r,i,a){var o=n+t.length,s=r.length,c=EE;return void 0!==i&&(i=pE(i),c=mE),yE(a,c,(function(a,c){var u;switch(gE(c,0)){case"$":return"$";case"&":return t;case"`":return IE(e,0,n);case"'":return IE(e,o);case"<":u=i[IE(c,1,-1)];break;default:var l=+c;if(0===l)return a;if(l>s){var h=vE(l/10);return 0===h?a:h<=s?void 0===r[h-1]?gE(c,1):r[h-1]+gE(c,1):a}u=r[l-1]}return void 0===u?"":u}))},ME=tm,PE=xe("replace"),jE=Math.max,VE=Math.min,GE=bE([].concat),HE=bE([].push),FE=bE("".indexOf),KE=bE("".slice),BE="$0"==="a".replace(/./,"$0"),zE=!!/./[PE]&&""===/./[PE]("a","$0");function $E(t,e){t=t.split("."),e=e.split(".");for(var n=Math.max(t.length,e.length);t.length<n;)t.push("0");for(;e.length<n;)e.push("0");for(var r=0;r<n;r++){var i=parseInt(t[r],10),a=parseInt(e[r],10);if(i>a)return 1;if(i<a)return-1}return 0}_E("replace",(function(t,e,n){var r=zE?"$":"$0";return[function(t,n){var r=AE(this),i=wE(t)?void 0:NE(t,PE);return i?DE(i,t,r,n):DE(e,kE(r),t,n)},function(t,i){var a=RE(this),o=kE(t);if("string"==typeof i&&-1===FE(i,r)&&-1===FE(i,"$<")){var s=n(e,a,o,i);if(s.done)return s.value}var c=SE(i);c||(i=kE(i));var u=a.global;if(u){var l=a.unicode;a.lastIndex=0}for(var h=[];;){var f=ME(a,o);if(null===f)break;if(HE(h,f),!u)break;""===kE(f[0])&&(a.lastIndex=LE(o,OE(a.lastIndex),l))}for(var d,p="",v=0,g=0;g<h.length;g++){for(var y=kE((f=h[g])[0]),I=jE(VE(xE(f.index),o.length),0),m=[],E=1;E<f.length;E++)HE(m,void 0===(d=f[E])?d:String(d));var T=f.groups;if(c){var D=GE([y],m,I,o);void 0!==T&&HE(D,T);var b=kE(TE(i,void 0,D))}else b=UE(y,o,I,m,T,i);I>=v&&(p+=KE(o,v,I)+b,v=I+y.length)}return p+KE(o,v)}]}),!!CE((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!BE||zE);var JE="TRTC-ROOM",YE=wx||qq;YE||console.error(JE,"不支持当前小程序环境");var qE,WE=YE.getSystemInfoSync(),XE=WE.safeArea;("iOS 13.3"===WE.system||"iPhoneX"===WE.model&&"iOS 13.3.1"===WE.system)&&console.log("use media audio volume type"),console.log(JE,"SystemInfo",WE),"undefined"!=typeof qq?qE=!0:"undefined"!=typeof wx&&(qE=$E(WE.version,"7.0.8")>=0||$E(WE.version,"2.4.0")>=0&&$E(WE.version,"6.0.0")<0&&$E(WE.SDKVersion,"2.10.0")>=0);var QE=qE,ZE="undefined"!=typeof uni,tT=/iOS/i.test(WE.system),eT=/Android/i.test(WE.system);/mac/i.test(WE.system);var nT=WE.version,rT=WE.SDKBuild?"".concat(WE.SDKVersion,"-").concat(WE.SDKBuild):WE.SDKVersion;WE.screenHeight,XE.bottom,console.log(JE,"APP_VERSION:",nT," LIB_VERSION:",rT," is new version:",QE);var iT=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"array"===function(t){return Object.prototype.toString.call(t).match(/^\[object (.*)\]$/)[1].toLowerCase()}(t)},aT=function(t){return null!==t&&("number"==typeof t&&!isNaN(t-0)||"object"===o(t)&&t.constructor===Number)},oT=function(t){return"string"==typeof t},sT=function(t){return void 0===t},cT=function(t){return iT(t)||function(t){return null!==t&&"object"===o(t)}(t)},uT=0;Date.now||(Date.now=function(){return(new Date).getTime()});var lT=function(){0===uT&&(uT=Date.now()-1);var t=Date.now()-uT;return t>4294967295?(uT+=4294967295,Date.now()-uT):t},hT=function(t){return JSON.stringify(t,["message","code"])};function fT(){var t="unknown";return tT&&(t="ios"),eT&&(t="android"),t}function dT(t){return pT.apply(this,arguments)}function pT(){return(pT=c(a().mark((function t(e){var n,r,i,o,s,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}return t.abrupt("return",!1);case 2:return n=e.microphone,r=void 0!==n&&n,i=e.camera,o=void 0!==i&&i,t.prev=3,t.next=6,wx.getSetting();case 6:if(s=t.sent,c=s.authSetting[Kg.RECORD],u=s.authSetting[Kg.CAMERA],!r||!o){t.next=11;break}return t.abrupt("return",c&&u);case 11:if(!r){t.next=13;break}return t.abrupt("return",c);case 13:if(!o){t.next=15;break}return t.abrupt("return",u);case 15:return t.abrupt("return",!1);case 18:return t.prev=18,t.t0=t.catch(3),t.abrupt("return",!1);case 21:case"end":return t.stop()}}),t,null,[[3,18]])})))).apply(this,arguments)}function vT(t){return t===Gg}var gT=0,yT=new Map;function IT(){var t=new Date;return"TUICallEngine ".concat(t.toLocaleTimeString("en-US",{hour12:!1}),".").concat(function(t){var e;switch(t.toString().length){case 1:e="00".concat(t);break;case 2:e="0".concat(t);break;default:e=t}return e}(t.getMilliseconds()),":")}var mT={_data:[],_length:0,_visible:!1,arguments2String:function(t){var e;if(1===t.length)e=IT()+t[0];else{e=IT();for(var n=0,r=t.length;n<r;n++)cT(t[n])?t[n]instanceof Error?e+=hT(t[n]):e+=JSON.stringify(t[n]):e+=t[n],e+=" "}return e},debug:function(){if(gT<=-1){var t=this.arguments2String(arguments);mT.record(t,"debug"),iI.debug(t)}},log:function(){if(gT<=0){var t=this.arguments2String(arguments);mT.record(t,"log"),iI.log(t)}},info:function(){if(gT<=1){var t=this.arguments2String(arguments);mT.record(t,"info"),iI.info(t)}},warn:function(){if(gT<=2){var t=this.arguments2String(arguments);mT.record(t,"warn"),iI.warn(t)}},error:function(){if(gT<=3){var t=this.arguments2String(arguments);mT.record(t,"error"),iI.error(t)}},time:function(t){yT.set(t,lT())},timeEnd:function(t){if(yT.has(t)){var e=lT()-yT.get(t);return yT.delete(t),e}return iI.warn("未找到对应label: ".concat(t,", 请在调用 logger.timeEnd 前，调用 logger.time")),0},setLevel:function(t){t<4&&iI.log("".concat(IT(),"set level from ").concat(gT," to ").concat(t)),gT=t},getLevel:function(){return gT},record:function(t,e){1100===mT._length&&(mT._data.splice(0,100),mT._length=1e3),mT._length+=1,mT._data.push("".concat(t," [").concat(e,"] \n"))},getLog:function(){return mT._data}},ET=function(){function t(e){u(this,t),this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=fT()}return h(t,[{key:"setCommonInfo",value:function(t){var e,n,r,i,a=t.SDKAppID,o=t.version,s=t.userID,c=t.platform,u=t.scene;this.sdkappid=a,this.version="".concat(o),this.userid=s,this.platform=c,this.scene=u,this.time=(e=new Date,n=e.toISOString(),r=e.getTimezoneOffset()/60,i="",i=r<0?r>-10?"+0".concat(Math.abs(100*r)):"+".concat(Math.abs(100*r)):r>=10?"-".concat(100*r):"-0".concat(100*r),n.replace("Z",i)),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}},{key:"setEnd",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout((function(){t._eventStatController.pushIn(t)}),0)}},{key:"setError",value:function(t,e,n){return this.setNetworkType(n),e?(t.code&&this.setCode(t.code),t.message&&this.setMessage(t.message)):(this.setCode(Ty.NO_NETWORK),this.setMessage(Dy)),this}},{key:"setCode",value:function(t){return"ECONNABORTED"===t&&(this.codeint=103),aT(t)?this.codeint=t:mT.warn("SSOLogData.setCode value not a number, please check!",t,o(t)),this}},{key:"setMessage",value:function(t){return oT(t)?(this.message=t,this):this}},{key:"setText",value:function(t){return aT(t)?this.text=t.toString():oT(t)&&(this.text=t),this}},{key:"setTalkTime",value:function(t){return this.talktime=t,this}},{key:"setMessageType",value:function(t){return this.msgType=t,this}},{key:"setCallType",value:function(t){return this.calltype=t,this}},{key:"setNetworkType",value:function(t){return sT(t)?mT.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=t,this}}],[{key:"bindController",value:function(e){t.prototype._eventStatController=e}}]),t}(),TT="sdkConstruct",DT="call",bT="quality_report",_T=function(){function t(){u(this,t),this._table="timweb-trtccalling",this._report=[]}return h(t,[{key:"pushIn",value:function(t){mT.debug("SSOLogBody.pushIn",this._report.length,t),this._report.push(t)}},{key:"backfill",value:function(t){var e;iT(t)&&0!==t.length&&(mT.debug("SSOLogBody.backfill",this._report.length,t.length),(e=this._report).unshift.apply(e,D(t)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getTable",value:function(){return this._table}},{key:"getLogsInMemory",value:function(){var t=this._report.slice();return this._reset(),t}}]),t}(),CT={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"}},RT={IM_OPEN_STAT:"imopenstat"},ST={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},wT={imopenstat:"v4"},xT=function(){function t(){u(this,t),this.TAG="trtccalling-ssolog-event",this._reportBody=new _T,this._version=Ay,this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}return h(t,[{key:"reportAtOnce",value:function(){mT.debug("EventStatController.reportAtOnce"),this._report()}},{key:"pushIn",value:function(t){t instanceof ET&&(t.setCommonInfo({SDKAppID:Number(wx.getStorageSync("sdkAppId")),version:this._version,userID:wx.getStorageSync("userId")}),this._reportBody.pushIn(t),this._report())}},{key:"_resetLastReportTime",value:function(){this._lastReportTime=Date.now()}},{key:"_startReportTimer",value:function(){var t=this;this._timerID=setInterval((function(){Date.now()<t._lastReportTime+t.WAITING_TIME||t._reportBody.isEmpty()||t._report()}),this.INTERVAL)}},{key:"_stopReportTimer",value:function(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}},{key:"_report",value:function(){var t=this;if(!this._reportBody.isEmpty()){var e=Math.ceil(+new Date/1e3),n=wx.getStorageSync("sdkAppId"),r=this._reportBody.getLogsInMemory(),i={table:this._reportBody.getTable(),report:r},a=CT.CURRENT.COMMON,o=wT.imopenstat,s=RT.IM_OPEN_STAT,c=ST.TIM_WEB_TRTCCALLING_REPORT,u="".concat(a,"/").concat(o,"/").concat(s,"/").concat(c,"/?sdkappid=").concat(n,"&reqtime=").concat(e);wx.request({url:u,method:"POST",data:JSON.stringify(i),header:{"content-type":"application/json"},success:function(e){t._retryCount>0&&(mT.debug("EventStatController.report retry success"),t._retryCount=0)},fail:function(e){mT.warn("EventStatController.report, error:".concat(hT(e))),t._reportBody.backfill(r),t._reportBody.getLogsNumInMemory()>t.MAX_THRESHOLD||t._retryCount===t.MAX_RETRY_COUNT||0===t._timerID?t._retryCount=0:t._retryCount+=1}})}}},{key:"reset",value:function(){mT.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}]),t}(),OT=zr.includes,kT=sd;wi({target:"Array",proto:!0,forced:L((function(){return!Array(1).includes()}))},{includes:function(t){return OT(this,t,arguments.length>1?arguments[1]:void 0)}}),kT("includes");var AT=mt,LT=tt,NT=xe("match"),UT=function(t){var e;return AT(t)&&(void 0!==(e=t[NT])?!!e:"RegExp"==LT(t))},MT=TypeError,PT=xe("match"),jT=wi,VT=function(t){if(UT(t))throw MT("The method doesn't accept regular expressions");return t},GT=ut,HT=Th,FT=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[PT]=!1,"/./"[t](e)}catch(t){}}return!1},KT=W("".indexOf);jT({target:"String",proto:!0,forced:!FT("includes")},{includes:function(t){return!!~KT(HT(GT(this)),HT(VT(t)),arguments.length>1?arguments[1]:void 0)}});var BT=W,zT=bv,$T=Tp.exports.getWeakData,JT=as,YT=cn,qT=ot,WT=mt,XT=Dl,QT=pe,ZT=ir.set,tD=ir.getterFor,eD=Qa.find,nD=Qa.findIndex,rD=BT([].splice),iD=0,aD=function(t){return t.frozen||(t.frozen=new oD)},oD=function(){this.entries=[]},sD=function(t,e){return eD(t.entries,(function(t){return t[0]===e}))};oD.prototype={get:function(t){var e=sD(this,t);if(e)return e[1]},has:function(t){return!!sD(this,t)},set:function(t,e){var n=sD(this,t);n?n[1]=e:this.entries.push([t,e])},delete:function(t){var e=nD(this.entries,(function(e){return e[0]===t}));return~e&&rD(this.entries,e,1),!!~e}};var cD,uD={getConstructor:function(t,e,n,r){var i=t((function(t,i){JT(t,a),ZT(t,{type:e,id:iD++,frozen:void 0}),qT(i)||XT(i,t[r],{that:t,AS_ENTRIES:n})})),a=i.prototype,o=tD(e),s=function(t,e,n){var r=o(t),i=$T(YT(e),!0);return!0===i?aD(r).set(e,n):i[r.id]=n,t};return zT(a,{delete:function(t){var e=o(this);if(!WT(t))return!1;var n=$T(t);return!0===n?aD(e).delete(t):n&&QT(n,e.id)&&delete n[e.id]},has:function(t){var e=o(this);if(!WT(t))return!1;var n=$T(t);return!0===n?aD(e).has(t):n&&QT(n,e.id)}}),zT(a,n?{get:function(t){var e=o(this);if(WT(t)){var n=$T(t);return!0===n?aD(e).get(t):n?n[e.id]:void 0}},set:function(t,e){return s(this,t,e)}}:{add:function(t){return s(this,t,!0)}}),i}},lD=Gp,hD=k,fD=W,dD=bv,pD=Tp.exports,vD=Tv,gD=uD,yD=mt,ID=ir.enforce,mD=L,ED=Vn,TD=Object,DD=Array.isArray,bD=TD.isExtensible,_D=TD.isFrozen,CD=TD.isSealed,RD=TD.freeze,SD=TD.seal,wD={},xD={},OD=!hD.ActiveXObject&&"ActiveXObject"in hD,kD=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},AD=vD("WeakMap",kD,gD),LD=AD.prototype,ND=fD(LD.set);if(ED)if(OD){cD=gD.getConstructor(kD,"WeakMap",!0),pD.enable();var UD=fD(LD.delete),MD=fD(LD.has),PD=fD(LD.get);dD(LD,{delete:function(t){if(yD(t)&&!bD(t)){var e=ID(this);return e.frozen||(e.frozen=new cD),UD(this,t)||e.frozen.delete(t)}return UD(this,t)},has:function(t){if(yD(t)&&!bD(t)){var e=ID(this);return e.frozen||(e.frozen=new cD),MD(this,t)||e.frozen.has(t)}return MD(this,t)},get:function(t){if(yD(t)&&!bD(t)){var e=ID(this);return e.frozen||(e.frozen=new cD),MD(this,t)?PD(this,t):e.frozen.get(t)}return PD(this,t)},set:function(t,e){if(yD(t)&&!bD(t)){var n=ID(this);n.frozen||(n.frozen=new cD),MD(this,t)?ND(this,t,e):n.frozen.set(t,e)}else ND(this,t,e);return this}})}else lD&&mD((function(){var t=RD([]);return ND(new AD,t,1),!_D(t)}))&&dD(LD,{set:function(t,e){var n;return DD(t)&&(_D(t)?n=wD:CD(t)&&(n=xD)),ND(this,t,e),n==wD&&RD(t),n==xD&&SD(t),this}});var jD={exports:{}};
/*!
 * validate.js 0.13.1
 *
 * (c) 2013-2019 Nicklas Ansman, 2013 Wrapp
 * Validate.js may be freely distributed under the MIT license.
 * For all details and documentation:
 * http://validatejs.org/
 */(function(t,e,n){var r=function(t,e,n){n=i.extend({},i.options,n);var a=i.runValidations(t,e,n);if(a.some((function(t){return i.isPromise(t.error)})))throw new Error("Use validate.async if you want support for promises");return r.processValidationResults(a,n)},i=r;i.extend=function(t){return[].slice.call(arguments,1).forEach((function(e){for(var n in e)t[n]=e[n]})),t},i.extend(r,{version:{major:0,minor:13,patch:1,metadata:null,toString:function(){var t=i.format("%{major}.%{minor}.%{patch}",i.version);return i.isEmpty(i.version.metadata)||(t+="+"+i.version.metadata),t}},Promise:"undefined"!=typeof Promise?Promise:null,EMPTY_STRING_REGEXP:/^\s*$/,runValidations:function(t,e,n){var r,a,o,s,c,u,l,h=[];for(r in(i.isDomElement(t)||i.isJqueryElement(t))&&(t=i.collectFormValues(t)),e)for(a in o=i.getDeepObjectValue(t,r),s=i.result(e[r],o,t,r,n,e)){if(!(c=i.validators[a]))throw l=i.format("Unknown validator %{name}",{name:a}),new Error(l);u=s[a],(u=i.result(u,o,t,r,n,e))&&h.push({attribute:r,value:o,validator:a,globalOptions:n,attributes:t,options:u,error:c.call(c,o,u,r,t,n)})}return h},processValidationResults:function(t,e){t=i.pruneEmptyErrors(t,e),t=i.expandMultipleErrors(t,e),t=i.convertErrorMessages(t,e);var n=e.format||"grouped";if("function"!=typeof i.formatters[n])throw new Error(i.format("Unknown format %{format}",e));return t=i.formatters[n](t),i.isEmpty(t)?void 0:t},async:function(t,e,n){var r=(n=i.extend({},i.async.options,n)).wrapErrors||function(t){return t};!1!==n.cleanAttributes&&(t=i.cleanAttributes(t,e));var a=i.runValidations(t,e,n);return new i.Promise((function(o,s){i.waitForResults(a).then((function(){var c=i.processValidationResults(a,n);c?s(new r(c,n,t,e)):o(t)}),(function(t){s(t)}))}))},single:function(t,e,n){return n=i.extend({},i.single.options,n,{format:"flat",fullMessages:!1}),i({single:t},{single:e},n)},waitForResults:function(t){return t.reduce((function(t,e){return i.isPromise(e.error)?t.then((function(){return e.error.then((function(t){e.error=t||null}))})):t}),new i.Promise((function(t){t()})))},result:function(t){var e=[].slice.call(arguments,1);return"function"==typeof t&&(t=t.apply(null,e)),t},isNumber:function(t){return"number"==typeof t&&!isNaN(t)},isFunction:function(t){return"function"==typeof t},isInteger:function(t){return i.isNumber(t)&&t%1==0},isBoolean:function(t){return"boolean"==typeof t},isObject:function(t){return t===Object(t)},isDate:function(t){return t instanceof Date},isDefined:function(t){return null!=t},isPromise:function(t){return!!t&&i.isFunction(t.then)},isJqueryElement:function(t){return t&&i.isString(t.jquery)},isDomElement:function(t){return!!t&&!(!t.querySelectorAll||!t.querySelector)&&(!(!i.isObject(document)||t!==document)||("object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&null!==t&&1===t.nodeType&&"string"==typeof t.nodeName))},isEmpty:function(t){var e;if(!i.isDefined(t))return!0;if(i.isFunction(t))return!1;if(i.isString(t))return i.EMPTY_STRING_REGEXP.test(t);if(i.isArray(t))return 0===t.length;if(i.isDate(t))return!1;if(i.isObject(t)){for(e in t)return!1;return!0}return!1},format:i.extend((function(t,e){return i.isString(t)?t.replace(i.format.FORMAT_REGEXP,(function(t,n,r){return"%"===n?"%{"+r+"}":String(e[r])})):t}),{FORMAT_REGEXP:/(%?)%\{([^\}]+)\}/g}),prettify:function(t){return i.isNumber(t)?100*t%1==0?""+t:parseFloat(Math.round(100*t)/100).toFixed(2):i.isArray(t)?t.map((function(t){return i.prettify(t)})).join(", "):i.isObject(t)?i.isDefined(t.toString)?t.toString():JSON.stringify(t):(t=""+t).replace(/([^\s])\.([^\s])/g,"$1 $2").replace(/\\+/g,"").replace(/[_-]/g," ").replace(/([a-z])([A-Z])/g,(function(t,e,n){return e+" "+n.toLowerCase()})).toLowerCase()},stringifyValue:function(t,e){return(e&&e.prettify||i.prettify)(t)},isString:function(t){return"string"==typeof t},isArray:function(t){return"[object Array]"==={}.toString.call(t)},isHash:function(t){return i.isObject(t)&&!i.isArray(t)&&!i.isFunction(t)},contains:function(t,e){return!!i.isDefined(t)&&(i.isArray(t)?-1!==t.indexOf(e):e in t)},unique:function(t){return i.isArray(t)?t.filter((function(t,e,n){return n.indexOf(t)==e})):t},forEachKeyInKeypath:function(t,e,n){if(i.isString(e)){var r,a="",o=!1;for(r=0;r<e.length;++r)switch(e[r]){case".":o?(o=!1,a+="."):(t=n(t,a,!1),a="");break;case"\\":o?(o=!1,a+="\\"):o=!0;break;default:o=!1,a+=e[r]}return n(t,a,!0)}},getDeepObjectValue:function(t,e){if(i.isObject(t))return i.forEachKeyInKeypath(t,e,(function(t,e){if(i.isObject(t))return t[e]}))},collectFormValues:function(t,e){var n,r,a,o,s,c,u={};if(i.isJqueryElement(t)&&(t=t[0]),!t)return u;for(e=e||{},o=t.querySelectorAll("input[name], textarea[name]"),n=0;n<o.length;++n)if(a=o.item(n),!i.isDefined(a.getAttribute("data-ignored"))){var l=a.name.replace(/\./g,"\\\\.");c=i.sanitizeFormValue(a.value,e),"number"===a.type?c=c?+c:null:"checkbox"===a.type?a.attributes.value?a.checked||(c=u[l]||null):c=a.checked:"radio"===a.type&&(a.checked||(c=u[l]||null)),u[l]=c}for(o=t.querySelectorAll("select[name]"),n=0;n<o.length;++n)if(a=o.item(n),!i.isDefined(a.getAttribute("data-ignored"))){if(a.multiple)for(r in c=[],a.options)(s=a.options[r])&&s.selected&&c.push(i.sanitizeFormValue(s.value,e));else{var h=void 0!==a.options[a.selectedIndex]?a.options[a.selectedIndex].value:"";c=i.sanitizeFormValue(h,e)}u[a.name]=c}return u},sanitizeFormValue:function(t,e){return e.trim&&i.isString(t)&&(t=t.trim()),!1!==e.nullify&&""===t?null:t},capitalize:function(t){return i.isString(t)?t[0].toUpperCase()+t.slice(1):t},pruneEmptyErrors:function(t){return t.filter((function(t){return!i.isEmpty(t.error)}))},expandMultipleErrors:function(t){var e=[];return t.forEach((function(t){i.isArray(t.error)?t.error.forEach((function(n){e.push(i.extend({},t,{error:n}))})):e.push(t)})),e},convertErrorMessages:function(t,e){var n=[],r=(e=e||{}).prettify||i.prettify;return t.forEach((function(t){var a=i.result(t.error,t.value,t.attribute,t.options,t.attributes,t.globalOptions);i.isString(a)?("^"===a[0]?a=a.slice(1):!1!==e.fullMessages&&(a=i.capitalize(r(t.attribute))+" "+a),a=a.replace(/\\\^/g,"^"),a=i.format(a,{value:i.stringifyValue(t.value,e)}),n.push(i.extend({},t,{error:a}))):n.push(t)})),n},groupErrorsByAttribute:function(t){var e={};return t.forEach((function(t){var n=e[t.attribute];n?n.push(t):e[t.attribute]=[t]})),e},flattenErrorsToArray:function(t){return t.map((function(t){return t.error})).filter((function(t,e,n){return n.indexOf(t)===e}))},cleanAttributes:function(t,e){function n(t,e,n){return i.isObject(t[e])?t[e]:t[e]=!!n||{}}return i.isObject(e)&&i.isObject(t)?function t(e,n){if(!i.isObject(e))return e;var r,a,o=i.extend({},e);for(a in e)r=n[a],i.isObject(r)?o[a]=t(o[a],r):r||delete o[a];return o}(t,e=function(t){var e,r={};for(e in t)t[e]&&i.forEachKeyInKeypath(r,e,n);return r}(e)):{}},exposeModule:function(t,e,n,r,i){n?(r&&r.exports&&(n=r.exports=t),n.validate=t):(e.validate=t,t.isFunction(i)&&i.amd&&i([],(function(){return t})))},warn:function(t){"undefined"!=typeof console&&console.warn&&console.warn("[validate.js] "+t)},error:function(t){"undefined"!=typeof console&&console.error&&console.error("[validate.js] "+t)}}),r.validators={presence:function(t,e){if(!1!==(e=i.extend({},this.options,e)).allowEmpty?!i.isDefined(t):i.isEmpty(t))return e.message||this.message||"can't be blank"},length:function(t,e,n){if(i.isDefined(t)){var r,a=(e=i.extend({},this.options,e)).is,o=e.maximum,s=e.minimum,c=[],u=(t=(e.tokenizer||function(t){return t})(t)).length;return i.isNumber(u)?(i.isNumber(a)&&u!==a&&(r=e.wrongLength||this.wrongLength||"is the wrong length (should be %{count} characters)",c.push(i.format(r,{count:a}))),i.isNumber(s)&&u<s&&(r=e.tooShort||this.tooShort||"is too short (minimum is %{count} characters)",c.push(i.format(r,{count:s}))),i.isNumber(o)&&u>o&&(r=e.tooLong||this.tooLong||"is too long (maximum is %{count} characters)",c.push(i.format(r,{count:o}))),c.length>0?e.message||c:void 0):e.message||this.notValid||"has an incorrect length"}},numericality:function(t,e,n,r,a){if(i.isDefined(t)){var o,s,c=[],u={greaterThan:function(t,e){return t>e},greaterThanOrEqualTo:function(t,e){return t>=e},equalTo:function(t,e){return t===e},lessThan:function(t,e){return t<e},lessThanOrEqualTo:function(t,e){return t<=e},divisibleBy:function(t,e){return t%e==0}},l=(e=i.extend({},this.options,e)).prettify||a&&a.prettify||i.prettify;if(i.isString(t)&&e.strict){var h="^-?(0|[1-9]\\d*)";if(e.onlyInteger||(h+="(\\.\\d+)?"),h+="$",!new RegExp(h).test(t))return e.message||e.notValid||this.notValid||this.message||"must be a valid number"}if(!0!==e.noStrings&&i.isString(t)&&!i.isEmpty(t)&&(t=+t),!i.isNumber(t))return e.message||e.notValid||this.notValid||this.message||"is not a number";if(e.onlyInteger&&!i.isInteger(t))return e.message||e.notInteger||this.notInteger||this.message||"must be an integer";for(o in u)if(s=e[o],i.isNumber(s)&&!u[o](t,s)){var f="not"+i.capitalize(o),d=e[f]||this[f]||this.message||"must be %{type} %{count}";c.push(i.format(d,{count:s,type:l(o)}))}return e.odd&&t%2!=1&&c.push(e.notOdd||this.notOdd||this.message||"must be odd"),e.even&&t%2!=0&&c.push(e.notEven||this.notEven||this.message||"must be even"),c.length?e.message||c:void 0}},datetime:i.extend((function(t,e){if(!i.isFunction(this.parse)||!i.isFunction(this.format))throw new Error("Both the parse and format functions needs to be set to use the datetime/date validator");if(i.isDefined(t)){var n,r=[],a=(e=i.extend({},this.options,e)).earliest?this.parse(e.earliest,e):NaN,o=e.latest?this.parse(e.latest,e):NaN;return t=this.parse(t,e),isNaN(t)||e.dateOnly&&t%864e5!=0?(n=e.notValid||e.message||this.notValid||"must be a valid date",i.format(n,{value:arguments[0]})):(!isNaN(a)&&t<a&&(n=e.tooEarly||e.message||this.tooEarly||"must be no earlier than %{date}",n=i.format(n,{value:this.format(t,e),date:this.format(a,e)}),r.push(n)),!isNaN(o)&&t>o&&(n=e.tooLate||e.message||this.tooLate||"must be no later than %{date}",n=i.format(n,{date:this.format(o,e),value:this.format(t,e)}),r.push(n)),r.length?i.unique(r):void 0)}}),{parse:null,format:null}),date:function(t,e){return e=i.extend({},e,{dateOnly:!0}),i.validators.datetime.call(i.validators.datetime,t,e)},format:function(t,e){(i.isString(e)||e instanceof RegExp)&&(e={pattern:e});var n,r=(e=i.extend({},this.options,e)).message||this.message||"is invalid",a=e.pattern;if(i.isDefined(t))return i.isString(t)?(i.isString(a)&&(a=new RegExp(e.pattern,e.flags)),(n=a.exec(t))&&n[0].length==t.length?void 0:r):r},inclusion:function(t,e){if(i.isDefined(t)&&(i.isArray(e)&&(e={within:e}),e=i.extend({},this.options,e),!i.contains(e.within,t))){var n=e.message||this.message||"^%{value} is not included in the list";return i.format(n,{value:t})}},exclusion:function(t,e){if(i.isDefined(t)&&(i.isArray(e)&&(e={within:e}),e=i.extend({},this.options,e),i.contains(e.within,t))){var n=e.message||this.message||"^%{value} is restricted";return i.isString(e.within[t])&&(t=e.within[t]),i.format(n,{value:t})}},email:i.extend((function(t,e){var n=(e=i.extend({},this.options,e)).message||this.message||"is not a valid email";if(i.isDefined(t))return i.isString(t)&&this.PATTERN.exec(t)?void 0:n}),{PATTERN:/^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$/i}),equality:function(t,e,n,r,a){if(i.isDefined(t)){i.isString(e)&&(e={attribute:e});var o=(e=i.extend({},this.options,e)).message||this.message||"is not equal to %{attribute}";if(i.isEmpty(e.attribute)||!i.isString(e.attribute))throw new Error("The attribute must be a non empty string");var s=i.getDeepObjectValue(r,e.attribute),c=e.comparator||function(t,e){return t===e},u=e.prettify||a&&a.prettify||i.prettify;return c(t,s,e,n,r)?void 0:i.format(o,{attribute:u(e.attribute)})}},url:function(t,e){if(i.isDefined(t)){var n=(e=i.extend({},this.options,e)).message||this.message||"is not a valid url",r=e.schemes||this.schemes||["http","https"],a=e.allowLocal||this.allowLocal||!1,o=e.allowDataUrl||this.allowDataUrl||!1;if(!i.isString(t))return n;var s="^(?:(?:"+r.join("|")+")://)(?:\\S+(?::\\S*)?@)?(?:",c="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))";return a?c+="?":s+="(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})",s+="(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*"+c+")(?::\\d{2,5})?(?:[/?#]\\S*)?$",o&&(s="(?:"+s+")|(?:^data:(?:\\w+\\/[-+.\\w]+(?:;[\\w=]+)*)?(?:;base64)?,[A-Za-z0-9-_.!~\\*'();\\/?:@&=+$,%]*$)"),new RegExp(s,"i").exec(t)?void 0:n}},type:i.extend((function(t,e,n,r,a){if(i.isString(e)&&(e={type:e}),i.isDefined(t)){var o,s=i.extend({},this.options,e),c=s.type;if(!i.isDefined(c))throw new Error("No type was specified");if(o=i.isFunction(c)?c:this.types[c],!i.isFunction(o))throw new Error("validate.validators.type.types."+c+" must be a function.");if(!o(t,s,n,r,a)){var u=e.message||this.messages[c]||this.message||s.message||(i.isFunction(c)?"must be of the correct type":"must be of type %{type}");return i.isFunction(u)&&(u=u(t,e,n,r,a)),i.format(u,{attribute:i.prettify(n),type:c})}}}),{types:{object:function(t){return i.isObject(t)&&!i.isArray(t)},array:i.isArray,integer:i.isInteger,number:i.isNumber,string:i.isString,date:i.isDate,boolean:i.isBoolean},messages:{}})},r.formatters={detailed:function(t){return t},flat:i.flattenErrorsToArray,grouped:function(t){var e;for(e in t=i.groupErrorsByAttribute(t))t[e]=i.flattenErrorsToArray(t[e]);return t},constraint:function(t){var e;for(e in t=i.groupErrorsByAttribute(t))t[e]=t[e].map((function(t){return t.validator})).sort();return t}},r.exposeModule(r,this,t,e,n)}).call(x,jD.exports,jD,null);var VD=jD.exports,GD="number",HD="string",FD="object",KD="function",BD="array",zD={createInstance:{sdkAppID:{presence:!0,type:GD},tim:{type:FD}},destroyInstance:{},init:{userID:{presence:!0,type:HD},userSig:{presence:!0,type:HD}},on:{eventCode:{presence:!0,type:HD},handler:{presence:!0,type:KD},context:{presence:!0,type:FD}},off:{eventCode:{presence:!0,type:HD},handler:{presence:!0,type:KD}},call:{userID:{presence:!0,type:HD},type:{presence:!0,type:GD},roomID:{presence:!1,type:GD,numericality:{onlyInteger:!0,greaterThan:0,lessThanOrEqualTo:Rg}}},groupCall:{groupID:{presence:!0,type:HD},type:{presence:!0,type:GD},userIDList:{presence:!0,type:BD},roomID:{presence:!1,type:GD,numericality:{onlyInteger:!0,greaterThan:0,lessThanOrEqualTo:Rg}}},joinInGroupCall:{groupID:{presence:!0,type:HD},type:{presence:!0,type:GD},roomID:{presence:!0,type:GD}},inviteUser:{userIDList:{presence:!0,type:BD}},accept:{},reject:{},hangup:{},switchCallMediaType:{type:{presence:!0,type:GD}},openCamera:{},closeCamera:{},switchCamera:{},openMicrophone:{},closeMicrophone:{},selectAudioPlaybackDevice:{type:{presence:!0,type:HD}},setSelfInfo:{nickName:{presence:!0,type:HD},avatar:{presence:!0,type:HD}}},$D={createInstance:"",destroyInstance:"",init:"",on:"",off:"",call:[sg.IDLE],groupCall:[sg.IDLE],accept:[sg.CALLING],reject:[sg.CALLING],hangup:[sg.CALLING,sg.CONNECTED],switchCallMediaType:[sg.CALLING,sg.CONNECTED],joinInGroupCall:[sg.IDLE],inviteUser:[sg.CALLING,sg.CONNECTED],openCamera:[sg.CALLING,sg.CONNECTED],closeCamera:[sg.CALLING,sg.CONNECTED],switchCamera:[sg.CALLING,sg.CONNECTED],openMicrophone:[sg.CALLING,sg.CONNECTED],closeMicrophone:[sg.CALLING,sg.CONNECTED],selectAudioPlaybackDevice:[sg.CALLING,sg.CONNECTED],setSelfInfo:""},JD={createInstance:!1,destroyInstance:!0,init:!1,on:!0,off:!0,call:!0,groupCall:!0,joinInGroupCall:!0,inviteUser:!0,accept:!0,reject:!0,hangup:!0,switchCallMediaType:!0,openCamera:!0,closeCamera:!0,switchCamera:!0,openMicrophone:!0,closeMicrophone:!0,selectAudioPlaybackDevice:!0,setSelfInfo:!0},YD=function(t){d(n,I(Error));var e=T(n);function n(t,r,i){var a;return u(this,n),f(E(a=e.call(this,r)),"code",void 0),f(E(a),"message",void 0),f(E(a),"data",void 0),a.code=t,a.message=r,a.data=i,a}return h(n,null,[{key:"error",value:function(t,e,r){return r?new n(t,e,r):new n(t,e)}}]),n}();VD.validators.type.types.function=function(t){return t instanceof Function};var qD=function(){function t(){u(this,t),f(this,"paramsMatchedRule",zD),f(this,"statusMatchedRule",$D),f(this,"requireInit",JD)}return h(t,[{key:"getParamsMatchedRule",value:function(t){return this.paramsMatchedRule[t]}},{key:"getStatusMatchedRule",value:function(t){return this.statusMatchedRule[t]}},{key:"getInitReadyRule",value:function(t){return this.requireInit[t]}}]),t}(),WD=function(){function t(){u(this,t)}return h(t,[{key:"notify",value:function(t,e,n,r){throw YD.error(e,"[TUICallEngine:".concat(t.api,",").concat(e,"]").concat(n).concat(r))}}]),t}(),XD=h((function t(e){u(this,t),f(this,"api",""),f(this,"attributes",{}),f(this,"callStatus",""),f(this,"capabilityCode",void 0),f(this,"initReady",void 0),this.api=e.api,this.attributes=e.attributes,this.callStatus=e.callStatus,this.capabilityCode=e.capabilityCode,this.initReady=e.initReady})),QD=new WeakMap,ZD=function(){function t(){u(this,t),w(this,QD,{writable:!0,value:void 0}),R(this,QD,[])}var e;return h(t,[{key:"addAlertHandler",value:function(t){C(this,QD).push(t)}},{key:"check",value:(e=c(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<C(this,QD).length)){t.next=7;break}return t.next=4,C(this,QD)[r].check(e,n);case 4:r++,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"checkSync",value:function(t,e){for(var n=0;n<C(this,QD).length;n++)C(this,QD)[n].check(t,e)}}]),t}(),tb=function(){function t(e,n){u(this,t),f(this,"rule",void 0),f(this,"notification",void 0),this.rule=e,this.notification=n}var e;return h(t,[{key:"check",value:(e=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)}))),function(t){return e.apply(this,arguments)})}]),t}(),eb=function(t){d(n,tb);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t){var e=this.rule.getParamsMatchedRule(t.api);if(e&&t.attributes){var n=VD(t.attributes,e);if(void 0!==n)for(var r=0,i=Object.keys(n);r<i.length;r++){var a=i[r];Object.prototype.hasOwnProperty.call(n,a)&&this.notification.notify(t,Ty.ERROR_PARAM_INVALID,n[a])}}}}]),n}(),nb=function(t){d(n,tb);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t){if(t.callStatus){var e=this.rule.getStatusMatchedRule(t.api);e&&!e.includes(t.callStatus)&&this.notification.notify(t,Ty.ERROR_REQUEST_REFUSED,Ry,Sy.ERROR_REQUEST_REFUSED)}}}]),n}(),rb=function(t){d(r,tb);var e,n=T(r);function r(t,e){return u(this,r),n.call(this,t,e)}return h(r,[{key:"check",value:(e=c(a().mark((function t(e){var n,r=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=r.length>1&&void 0!==r[1]?r[1]:{},!e.capabilityCode){t.next=14;break}return t.prev=2,t.next=5,n.tim.callExperimentalAPI("isCommercialAbilityEnabled",e.capabilityCode);case 5:!1===t.sent.data.enabled&&this.notification.notify(e,Ty.ERROR_PACKAGE_NOT_SUPPORTED,by,Sy.ERROR_PACKAGE_NOT_SUPPORTED),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(2),wx.$TUICallEngine._callDataReport.setCodeAndMessage(Ty.ERROR_PACKAGE_NOT_SUPPORTED,JSON.stringify(t.t0)),wx.$TUICallEngine._callDataReport.uploadToKibana(),2905===t.t0.code?this.notification.notify(e,Ty.ERROR_TIM_VERSION_OUTDATED,_y,Sy.ERROR_TIM_VERSION_OUTDATED):this.notification.notify(e,Ty.ERROR_PACKAGE_NOT_SUPPORTED,by,Sy.ERROR_PACKAGE_NOT_SUPPORTED);case 14:case"end":return t.stop()}}),t,this,[[2,9]])}))),function(t){return e.apply(this,arguments)})}]),r}(),ib=function(t){d(n,tb);var e=T(n);function n(t,r){return u(this,n),e.call(this,t,r)}return h(n,[{key:"check",value:function(t,e){void 0!==t.initReady&&this.rule.getInitReadyRule(t.api)!==t.initReady&&this.notification.notify(t,Ty.ERROR_INIT_FAIL,Cy,Sy.ERROR_INIT_FAIL)}}]),n}(),ab=function(){function t(){u(this,t),f(this,"alertRule",void 0),f(this,"notification",void 0),f(this,"alert",void 0)}return h(t,[{key:"initializeBeans",value:function(){this.alertRule=new qD,this.notification=new WD,this.alert=new ZD,this.alert.addAlertHandler(new eb(this.alertRule,this.notification)),this.alert.addAlertHandler(new ib(this.alertRule,this.notification)),this.alert.addAlertHandler(new rb(this.alertRule,this.notification)),this.alert.addAlertHandler(new nb(this.alertRule,this.notification))}},{key:"getAlert",value:function(){return this.alert}}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new t,this.instance.initializeBeans()),this.instance}}]),t}();f(ab,"instance",void 0);var ob=W,sb=Jt,cb=mt,ub=pe,lb=ms,hb=U,fb=Function,db=ob([].concat),pb=ob([].join),vb={},gb=hb?fb.bind:function(t){var e=sb(this),n=e.prototype,r=lb(arguments,1),i=function(){var n=db(r,lb(arguments));return this instanceof i?function(t,e,n){if(!ub(vb,e)){for(var r=[],i=0;i<e;i++)r[i]="a["+i+"]";vb[e]=fb("C,a","return new C("+pb(r,",")+")")}return vb[e](t,n)}(e,n.length,n):e.apply(t,n)};return cb(n)&&(i.prototype=n),i};wi({target:"Function",proto:!0,forced:Function.bind!==gb},{bind:gb});var yb=function(){function t(e){u(this,t),f(this,"_eventStatController",void 0),f(this,"_callData",void 0),f(this,"_ssoLog",void 0),this._eventStatController=new xT,ET.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new ET(bT)}return h(t,[{key:"setCallData",value:function(t){this._callData=t}},{key:"getCallData",value:function(){return this._callData}},{key:"setInviteID",value:function(t){this._callData.inviteID=t}},{key:"setTotalTime",value:function(t){this._callData.totalTime="".concat(t)}},{key:"setAbilityBit",value:function(t){this._callData.abilityBit=!!t}},{key:"setEnterRoomTime",value:function(t){this._callData.enterRoomTime=hy(t)}},{key:"setSendSignalingTime",value:function(t){this._callData.sendSignalingTime=hy(t)}},{key:"setCallAcceptTime",value:function(t){this._callData.callAcceptTime=hy(t)}},{key:"setExitRoomTime",value:function(t){this._callData.exitRoomTime=hy(t)}},{key:"setCallEndTime",value:function(t){this._callData.callEndTime=hy(t)}},{key:"setCodeAndMessage",value:function(t,e){this._callData.code=t||0,this._callData.message=e||""}},{key:"setCallScene",value:function(t){this._callData.callScene=t||""}},{key:"getResult",value:function(){return this._callData.result}},{key:"setResult",value:function(t){this._callData.result=t||""}},{key:"setUserID",value:function(t){this._callData.userID=t||""}},{key:"_callTypeMapping",value:function(t){var e=Ng;switch(t){case mg:e=wg;break;case Eg:e=Sg}return e}},{key:"_callRoleMapping",value:function(t){var e=t;return e===gg?e=Pg:e===yg&&(e=jg),e}},{key:"packageCallDataToKibana",value:function(){var t=this._callTypeMapping(this._callData.callType),e=this._callRoleMapping(this._callData.callRole);return"".concat("CallData{version='").concat(this._callData.version,", platform=").concat(this._callData.platform,", framework=").concat(this._callData.framework,", sdk_app_id=").concat(this._callData.sdkAppId,", user_id=").concat(this._callData.userID,", room_id=").concat(this._callData.roomID,", invite_id=").concat(this._callData.inviteID,", invitee_list=").concat(this._callData.inviteeList,", media_type=").concat(t,", role=").concat(e,", call_scene=").concat(this._callData.callScene,", result=").concat(this._callData.result,", total_time=").concat(this._callData.totalTime,", total_score=").concat(this._callData.totalScore,", ability_bit=").concat(this._callData.abilityBit,", enter_room=").concat(this._callData.enterRoomTime,", send_signaling=").concat(this._callData.sendSignalingTime,", call_accept=").concat(this._callData.callAcceptTime,", exit_room=").concat(this._callData.exitRoomTime,", call_end=").concat(this._callData.callEndTime,", code=").concat(this._callData.code,", message=").concat(this._callData.message,", network=").concat(this._callData.network,", audio=").concat(this._callData.audio,", video=").concat(this._callData.video,"}")}},{key:"initializeCallData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.version,n=void 0===e?"":e,r=t.sdkAppId,i=void 0===r?0:r,a=t.userID,o=void 0===a?"":a,s=fT(),c=ZE?"uniminiprogram":"wxminiprogram";this._callData={version:n,platform:s,framework:c,sdkAppId:i,userID:o,roomID:0,inviteID:"",callRole:vg,callScene:"",callType:Ig,inviteeList:[],result:Ng,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}}},{key:"reset",value:function(){this.initializeCallData(),this._ssoLog=null}},{key:"clearCallDataAfterUpload",value:function(){var t=this.getCallData(),e=t.version,n=t.sdkAppId,r=t.userID;this.initializeCallData({version:e,sdkAppId:n,userID:r})}},{key:"uploadToKibana",value:function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(t){}}}]),t}(),Ib=function(){function t(e,n){u(this,t),f(this,"_eventEmitter",void 0),f(this,"_callDataReport",void 0),this._eventEmitter=e.emitter,this._callDataReport=n,this.registerListener()}return h(t,[{key:"registerListener",value:function(){this._eventEmitter.on(og.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.on(og.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(og.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(og.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(og.REJECT,this.onReject.bind(this))}},{key:"removeLister",value:function(){this._eventEmitter.off(og.CALL_END,this.onCallEnd.bind(this)),this._eventEmitter.off(og.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(og.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(og.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(og.REJECT,this.onReject.bind(this))}},{key:"onCallEnd",value:function(t){var e=t.data.totalTime,n=void 0===e?0:e;this._callDataReport.setTotalTime(n),this._callDataReport.setCallEndTime((new Date).getTime()),this._callDataReport.setResult(xg),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()}},{key:"onCallingCancel",value:function(){this._callDataReport.getResult()||this._callDataReport.setResult(Ag),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()}},{key:"onNoResponse",value:function(){this._callDataReport.setResult(kg)}},{key:"onLineBusy",value:function(){this._callDataReport.setResult(Lg)}},{key:"onReject",value:function(){this._callDataReport.setResult(Og)}}]),t}();function mb(t){return Eb.apply(this,arguments)}function Eb(){return Eb=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e===pg.AUDIO||e===pg.VIDEO){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise(function(){var t=c(a().mark((function t(n,r){var i,o,s,c,u,l;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i={microphone:!0,camera:e===pg.VIDEO},t.next=3,dT(i);case 3:if((o=t.sent)||e!==pg.AUDIO){t.next=16;break}return t.prev=5,t.next=8,wx.authorize({scope:Kg.RECORD});case 8:t.next=16;break;case 10:t.prev=10,t.t0=t.catch(5),s=Hg.MIC_TITLE,c=Hg.MIC_CONTENT,Tb(s,c),r();case 16:if(o||e!==pg.VIDEO){t.next=30;break}return t.prev=17,t.next=20,wx.authorize({scope:Kg.RECORD});case 20:return t.next=22,wx.authorize({scope:Kg.CAMERA});case 22:t.next=30;break;case 24:t.prev=24,t.t1=t.catch(17),u=Hg.CAMERA_TITLE,l=Hg.CAMERA_CONTENT,Tb(u,l),r();case 30:n();case 31:case"end":return t.stop()}}),t,null,[[5,10],[17,24]])})));return function(e,n){return t.apply(this,arguments)}}()));case 3:case"end":return t.stop()}}),t)}))),Eb.apply(this,arguments)}function Tb(t,e){wx.showModal({title:t,content:e,confirmText:Hg.CONFIRM_TEXT,success:function(t){t.confirm&&wx.openSetting()}})}var Db="TUICallEngine",bb=function(){function r(i){u(this,r),f(this,"_initReady",!1),f(this,"_timExternal",!1),this.data={config:{sdkAppID:i.sdkAppID,userID:"",userSig:"",type:1}},this.initData(),this.EVENT=og,this.MEDIA_TYPE=pg,this.CALL_TYPE=pg,this._emitter=new ag,this.TRTC=new e(this,{TUIScene:"TUICallKit"});var a="TUICallKit";try{(wx&&wx._isTIMCallKit||wx&&wx.getStorageSync&&wx.getStorageSync("_isTIMCallKit")||getApp&&getApp()&&getApp().globalData&&getApp().globalData._isTIMCallKit)&&(a="TIMCallKit")}catch(t){console.error(t)}wx.TUIScene=a,this._callDataReport=new yb({version:Ay,sdkAppId:i.sdkAppID}),this._dataReportObserver=new Ib({emitter:this._emitter},this._callDataReport),i.tim?(this.tim=i.tim,this._timExternal=!0):wx.$TIM?(this.tim=wx.$TIM,this._timExternal=!0):this.tim=n.create({SDKAppID:i.sdkAppID}),wx.$TSignaling||(wx.$TSignaling=new t({SDKAppID:i.sdkAppID,tim:this.tim,isRejectNotifyAll:!0})),wx.getSystemInfoSync().platform===Vg&&mT.warn("".concat(Fg)),wx.setStorageSync("sdkAppId",i.sdkAppID),this.TSignalingClient=new Oy({TSignaling:wx.$TSignaling}),this.TRTCCallingDelegate=new ky({emitter:this._emitter}),this._eventStatController=new xT;var o=new ET(TT);ET.bindController(this._eventStatController),o.setText("version=".concat(Ay)).setEnd(),mT.info("".concat(Db," SDK Version:").concat(Ay,", SDKAppID:").concat(i.sdkAppID))}var o,s,l,d,p,v,g,y,I,m,E,T,b,_,C,R,S,w,x,O,k,A,L,N,U,M,P,j,V,G,H,F,K,B,z,$,J;return h(r,[{key:"destroyInstance",value:function(){if(null!==r.instance&&(ab.getInstance().getAlert().checkSync(new XD({api:"destroyInstance",initReady:r.instance._initReady})),null!==r.instance)){this._callDataReport&&this._callDataReport.reset&&this._callDataReport.reset(),this._dataReportObserver&&this._dataReportObserver.reset&&this._dataReportObserver.removeLister(),r.instance.destroyed(),r.instance=null;try{wx.removeStorageSync("sdkAppId"),wx.removeStorageSync("userId")}catch(t){console.error(t)}}}},{key:"setLogLevel",value:function(t){"number"!=typeof t||isNaN(t)?mT.error("".concat(Db,",setLogLevel parameter must be a number(0~4)")):(mT.setLevel(t),this.TSignalingClient.setLogLevel(t),this.TRTC.setLogLevel(t))}},{key:"initData",value:function(){var t={callStatus:sg.IDLE,soundMode:this.data.config.type===pg.AUDIO?_g.EAR:_g.SPEAKER,active:!1,invitation:{inviteID:"",inviter:"",type:"",roomID:""},startTalkTime:0,localUser:null,remoteUsers:[],remoteID:"",timer:null,chatTimeNum:0,chatTime:"00:00:00",screen:"pusher",pusher:{},playerList:[],isInviter:!0,unHandledInviteeList:[],handledInviteeList:[],_inviterInviteID:{},_audioVideoSwitchIdList:[],_acceptedUserObject:{},isGroupCall:!1,groupID:"",switchCallModeStatus:!0,enterRoomStatus:!1,devicePermission:!1};this.data=i(i({},this.data),t)}},{key:"handleNewInvitationReceived",value:(J=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,f,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.getCallStatus(),mT.log("".concat(Db,".onNewInvitationReceived - params:"),e,"currentCallStatus:".concat(r)),i=e.data,o=i.inviter,s=i.inviteeList,c=i.data,u=i.inviteID,l=i.groupID,vT((h=JSON.parse(c)).businessID)){t.next=6;break}return t.abrupt("return");case 6:if(this.getUserID()!==o){t.next=8;break}return t.abrupt("return");case 8:if(d={inviter:o,inviteeList:s,inviteID:u,isGroupCall:f=!!l,inviteData:h,groupID:l,currentCallStatus:r,inCallUserIDs:(null==h?void 0:h.inCallUserIDs)||[]},"hangup"!==(null==h||null===(n=h.data)||void 0===n?void 0:n.cmd)){t.next=17;break}if(mT.log("".concat(Db,".hangup - params:"),o,h,this.getHandledInviteeList(),this.getUnHandledInviteeList(),r,f),r!==sg.IDLE){t.next=14;break}return t.abrupt("return");case 14:return t.next=16,this.handleHangupSignal(d);case 16:return t.abrupt("return");case 17:if(f||!this.judgeSwitchCallMode(h)){t.next=23;break}if(r===sg.IDLE||h.room_id!==this.data.invitation.roomID){t.next=22;break}return t.next=21,this.handleSwitchCallModeTSignaling(u,h);case 21:this.addAudioVideoSwitchIdList(u);case 22:return t.abrupt("return");case 23:if(r===sg.IDLE){t.next=26;break}return this.TSignalingClient.reject({inviteID:u,type:c.call_type,lineBusy:"line_busy"}),t.abrupt("return");case 26:this.handleInvitedSignal(d);case 27:case"end":return t.stop()}}),t,this)}))),function(t){return J.apply(this,arguments)})},{key:"handleHangupSignal",value:($=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,f,d,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.inviter,r=e.currentCallStatus,i=e.inviteData,o=e.inviteeList,s=this.isGroupCall(),c=this.isInviter(),r!==sg.CALLING){t.next=11;break}if(u=this.getUnHandledInviteeList(),l=this.getHandledInviteeList(),-1!==u.indexOf(n)&&this.deleteUnHandledInviteeList([n]),-1!==l.indexOf(n)){t.next=9;break}return t.abrupt("return");case 9:t.next=15;break;case 11:if(this.deleteHandledInviteeList([n]),!(-1===(h=this.getHandledInviteeList()).indexOf(n)&&h.length>1)){t.next=15;break}return t.abrupt("return");case 15:if(f=this.generateCallEndData({totalTime:i.call_end||0}),s){t.next=22;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=20,this._resetTUICallEngine();case 20:case 31:t.next=45;break;case 22:if(this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),d=this.getHandledInviteeList(),p=this.getUnHandledInviteeList(),!c){t.next=33;break}if(1!==d.length||0!==p.length){t.next=31;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=31,this._resetTUICallEngine();case 33:if(r!==sg.CALLING){t.next=40;break}if(-1!==o.indexOf(this.getUserID())&&this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),0!==d.length||1!==p.length){t.next=40;break}return this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:this.getUserID(),userID:this.getUserID()}),t.next=40,this._resetTUICallEngine();case 40:if(r!==sg.CONNECTED){t.next=45;break}if(1!==d.length||0!==p.length){t.next=45;break}return this.TRTCCallingDelegate.onCallEnd(f),t.next=45,this._resetTUICallEngine();case 45:case"end":return t.stop()}}),t,this)}))),function(t){return $.apply(this,arguments)})},{key:"handleSwitchCallModeTSignaling",value:(z=c(a().mark((function t(e,n){var r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r={inviteID:e,type:n.call_type},i={cmd:"switchToVideo"},n.call_type===pg.VIDEO&&(r.switch_to_audio_call="switch_to_audio_call",i.cmd="switchToAudio"),t.next=5,this.TSignalingClient.accept(r,i);case 5:o=t.sent,this.setSwitchCallModeStatus(!1),this.handleCallMode(n.call_type,o);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e){return z.apply(this,arguments)})},{key:"judgeSwitchCallMode",value:function(t){return t.switch_to_audio_call&&"switch_to_audio_call"===t.switch_to_audio_call||t.data&&"switchToAudio"===t.data.cmd||t.data&&"switchToVideo"===t.data.cmd}},{key:"handleCallMode",value:function(t,e){mT.log("".concat(Db,".handleCallMode - type"),t);var n=t!==pg.VIDEO;this.setPusherAttributesHandler({enableCamera:n}),n?(this.data.config.type=pg.VIDEO,this.data.invitation.type=pg.VIDEO):(this.data.config.type=pg.AUDIO,this.data.invitation.type=pg.AUDIO),this.TRTCCallingDelegate.onCallMode({type:this.data.config.type,message:e.data.message}),this.setSwitchCallModeStatus(!0)}},{key:"handleInvitedSignal",value:(B=c(a().mark((function t(e){var n,r,o,s,c,u,l,h,f,d,p;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.inviter,r=e.inviteeList,o=e.isGroupCall,s=e.groupID,c=e.inviteID,u=e.inviteData,l=e.inCallUserIDs,h=void 0===l?[]:l,this.data.remoteID=n,this.data.config.type=u.call_type,this.data.invitation.inviteID=c,this.data.invitation.inviter=n,this.data.invitation.type=u.call_type,this.data.invitation.roomID=u.room_id,this.data.isInviter=!1,this.data.isGroupCall=o,this.data.roomID=u.room_id,this.addHandledInviteeList([n]),this.addUnHandledInviteeList([].concat(D(r),D(h))),this.addAcceptedUserList(c,[n]),this.addInviterInviteId(c,[n].concat(D(r))),f=h.filter((function(t){return-1===r.indexOf(t)})),o&&(this.data.groupID=s),this.changeCallStatus(sg.CALLING),mT.log("".concat(Db," NEW_INVITATION_RECEIVED invitation: "),this.data.callStatus,this.data.invitation),d={sponsor:n,inviteeList:r,userIDList:[].concat(D(r),D(f)),isFromGroup:o,inviteID:c,groupID:s,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id},userData:u.extInfo},this.setPusherAttributesHandler({enableCamera:this.data.config.type===pg.VIDEO}),p=i(i({},p=this.getCallDataReport().getCallData()),{},{userId:this.getUserID(),roomID:u.room_id,inviteID:c,callRole:yg,callType:u.call_type,inviteeList:r}),this.getCallDataReport().setCallData(p),this.TRTCCallingDelegate.onInvited(d),t.next=26,dT({camera:!0});case 26:this.data.devicePermission=t.sent,this.data.devicePermission&&this.data.config.type===pg.VIDEO&&wx.createLivePusherContext().startPreview();case 28:case"end":return t.stop()}}),t,this)}))),function(t){return B.apply(this,arguments)})},{key:"addInviterInviteId",value:function(t,e){0!==e.length&&(0===(this.data._inviterInviteID[t]||[]).length?this.data._inviterInviteID[t]=e:this.data._inviterInviteID[t]=[].concat(D(this.data._inviterInviteID[t]),D(e)))}},{key:"handleInviteeAccepted",value:(K=c(a().mark((function t(e){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mT.log("".concat(Db," onInviteeAccepted - params:"),e),vT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=4;break}return t.abrupt("return");case 4:if(r=e.data.invitee,i=e.data.inviteID,-1!==this.getTotalInviterInviteIdList().indexOf(i)){t.next=8;break}return t.abrupt("return");case 8:if(this.data.callStatus!==sg.IDLE){t.next=10;break}return t.abrupt("return");case 10:if(this.isGroupCall()||!this.judgeSwitchCallMode(n)||this.data.switchCallModeStatus){t.next=13;break}return this.handleCallMode(this.data.invitation.type),t.abrupt("return");case 13:if(o=this.getCallStatus(),r!==this.getUserID()||o!==sg.CALLING){t.next=19;break}return this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:r,userID:r}),t.next=18,this._resetTUICallEngine();case 18:return t.abrupt("return");case 19:return this.isInviter()&&this.data.callStatus===sg.CALLING&&this.changeCallStatus(sg.CONNECTED),this.getCallDataReport().setCallAcceptTime((new Date).getTime()),this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.addAcceptedUserList(i,[r]),t.next=26,this.getUserProfile(this.data.unHandledInviteeList.map((function(t){return{userID:t}})));case 26:s=t.sent,this.TRTCCallingDelegate.onUserAccept({userID:r,userList:s});case 28:case"end":return t.stop()}}),t,this)}))),function(t){return K.apply(this,arguments)})},{key:"handleInviteeRejected",value:(F=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,f,d,p,v,g,y;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(mT.log("".concat(Db," onInviteeRejected - params"),e),r=e.data.inviteID,vT(null==(i=JSON.parse(e.data.data))?void 0:i.businessID)){t.next=5;break}return t.abrupt("return");case 5:if(this.isGroupCall()||this.getSwitchCallModeStatus()||-1===this.getAudioVideoSwitchIdList().indexOf(r)){t.next=9;break}return mT.log("".concat(Db,".onInviteeRejected - Audio and video switching is not available")),this.setSwitchCallModeStatus(!0),t.abrupt("return");case 9:if(o=e.data.invitee,s=e.data.inviter,c=this.getUserID(),u=this.getCallStatus(),-1!==this.getInviterInviteIdList().indexOf(r)){t.next=16;break}return this.deleteUnHandledInviteeList([o]),t.abrupt("return");case 16:if(u!==sg.IDLE){t.next=18;break}return t.abrupt("return");case 18:if(c!==o||u!==sg.CALLING){t.next=23;break}return this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:o,userID:o}),t.next=22,this._resetTUICallEngine();case 22:return t.abrupt("return");case 23:if(l=this.isGroupCall(),h=this.isInviter(),this.deleteUnHandledInviteeList([o]),f=this.getUnHandledInviteeList(),d=this.getHandledInviteeList(),p={inviteID:this.data.invitation.inviteID,invitee:c,userID:c},v={inviteID:this.data.invitation.inviteID,invitee:o,userID:o},g=this.data.invitation,u!==sg.CONNECTED){t.next=34;break}if(-1===d.indexOf(o)){t.next=34;break}return t.abrupt("return");case 34:if(!("line_busy"===i.line_busy||""===i.line_busy||null!=i&&null!==(n=i.data)&&void 0!==n&&n.message&&"lineBusy"===i.data.message)){t.next=48;break}if(s===g.inviter&&this.TRTCCallingDelegate.onLineBusy({inviteID:this.data.invitation.inviteID,invitee:o,userID:o}),l){t.next=42;break}return this.TRTCCallingDelegate.onCancel(p),t.next=40,this._resetTUICallEngine();case 40:t.next=46;break;case 42:if(0!==f.length||1!==d.length){t.next=46;break}return this.TRTCCallingDelegate.onCancel(p),t.next=46,this._resetTUICallEngine();case 46:case 53:t.next=74;break;case 48:if(l){t.next=55;break}return this.TRTCCallingDelegate.onReject(v),this.TRTCCallingDelegate.onCancel(p),t.next=53,this._resetTUICallEngine();case 55:if(this.TRTCCallingDelegate.onReject(v),u!==sg.CALLING){t.next=68;break}if(!h){t.next=64;break}if(0!==f.length||1!==d.length){t.next=62;break}return this.TRTCCallingDelegate.onCancel(p),t.next=62,this._resetTUICallEngine();case 62:t.next=68;break;case 64:if(1!==f.length||0!==d.length){t.next=68;break}return this.TRTCCallingDelegate.onCancel(p),t.next=68,this._resetTUICallEngine();case 68:if(u!==sg.CONNECTED){t.next=74;break}if(0!==f.length||1!==d.length){t.next=74;break}return y=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(y),t.next=74,this._resetTUICallEngine();case 74:case"end":return t.stop()}}),t,this)}))),function(t){return F.apply(this,arguments)})},{key:"handleInvitationCancelled",value:(H=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.data.invitation.inviteID===e.data.inviteID){t.next=2;break}return t.abrupt("return");case 2:if(vT(null==(n=JSON.parse(e.data.data))?void 0:n.businessID)){t.next=5;break}return t.abrupt("return");case 5:if(this.data.callStatus!==sg.IDLE){t.next=7;break}return t.abrupt("return");case 7:if(-1!==this.getInviterInviteIdList().indexOf(e.data.inviteID)){t.next=9;break}return t.abrupt("return");case 9:return mT.log(Db,"onInvitationCancelled","inviteID:".concat(e.data.inviteID," inviter:").concat(e.data.inviter," data:").concat(e.data.data)),this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:e.data.inviter,userID:e.data.inviter}),t.next=13,this._resetTUICallEngine();case 13:case"end":return t.stop()}}),t,this)}))),function(t){return H.apply(this,arguments)})},{key:"handleInvitationTimeout",value:(G=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h,f,d,p,v,g,y;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.data,i=r.inviter,o=r.inviteeList,s=void 0===o?[]:o,c=r.inviteID,u=this.getUserID(),l=this.isGroupCall(),h=this.isInviter(),f=this.getCallStatus(),this.deleteUnHandledInviteeList(s),mT.warn("".concat(Db,".onInvitationTimeout - params:"),e,"currentUserID:".concat(u," isInviter:").concat(h," isGroupCall:").concat(l," \n      currentCallStatus:").concat(f," inviteID:").concat(null==this||null===(n=this._newInvitationData)||void 0===n?void 0:n.inviteID)),-1!==this.getInviterInviteIdList().indexOf(c)){t.next=9;break}return t.abrupt("return");case 9:if(f!==sg.IDLE){t.next=11;break}return t.abrupt("return");case 11:if(d=this.getHandledInviteeList(),p=this.getUnHandledInviteeList(),v={groupID:this.data.groupID,inviteID:this.data.invitation.inviteID,sponsor:i,timeoutUserList:s,userIDList:s},g={inviteID:this.data.invitation.inviteID,invitee:u,userID:u},l){t.next=21;break}return h?(this.TRTCCallingDelegate.onNoResp(v),this.TRTCCallingDelegate.onCancel(g)):this.TRTCCallingDelegate.onCancel(g),t.next=19,this._resetTUICallEngine();case 19:t.next=44;break;case 21:if(f!==sg.CALLING){t.next=37;break}if(!h){t.next=30;break}if(this.TRTCCallingDelegate.onNoResp(v),0!==p.length){t.next=28;break}return this.TRTCCallingDelegate.onCancel(g),t.next=28,this._resetTUICallEngine();case 28:t.next=37;break;case 30:if(-1!==s.indexOf(u)){t.next=34;break}this.TRTCCallingDelegate.onNoResp(v),t.next=37;break;case 34:return this.TRTCCallingDelegate.onCancel(g),t.next=37,this._resetTUICallEngine();case 37:if(f!==sg.CONNECTED){t.next=44;break}if(this.TRTCCallingDelegate.onNoResp(v),1!==d.length||0!==p.length){t.next=44;break}return y=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(y),t.next=44,this._resetTUICallEngine();case 44:case"end":return t.stop()}}),t,this)}))),function(t){return G.apply(this,arguments)})},{key:"handleSDKReady",value:function(){var t=this;mT.log(Db,"TSignaling SDK ready"),this.TSignalingResolve(),this.TRTCCallingDelegate.onSdkReady({message:"SDK ready"}),this.tim.getMyProfile().then((function(e){t.data.localUser=e.data})).catch((function(t){mT.warn("getMyProfile error:",t)}))}},{key:"handleKickedOut",value:(V=c(a().mark((function t(){var e,n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.CONNECTED){t.next=5;break}return e=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(e),t.next=5,this._resetTUICallEngine();case 5:if(this.getCallStatus()!==sg.CALLING){t.next=12;break}return n=this.getUserID(),this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:n,userID:n}),t.next=10,this.cancel();case 10:return t.next=12,this._resetTUICallEngine();case 12:this._initReady=!1,this.TRTCCallingDelegate.onKickedOut({message:"kicked out"});case 14:case"end":return t.stop()}}),t,this)}))),function(){return V.apply(this,arguments)})},{key:"_addTSignalingEvent",value:function(){wx.$TSignaling.on(t.EVENT.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived,this),wx.$TSignaling.on(t.EVENT.INVITEE_ACCEPTED,this.handleInviteeAccepted,this),wx.$TSignaling.on(t.EVENT.INVITEE_REJECTED,this.handleInviteeRejected,this),wx.$TSignaling.on(t.EVENT.INVITATION_CANCELLED,this.handleInvitationCancelled,this),wx.$TSignaling.on(t.EVENT.INVITATION_TIMEOUT,this.handleInvitationTimeout,this),wx.$TSignaling.on(t.EVENT.SDK_READY,this.handleSDKReady,this),wx.$TSignaling.on(t.EVENT.KICKED_OUT,this.handleKickedOut,this),t.EVENT.MESSAGE_SENT_BY_ME&&wx.$TSignaling.on(t.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)}},{key:"_removeTSignalingEvent",value:function(){wx.$TSignaling.off(t.EVENT.NEW_INVITATION_RECEIVED,this.handleNewInvitationReceived),wx.$TSignaling.off(t.EVENT.INVITEE_ACCEPTED,this.handleInviteeAccepted),wx.$TSignaling.off(t.EVENT.INVITEE_REJECTED,this.handleInviteeRejected),wx.$TSignaling.off(t.EVENT.INVITATION_CANCELLED,this.handleInvitationCancelled),wx.$TSignaling.off(t.EVENT.INVITATION_TIMEOUT,this.handleInvitationTimeout),wx.$TSignaling.off(t.EVENT.SDK_READY,this.handleSDKReady),wx.$TSignaling.off(t.EVENT.KICKED_OUT,this.handleKickedOut),t.EVENT.MESSAGE_SENT_BY_ME&&wx.$TSignaling.off(t.EVENT.MESSAGE_SENT_BY_ME,this.onMessageSentByMe,this)}},{key:"onRemoteUserJoin",value:(j=c(a().mark((function t(e){var n,r,i,o;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.data,r=n.userID,i=n.userList,o=n.playerList,mT.log(Db,"REMOTE_USER_JOIN",e,r),this.addHandledInviteeList([r]),this.deleteUnHandledInviteeList([r]),this.changeCallStatus(sg.CONNECTED),!(o.length>0)){t.next=11;break}return t.next=8,this.getUserProfile(o);case 8:t.t0=t.sent,t.next=12;break;case 11:t.t0=this.data.playerList;case 12:this.data.playerList=t.t0,this.data.startTalkTime||(this.data.startTalkTime=Date.now()),this.TRTCCallingDelegate.onUserEnter({userID:e.data.userID,playerList:this.data.playerList}),mT.log(Db,"REMOTE_USER_JOIN","playerList:",this.data.playerList,"userList:",i);case 16:case"end":return t.stop()}}),t,this)}))),function(t){return j.apply(this,arguments)})},{key:"onRemoteUserLeave",value:(P=c(a().mark((function t(e){var n,r,i,o,s,c;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.IDLE){t.next=2;break}return t.abrupt("return");case 2:if(n=e.data.userID,mT.log(Db,"REMOTE_USER_LEAVE",e,e.data.userID),this.deleteHandledInviteeList([n]),this.data.playerList=this.data.playerList.filter((function(t){return t.userID!==n})),this.TRTCCallingDelegate.onUserLeave({userID:n,playerList:this.data.playerList}),this.getCallDataReport().setExitRoomTime((new Date).getTime()),this.data.isGroupCall){t.next=17;break}return t.next=11,this.TSignalingClient.hangup({userIDList:[n],callType:this.data.config.type,callEnd:Math.round((Date.now()-this.data.startTalkTime)/1e3)});case 11:return r=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(r),mT.log(Db,"REMOTE_USER_LEAVE","playerList:"),t.next=16,this._resetTUICallEngine();case 16:return t.abrupt("return");case 17:if(i=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),s=this.getUserID(),1!==i.length||i[0]!==s||0!==o.length){t.next=25;break}return c=this.generateCallEndData(),this.TRTCCallingDelegate.onCallEnd(c),t.next=25,this._resetTUICallEngine();case 25:case"end":return t.stop()}}),t,this)}))),function(t){return P.apply(this,arguments)})},{key:"onLocalNetStateUpdate",value:function(t){var e=t.data.pusher.netStatus;mT.log(Db,"onLocalNetStateUpdate",e),this.data.pusher=t.data.pusher,this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onRemoteNetStateUpdate",value:(M=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.data.playerList,mT.log(Db,"onRemoteNetStateUpdate",n),this.data.playerList=this._updateUserProfile(this.data.playerList,n),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return M.apply(this,arguments)})},{key:"onError",value:function(t){mT.warn(Db,"onError",t),this.TRTCCallingDelegate.onError(t)}},{key:"onRemoteVideoAdd",value:function(t){mT.log("* room REMOTE_VIDEO_ADD",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!1})}},{key:"onRemoteVideoRemove",value:function(t){mT.log("* room REMOTE_VIDEO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"onRemoteAudioAdd",value:(U=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return mT.log("* room REMOTE_AUDIO_ADD",e),t.next=3,this.getUserProfile([e.data.player]);case 3:n=t.sent,this.setPlayerAttributesHandler(n[0],{muteAudio:!1});case 5:case"end":return t.stop()}}),t,this)}))),function(t){return U.apply(this,arguments)})},{key:"onRemoteAudioRemove",value:function(t){mT.log("* room REMOTE_AUDIO_REMOVE",t);var e=t.data.player;this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"onRemoteAudioVolumeUpdate",value:(N=c(a().mark((function t(e){var n;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:mT.log("* room REMOTE_AUDIO_VOLUME_UPDATE",e),n=e.data.playerList,this.data.playerList=this._updateUserProfile(this.data.playerList,n),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 4:case"end":return t.stop()}}),t,this)}))),function(t){return N.apply(this,arguments)})},{key:"onLocalAudioVolumeUpdate",value:function(t){var e=t.data.pusher;this.data.pusher=e,this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"onMessageSentByMe",value:function(t){this.TRTCCallingDelegate.onMessageSentByMe(t)}},{key:"_addTRTCEvent",value:function(){this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate,this),this.TRTC.on(this.TRTC.EVENT.ERROR,this.onError,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove,this),this.TRTC.on(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate,this),this.TRTC.on(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate,this)}},{key:"_removeTRTCEvent",value:function(){this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_JOIN,this.onRemoteUserJoin),this.TRTC.off(this.TRTC.EVENT.REMOTE_USER_LEAVE,this.onRemoteUserLeave),this.TRTC.off(this.TRTC.EVENT.LOCAL_NET_STATE_UPDATE,this.onLocalNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.REMOTE_NET_STATE_UPDATE,this.onRemoteNetStateUpdate),this.TRTC.off(this.TRTC.EVENT.ERROR,this.onError),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_ADD,this.onRemoteVideoAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_VIDEO_REMOVE,this.onRemoteVideoRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_ADD,this.onRemoteAudioAdd),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_REMOVE,this.onRemoteAudioRemove),this.TRTC.off(this.TRTC.EVENT.REMOTE_AUDIO_VOLUME_UPDATE,this.onRemoteAudioVolumeUpdate),this.TRTC.off(this.TRTC.EVENT.LOCAL_AUDIO_VOLUME_UPDATE,this.onLocalAudioVolumeUpdate)}},{key:"initTRTC",value:function(){var t=this.TRTC.createPusher({beautyLevel:5});this.data.pusher=t.pusherAttributes}},{key:"enterRoom",value:function(t){this._addTRTCEvent();var e=t.roomID,n=Object.assign(this.data.config,{roomID:e,enableMic:!0,autopush:!0,enableAgc:!0,enableAns:!0,enableCamera:t.callType===pg.VIDEO});this.data.enterRoomStatus=!0,this.data.pusher=this.TRTC.enterRoom(n),wx.createLivePusherContext().startPreview(),this.getCurrentPusherInstance().start()}},{key:"exitRoom",value:(L=c(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getCurrentPusherInstance().stop();case 2:return t.next=4,this.TRTC.exitRoom();case 4:e=t.sent,this.data.pusher=e.pusher,this.data.playerList=e.playerList,this.data.unHandledInviteeList=[],this.data.enterRoomStatus=!1,this.initTRTC(),this._removeTRTCEvent();case 11:case"end":return t.stop()}}),t,this)}))),function(){return L.apply(this,arguments)})},{key:"setPusherAttributesHandler",value:function(t){this.data.pusher=this.TRTC.setPusherAttributes(t),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList})}},{key:"setPlayerAttributesHandler",value:(A=c(a().mark((function t(e,n){var r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=this.TRTC.setPlayerAttributes(e.streamID,n),mT.warn("setPlayerAttributesHandler",r),this.data.playerList=r.length>0?this._updateUserProfile(this.data.playerList,r):this.data.playerList,this.data.playerList.length>0&&0===r.length&&(this.data.playerList[0].hasAudio=!1,this.data.playerList[0].hasVideo=!1),this.TRTCCallingDelegate.onUserUpdate({pusher:this.data.pusher,playerList:this.data.playerList});case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return A.apply(this,arguments)})},{key:"_mutePlayerAudio",value:function(t){var e=t.currentTarget.dataset.value;e.hasAudio&&e.muteAudio?this.setPlayerAttributesHandler(e,{muteAudio:!1}):!e.hasAudio||e.muteAudio||this.setPlayerAttributesHandler(e,{muteAudio:!0})}},{key:"_mutePlayerVideo",value:function(t){var e=t.currentTarget.dataset.value;e.hasVideo&&e.muteVideo?this.setPlayerAttributesHandler(e,{muteVideo:!1}):!e.hasVideo||e.muteVideo||this.setPlayerAttributesHandler(e,{muteVideo:!0})}},{key:"_pusherAudioHandler",value:function(){this.data.pusher.enableMic?(this.setPusherAttributesHandler({enableMic:!1}),this.getCurrentPusherInstance().setMICVolume({volume:0})):(this.setPusherAttributesHandler({enableMic:!0}),this.getCurrentPusherInstance().setMICVolume({volume:100}))}},{key:"_pusherVideoHandler",value:function(){this.data.pusher.enableCamera?this.setPusherAttributesHandler({enableCamera:!1}):this.setPusherAttributesHandler({enableCamera:!0})}},{key:"init",value:(k=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return ab.getInstance().getAlert().checkSync(new XD({api:"init",attributes:e})),t.next=3,this.login(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return k.apply(this,arguments)})},{key:"login",value:(O=c(a().mark((function t(e){var n=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.data.config.userID=e.userID,this.data.config.userSig=e.userSig,t.abrupt("return",new Promise((function(t,r){wx.$TSignaling.login({userID:e.userID,userSig:e.userSig}).then((function(r){return mT.log(Db,"login","IM login success",r),wx.setStorageSync("userId","".concat(e.userID)),n._callDataReport.setUserID(e.userID),n._initReady=!0,n._resetTUICallEngine(),n._addTSignalingEvent(),n.initTRTC(),n.TSignalingResolve=t,r.data.repeatLogin&&t(null),null}))})));case 3:case"end":return t.stop()}}),t,this)}))),function(t){return O.apply(this,arguments)})},{key:"logout",value:(x=c(a().mark((function t(){var e,n,r;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.data.config,n=e.userID,r=e.userSig,t.prev=1,t.next=4,wx.$TSignaling.logout({userID:n,userSig:r});case 4:mT.log(Db,"logout","IM logout success"),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),mT.error(Db,"logout","IM logout failure");case 10:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(){return x.apply(this,arguments)})},{key:"on",value:function(t,e,n){ab.getInstance().getAlert().checkSync(new XD({api:"on",attributes:{eventCode:t,handler:e,context:n},initReady:this._initReady})),this._emitter.on(t,e,n)}},{key:"off",value:function(t,e){ab.getInstance().getAlert().checkSync(new XD({api:"off",attributes:{eventCode:t,handler:e}})),this._emitter.off(t,e)}},{key:"call",value:(w=c(a().mark((function t(e){var n,r,o,s,c,u;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.userID,r=e.type,t.next=3,ab.getInstance().getAlert().check(new XD({api:"call",attributes:e,initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:Cg.BASE}),{tim:this.tim});case 3:return t.prev=3,t.next=6,mb(r);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:if(this.getUserID()!==n){t.next=14;break}throw mT.log("".concat(Db,".call failed. Called id can't be yourself. userId:").concat(this.getUserID(),", inviteeId:").concat(n)),new Error("".concat(Db,".call failed. Called id can't be yourself. userId:").concat(this.getUserID(),", inviteeId:").concat(n));case 14:return this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(Ug),t.prev=16,o=e.roomID||Math.floor(2147483646*Math.random()+1),this.data.roomID=o,t.next=21,this.TSignalingClient.invite(i(i({},e),{},{roomID:o}));case 21:if(s=t.sent,this.enterRoom({roomID:o,callType:r}),this._callDataReport.setEnterRoomTime((new Date).getTime()),c=i(i({},c=this._callDataReport.getCallData()),{},{userId:n,roomID:o,callRole:gg,callType:r,inviteeList:[n]}),this._callDataReport.setCallData(c),this._callDataReport.setSendSignalingTime((new Date).getTime()),mT.log("".concat(Db," call(userID: ").concat(n,", type: ").concat(r,") success, ").concat(s)),u="callType: ".concat(r+1,",\n      conversationType: ").concat(s.data.message.conversationType,",\n      userId:{ ").concat(s.data.message.from," } invite userId:{ ").concat(s.data.message.to," }"),0!==s.code){t.next=35;break}this._callDataReport.setInviteID(s.inviteID),this._setInterfaceUpLoad(DT).setCallType(r+1).setText("".concat(u," succeeded")).setEnd(),t.next=40;break;case 35:return this._callDataReport.setCodeAndMessage(s.code,s.message),this._callDataReport.uploadToKibana(),this._setInterfaceUpLoad(DT).setCallType(r+1).setText("".concat(u," failed")).setEnd(),t.next=40,this._resetTUICallEngine();case 40:return this.data.config.type=r,this.data.invitation.inviteID=s.inviteID,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=r,this.data.invitation.roomID=o,this.data.isInviter=!0,this.data.remoteID=n,this.changeCallStatus(sg.CALLING),this.addInviterInviteId(s.inviteID,[this.data.config.userID,n]),this.addUnHandledInviteeList([n]),this.addHandledInviteeList([this.getUserID()]),t.abrupt("return",{data:s.data,pusher:this.data.pusher});case 54:return t.prev=54,t.t1=t.catch(16),this._callDataReport.setCodeAndMessage(Ty.NOT_MEDIA_ACCESS,JSON.stringify(t.t1)),this._callDataReport.uploadToKibana(),mT.error("".concat(Db," call(userID:").concat(n,",type:").concat(r,") failed', error: ").concat(t.t1)),t.next=61,this._resetTUICallEngine();case 61:throw new Error(t.t1);case 62:case"end":return t.stop()}}),t,this,[[3,8],[16,54]])}))),function(t){return w.apply(this,arguments)})},{key:"groupCall",value:(S=c(a().mark((function t(e){var n,r,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.type,r=e.userIDList,t.next=3,ab.getInstance().getAlert().check(new XD({api:"groupCall",attributes:e,initReady:this._initReady,callStatus:this.data.callStatus,capabilityCode:Cg.PRO}),{tim:this.tim});case 3:return t.prev=3,t.next=6,mb(n);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:if(-1===r.indexOf(this.getUserID())){t.next=13;break}throw new Error("".concat(Db,".groupCall failed. Called list can't contain yourself. userID:").concat(this.getUserID(),", inviteeIDList:").concat(r));case 13:return this._callDataReport.setCallScene(Mg),o=e.roomID||Math.floor(2147483646*Math.random()+1),this.enterRoom({roomID:o,callType:n}),t.prev=16,t.next=19,this.TSignalingClient.inviteGroup(i(i({},e),{},{roomID:o}));case 19:return s=t.sent,this.data.config.type=e.type,this.data.invitation.inviteID=s.inviteID,this.data.invitation.inviter=this.data.config.userID,this.data.invitation.type=n,this.data.invitation.roomID=o,this.data.isInviter=!0,this.data.isGroupCall=!0,this.data.groupID=e.groupID,this.data.roomID=o,this.addUnHandledInviteeList(e.userIDList),this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(sg.CALLING),this.addInviterInviteId(s.inviteID,[this.data.config.userID].concat(D(e.userIDList))),mT.log(Db,"groupCall OK",s),t.abrupt("return",{data:s.data,pusher:this.data.pusher});case 37:return t.prev=37,t.t1=t.catch(16),mT.error(Db,"groupCall failed",t.t1),t.next=42,this._resetTUICallEngine();case 42:throw new Error(t.t1);case 43:case"end":return t.stop()}}),t,this,[[3,8],[16,37]])}))),function(t){return S.apply(this,arguments)})},{key:"joinInGroupCall",value:(R=c(a().mark((function t(e){var n,r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.roomID,r=e.type,i=e.groupID,t.next=3,ab.getInstance().getAlert().check(new XD({api:"joinInGroupCall",attributes:e,initReady:this._initReady,capabilityCode:Cg.PRO}),{tim:this.tim});case 3:return t.prev=3,t.next=6,mb(r);case 6:t.next=11;break;case 8:return t.prev=8,t.t0=t.catch(3),t.abrupt("return");case 11:return t.prev=11,this.data.config.type=r,this.data.invitation.type=r,mT.log("".concat(Db,".joinInGroupCall  roomID:").concat(n,",type:").concat(r,",userID:").concat(this.getUserID())),this.changeCallStatus(sg.CALLING),this.addHandledInviteeList([this.getUserID()]),this.data.groupID=i,this.data.roomID=n,this.data.isGroupCall=!0,this.data.isInviter=!1,this.enterRoom({roomID:n,callType:r}),t.abrupt("return",this.data.pusher);case 25:return t.prev=25,t.t1=t.catch(11),t.next=29,this._resetTUICallEngine();case 29:throw new Error("".concat(Db,".joinInGroupCall failed error: ").concat(t.t1));case 30:case"end":return t.stop()}}),t,this,[[3,8],[11,25]])}))),function(t){return R.apply(this,arguments)})},{key:"inviteUser",value:(C=c(a().mark((function t(e){var n,r,i,o,s,c,u,l,h=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ab.getInstance().getAlert().check(new XD({api:"inviteUser",attributes:e,initReady:this._initReady,capabilityCode:Cg.PRO}),{tim:this.tim});case 2:if(n=e.userIDList,r=void 0===n?[]:n,this.isGroupCall()){t.next=6;break}throw mT.error("".concat(Db,".inviteUser - groupID:").concat(this.data.groupID,", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType)),new Error("".concat(Db,".inviteUser - groupID:").concat(this.data.groupID,", roomID:").concat(this.data.roomID,", type:").concat(this.data.callType));case 6:if(this.isInviter()||this.data.callStatus===sg.CONNECTED){t.next=9;break}throw mT.error("".concat(Db,".inviteUser - current status:").concat(this.data.callStatus," not support")),new Error("".concat(Db,".inviteUser - current status:").concat(this.data.callStatus," not support"));case 9:if(0!==r.length){t.next=12;break}throw mT.error("".concat(Db,".inviteUser - userIDList is empty")),new Error("".concat(Db,".inviteUser - userIDList is empty"));case 12:if(i=this.getHandledInviteeList(),o=this.getUnHandledInviteeList(),s=[].concat(D(i),D(o)),0!==(c=r.filter((function(t){return-1===s.indexOf(t)}))).length){t.next=19;break}return mT.error("".concat(Db,".inviteUser failed - userIDList in call list. userIDList:").concat(JSON.stringify(r))),t.abrupt("return",Promise.reject("".concat(Db,".inviteUser failed - userIDList in call list. userIDList:").concat(JSON.stringify(r))));case 19:return r=c,t.prev=20,u=this.data.handledInviteeList.filter((function(t){return t!==h.getUserID()})),t.next=24,this.TSignalingClient.inviteGroup({groupID:this.data.groupID,userIDList:r,type:this.data.invitation.type,roomID:this.data.roomID,timeout:this.data.callTimeout,inCallUserIDs:[].concat(D(this.data.unHandledInviteeList),D(u))});case 24:if(l=t.sent,mT.log("inviteUser res",l),0!==l.code){t.next=30;break}return this.addUnHandledInviteeList(r),this.addInviterInviteId(l.inviteID,[this.data.config.userID].concat(D(r))),t.abrupt("return",l);case 30:t.next=35;break;case 32:throw t.prev=32,t.t0=t.catch(20),new Error("".concat(Db,".inviteUser failed, userId:").concat(this.getUserID(),", inviteeIdList:").concat(r,", error: ").concat(t.t0));case 35:case"end":return t.stop()}}),t,this,[[20,32]])}))),function(t){return C.apply(this,arguments)})},{key:"accept",value:(_=c(a().mark((function t(){var e=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ab.getInstance().getAlert().check(new XD({api:"accept",initReady:this._initReady,callStatus:this.data.callStatus}));case 2:return t.prev=2,t.next=5,mb(this.data.config.type);case 5:t.next=10;break;case 7:return t.prev=7,t.t0=t.catch(2),t.abrupt("return");case 10:return t.abrupt("return",new Promise((function(t,n){if(mT.log(Db,"accept() inviteID: ",e.data.invitation.inviteID),e.data.config.type!==pg.VIDEO||e.data.isGroupCall)e.handleAccept(t,n);else if(e.data.devicePermission){wx.createLivePusherContext().stopPreview();var r=setTimeout(c(a().mark((function i(){return a().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:clearTimeout(r),e.handleAccept(t,n);case 2:case"end":return i.stop()}}),i)}))),0)}else e.handleAccept(t,n)})));case 11:case"end":return t.stop()}}),t,this,[[2,7]])}))),function(){return _.apply(this,arguments)})},{key:"handleAccept",value:(b=c(a().mark((function t(e,n){var r,i;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._callDataReport.setEnterRoomTime((new Date).getTime()),this.enterRoom({roomID:this.data.invitation.roomID,callType:this.data.config.type}),r=this.data.invitation.inviteID,t.next=5,this.TSignalingClient.accept({inviteID:r,type:this.data.config.type});case 5:0===(i=t.sent).code?(mT.log(Db,"accept OK"),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(r,[this.getUserID()]),e({message:i.data.message,pusher:this.data.pusher}),this.changeCallStatus(sg.CONNECTED)):(this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(Ty.NOT_MEDIA_ACCESS,JSON.stringify(i.data.message)),this._callDataReport.uploadToKibana()),mT.error(Db,"accept failed",i),n(i),this._resetTUICallEngine());case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return b.apply(this,arguments)})},{key:"reject",value:(T=c(a().mark((function t(){var e;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ab.getInstance().getAlert().checkSync(new XD({api:"reject",callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(!this.data.invitation.inviteID){t.next=11;break}return t.next=5,this.TSignalingClient.reject({inviteID:this.data.invitation.inviteID,type:this.data.config.type});case 5:return e=t.sent,mT.log(Db,"reject OK",e),this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:this.getUserID(),userID:this.getUserID()}),t.next=10,this._resetTUICallEngine();case 10:return t.abrupt("return",e);case 11:return mT.warn("".concat(Db," 未收到邀请，无法拒绝")),t.abrupt("return","未收到邀请，无法拒绝");case 13:case"end":return t.stop()}}),t,this)}))),function(){return T.apply(this,arguments)})},{key:"hangup",value:(E=c(a().mark((function t(){var e,n,r,i,o,s,c,u,l,h,f,d,p,v,g,y,I,m=this;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ab.getInstance().getAlert().checkSync(new XD({api:"hangup",callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(mT.warn("".concat(Db,". - callStatus:").concat(this.data.callStatus," _inviterInviteID:").concat(JSON.stringify(this.data.invitation))),this.data.callStatus!==sg.IDLE){t.next=5;break}throw new Error("".concat(Db,".hangup failed. current status:").concat(this.data.callStatus));case 5:if(this.data.callStatus!==sg.CALLING||0!==this.getInviterInviteIdList().length){t.next=7;break}throw new Error("".concat(Db,".call/groupCall incomplete。please wait cancel"));case 7:if(e=this.isGroupCall(),n=this.isInviter(),r=this.getUserID(),i=Math.round((Date.now()-this.data.startTalkTime)/1e3),o=this.getCallType(),c=this.getInviterInviteIdList(),this.data.callStatus!==sg.CONNECTED){t.next=27;break}if(t.prev=14,0!==c.length){t.next=20;break}return u=this.generateCallEndData({callMediaType:o,totalTime:i}),this.TRTCCallingDelegate.onCallEnd(u),t.next=20,this._resetTUICallEngine();case 20:t.next=27;break;case 22:return t.prev=22,t.t0=t.catch(14),t.next=26,this._resetTUICallEngine();case 26:throw new Error(t.t0);case 27:if(l=this.getHandledInviteeList(),h=this.getUnHandledInviteeList(),t.prev=29,e){t.next=48;break}if(f=this.generateCallEndData(),!n){t.next=43;break}if(1!==h.length){t.next=40;break}return t.next=36,this.cancel();case 36:s=t.sent,this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:r,userID:r}),t.next=41;break;case 40:this.TRTCCallingDelegate.onCallEnd(f);case 41:t.next=44;break;case 43:this.TRTCCallingDelegate.onCallEnd(f);case 44:return t.next=46,this._resetTUICallEngine();case 46:t.next=77;break;case 48:if(d=this.getCallStatus(),p={callType:this.getCallType(),isGroupCall:this.isGroupCall(),groupID:this.data.groupID,userIDList:[].concat(D(l.filter((function(t){return t!==r}))),D(h)),callEnd:Math.round((Date.now()-this.data.startTalkTime)/1e3)},!n){t.next=68;break}if(d!==sg.CALLING){t.next=58;break}return t.next=54,this.cancel(this.getInviterInviteIdList());case 54:return s=t.sent,this.TRTCCallingDelegate.onCancel({inviteID:this.data.invitation.inviteID,invitee:r,userID:r}),t.next=58,this._resetTUICallEngine();case 58:if(d!==sg.CONNECTED){t.next=66;break}v=a().mark((function t(){var e,n,i,o,u,f,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c[g],n=m.getInviterInviteIdUserList(e),!((i=m.getAcceptedUserList(e)).length>0)){t.next=14;break}return o=i.filter((function(t){return-1!==l.indexOf(t)})),u=n.filter((function(t){return-1!==h.indexOf(t)})),p.userIDList=[].concat(D(o),D(u)).filter((function(t){return t!==r})),mT.warn("inviter emit hangup signal, notify userIDList:".concat(JSON.stringify(p.userIDList))),t.next=9,m.TSignalingClient.hangup(p);case 9:s=t.sent,f=m.generateCallEndData(),m.TRTCCallingDelegate.onCallEnd(f),t.next=21;break;case 14:if(d=m.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==d.indexOf(t)})).length>0)){t.next=21;break}return mT.warn("inviter emit cancel signal, userIdList:".concat(n)),t.next=20,m.cancel([e]);case 20:s=t.sent;case 21:case"end":return t.stop()}}),t)})),g=0;case 61:if(!(g<c.length)){t.next=66;break}return t.delegateYield(v(),"t1",63);case 63:g++,t.next=61;break;case 66:t.next=75;break;case 68:y=a().mark((function t(){var e,n,i,o,u,f,d;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=c[I],n=m.getInviterInviteIdUserList(e),!((i=m.getAcceptedUserList(e)).length>0)){t.next=14;break}return o=i.filter((function(t){return-1!==l.indexOf(t)})),u=n.filter((function(t){return-1!==h.indexOf(t)})),p.userIDList=[].concat(D(o),D(u)).filter((function(t){return t!==r})),mT.warn("invitee emit hangup signal, notify userIDList:".concat(JSON.stringify(p.userIDList))),t.next=9,m.TSignalingClient.hangup(p);case 9:s=t.sent,f=m.generateCallEndData(),m.TRTCCallingDelegate.onCallEnd(f),t.next=21;break;case 14:if(d=m.getUnHandledInviteeList(),!(n.filter((function(t){return-1!==d.indexOf(t)})).length>0)){t.next=21;break}return mT.warn("invitee emit cancel signal, inviteID:".concat(e)),t.next=20,m.cancel([e]);case 20:s=t.sent;case 21:case"end":return t.stop()}}),t)})),I=0;case 70:if(!(I<c.length)){t.next=75;break}return t.delegateYield(y(),"t2",72);case 72:I++,t.next=70;break;case 75:return t.next=77,this._resetTUICallEngine();case 77:return t.abrupt("return",s);case 80:throw t.prev=80,t.t3=t.catch(29),mT.warn("".concat(Db,".hangup failed, error: ").concat(t.t3)),new Error("".concat(Db,".hangup failed, error: ").concat(t.t3));case 84:case"end":return t.stop()}}),t,this,[[14,22],[29,80]])}))),function(){return E.apply(this,arguments)})},{key:"cancel",value:(m=c(a().mark((function t(e){var n,r,i,o,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:mT.log("_cancel _inviterInviteID",this.data_inviterInviteID),n=[],t.prev=2,0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),r=0;case 5:if(!(r<e.length)){t.next=14;break}return i=e[r],t.next=9,this.TSignalingClient.cancel({inviteID:i,callType:this.data.invitation.type});case 9:o=t.sent,n.push(o);case 11:r++,t.next=5;break;case 14:t.next=19;break;case 16:throw t.prev=16,t.t0=t.catch(2),new Error("".concat(Db,"._cancel failed, error: ").concat(t.t0));case 19:return s="cancel ".concat(JSON.stringify(n)," succeeded"),mT.log("".concat(Db,"._cancel ").concat(s)),t.abrupt("return",n);case 22:case"end":return t.stop()}}),t,this,[[2,16]])}))),function(t){return m.apply(this,arguments)})},{key:"getRoomID",value:function(){return this.data.invitation.roomID}},{key:"getCallType",value:function(){return this.data.invitation.type}},{key:"isGroupCall",value:function(){return this.data.isGroupCall}},{key:"getUserID",value:function(){return this.data.config.userID}},{key:"isInviter",value:function(){return this.data.isInviter}},{key:"getHandledInviteeList",value:function(){return this.data.handledInviteeList||[]}},{key:"getCallDataReport",value:function(){return this._callDataReport}},{key:"getUnHandledInviteeList",value:function(){return this.data.unHandledInviteeList||[]}},{key:"getCallStatus",value:function(){return this.data.callStatus}},{key:"getInviterInviteID",value:function(t){return this.data._inviterInviteID[t]||[]}},{key:"addAcceptedUserList",value:function(t,e){var n=this;if(0!==e.length)if(t)0===(this.data._acceptedUserObject[t]||[]).length?this.data._acceptedUserObject[t]=e:e.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}));else for(var r=this.getInviterInviteIdList(),i=function(){var t=r[a],i=n.getInviterInviteIdUserList(t),o=e.filter((function(t){return-1!==i.indexOf(t)}));0===(n._acceptedUserObject[t]||[]).length?n.data._acceptedUserObject[t]=o:o.forEach((function(e){-1===n.data._acceptedUserObject[t].indexOf(e)&&n.data._acceptedUserObject[t].push(e)}))},a=0;a<r.length;a++)i()}},{key:"getAcceptedUserList",value:function(t){return this.data._acceptedUserObject[t]||[]}},{key:"getInviterInviteIdList",value:function(){return Object.keys(this.data._inviterInviteID||{})}},{key:"getTotalInviterInviteIdList",value:function(){var t=this.getInviterInviteIdList();return[].concat(D(this.data._audioVideoSwitchIdList),D(t))}},{key:"getInviterInviteIdUserList",value:function(t){return this.data._inviterInviteID[t]||[]}},{key:"addAudioVideoSwitchIdList",value:function(t){t&&this.data._audioVideoSwitchIdList.push(t)}},{key:"getAudioVideoSwitchIdList",value:function(){return this.data._audioVideoSwitchIdList||[]}},{key:"addUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.unHandledInviteeList.indexOf(t)&&e.data.unHandledInviteeList.push(t)})),this.data.unHandledInviteeList=Array.from(new Set(this.data.unHandledInviteeList)))}},{key:"deleteUnHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.unHandledInviteeList=e.data.unHandledInviteeList.filter((function(e){return e!==t}))}))}},{key:"addHandledInviteeList",value:function(t){var e=this;0!==t.length&&(t.forEach((function(t){-1===e.data.handledInviteeList.indexOf(t)&&e.data.handledInviteeList.push(t)})),this.data.handledInviteeList=Array.from(new Set(this.data.handledInviteeList)))}},{key:"deleteHandledInviteeList",value:function(t){var e=this;0!==t.length&&t.forEach((function(t){e.data.handledInviteeList=e.data.handledInviteeList.filter((function(e){return e!==t}))}))}},{key:"getSwitchCallModeStatus",value:function(){return this.data.switchCallModeStatus}},{key:"changeCallStatus",value:function(t){var e=this;switch(mT.log("进入callStatus",t),this.data.callStatus=t,t){case sg.CONNECTED:if(this.data.timer)return;this.data.timer=setInterval((function(){var t,n,r,i,a,o;e.data.chatTime=(t=e.data.chatTimeNum,(o=t)>=3600?(r=parseInt(o/3600)<10?"0".concat(parseInt(o/3600)):parseInt(o/3600),i=parseInt(o%60/60)<10?"0".concat(parseInt(o%60/60)):parseInt(o%60/60),(a=o%3600<10?"0".concat(o%3600):o%3600)>60&&(i=parseInt(a/60)<10?"0".concat(parseInt(a/60)):parseInt(a/60),a=a%60<10?"0".concat(a%60):a%60),n="".concat(r,":").concat(i,":").concat(a)):o>=60&&o<3600?(i=parseInt(o/60)<10?"0".concat(parseInt(o/60)):parseInt(o/60),a=o%60<10?"0".concat(o%60):o%60,n="00:".concat(i,":").concat(a)):o<60&&(a=o<10?"0".concat(o):o,n="00:00:".concat(a)),n),e.data.chatTimeNum+=1,e.data.pusher.chatTime=e.data.chatTime,e.data.pusher.chatTimeNum=e.data.chatTimeNum,e.TRTCCallingDelegate.onUserUpdate({pusher:e.data.pusher,playerList:e.data.playerList})}),1e3);break;case sg.IDLE:clearInterval(this.data.timer),this.data.timer=null,this.data.chatTime="00:00:00",this.data.chatTimeNum=0}}},{key:"_resetTUICallEngine",value:(I=c(a().mark((function t(e,n){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.changeCallStatus(sg.IDLE),mT.log(Db," _resetTUICallEngine()",this.data.enterRoomStatus),!this.data.enterRoomStatus){t.next=5;break}return t.next=5,this.exitRoom(e,n);case 5:this.data.config.type=pg.AUDIO,this.initData();case 7:case"end":return t.stop()}}),t,this)}))),function(t,e){return I.apply(this,arguments)})},{key:"startRemoteView",value:(y=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.data.playerList.forEach((function(t){if(t.userID===e)return t.muteVideo=!1,void mT.log("".concat(Db,", startRemoteView(").concat(e,")"))}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return y.apply(this,arguments)})},{key:"stopRemoteView",value:function(t){this.data.playerList.forEach((function(e){if(e.userID===t)return e.muteVideo=!0,void mT.log("".concat(Db,", stopRemoteView(").concat(t,")"))}))}},{key:"openCamera",value:function(){ab.getInstance().getAlert().checkSync(new XD({api:"openCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera||this._pusherVideoHandler(),mT.log("".concat(Db,", openCamera() pusher: ").concat(this.data.pusher))}},{key:"closeCamera",value:function(){ab.getInstance().getAlert().checkSync(new XD({api:"closeCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableCamera&&this._pusherVideoHandler(),mT.log("".concat(Db,", closeCamera() pusher: ").concat(this.data.pusher))}},{key:"switchCamera",value:function(){ab.getInstance().getAlert().checkSync(new XD({api:"switchCamera",callStatus:this.data.callStatus,initReady:this._initReady})),this.getCurrentPusherInstance().switchCamera(),mT.log("".concat(Db,", switchCamera(), frontCamera").concat(this.data.pusher.frontCamera))}},{key:"openMicrophone",value:function(){ab.getInstance().getAlert().checkSync(new XD({api:"openMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic||this._pusherAudioHandler(),mT.log("".concat(Db,", openMicrophone() pusher: ").concat(this.data.pusher))}},{key:"closeMicrophone",value:function(){ab.getInstance().getAlert().checkSync(new XD({api:"closeMicrophone",callStatus:this.data.callStatus,initReady:this._initReady})),this.data.pusher.enableMic&&this._pusherAudioHandler(),mT.log("".concat(Db,", closeMicrophone() pusher: ").concat(this.data.pusher))}},{key:"selectAudioPlaybackDevice",value:function(t){ab.getInstance().getAlert().checkSync(new XD({api:"selectAudioPlaybackDevice",callStatus:this.data.callStatus,attributes:{type:t},initReady:this._initReady}));var e=!1;switch(t){case"speaker":e=!0;break;case"ear":e=!1}return this.setHandsFree(e)}},{key:"setHandsFree",value:function(t){return this.data.soundMode=t?"speaker":"ear",mT.log("".concat(Db,", setHandsFree() result: ").concat(this.data.soundMode)),this.data.soundMode}},{key:"switchAudioCall",value:(g=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isGroupCall()){t.next=3;break}return mT.warn("".concat(Db,".switchToAudioCall is not applicable to groupCall.")),t.abrupt("return");case 3:if(this.data.invitation.type!==pg.AUDIO){t.next=6;break}return mT.warn("".concat(Db," Now the call mode is audio call.")),t.abrupt("return");case 6:if(this.data.switchCallModeStatus){t.next=9;break}return mT.warn("".concat(Db," audio and video call switching.")),t.abrupt("return");case 9:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:Dg}));case 12:case"end":return t.stop()}}),t,this)}))),function(){return g.apply(this,arguments)})},{key:"switchCallMediaType",value:(v=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ab.getInstance().getAlert().check(new XD({api:"switchCallMediaType",attributes:{type:e},callStatus:this.data.callStatus,initReady:this._initReady}));case 2:if(!this.isGroupCall()){t.next=5;break}return mT.warn("".concat(Db,".switchToAudioCall is not applicable to groupCall.")),t.abrupt("return");case 5:if(this.data.switchCallModeStatus){t.next=8;break}return mT.warn("".concat(Db," audio and video call switching.")),t.abrupt("return");case 8:t.t0=e,t.next=t.t0===pg.AUDIO?11:t.t0===pg.VIDEO?14:16;break;case 11:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!1}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.unHandledInviteeList[0]||this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:Dg}));case 14:throw mT.warn("".concat(Db," Audio switching Video is not supported yet")),new Error("".concat(Db," Audio switching Video is not supported yet"));case 16:case"end":return t.stop()}}),t,this)}))),function(t){return v.apply(this,arguments)})},{key:"setSwitchCallModeStatus",value:function(t){this.data.switchCallModeStatus=t}},{key:"switchVideoCall",value:(p=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isGroupCall()){t.next=3;break}return mT.warn("".concat(Db,".switchToVideoCall is not applicable to groupCall.")),t.abrupt("return");case 3:if(this.data.invitation.type!==pg.VIDEO){t.next=6;break}return mT.warn("".concat(Db," Now the call mode is video call.")),t.abrupt("return");case 6:if(this.data.switchCallModeStatus){t.next=9;break}return mT.warn("".concat(Db," audio and video call switching.")),t.abrupt("return");case 9:return this.setSwitchCallModeStatus(!1),this.setPusherAttributesHandler({enableCamera:!0}),t.abrupt("return",this.TSignalingClient.switchCallMode({userID:this.data.playerList[0].userID,callType:this.data.invitation.type,roomID:this.data.invitation.roomID,mode:bg}));case 12:case"end":return t.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"setSoundMode",value:function(t){var e=!1,n=!1;switch(t||(n=!0,t=this.data.soundMode),t){case"speaker":e=!0;break;case"ear":e=!1}return this.setHandsFree(n?!e:e)}},{key:"_hangUp",value:function(){this.hangup()}},{key:"getCurrentPusherInstance",value:function(){return this.TRTC.getPusherInstance().context=wx.createLivePusherContext(),this.TRTC.getPusherInstance()}},{key:"_pusherStateChangeHandler",value:function(t){this.TRTC.pusherEventHandler(t)}},{key:"_playerStateChange",value:function(t){this._emitter.emit(og.REMOTE_STATE_UPDATE,t)}},{key:"_playerAudioVolumeNotify",value:function(t){this.data.playerList.length>0&&this.TRTC.playerAudioVolumeNotify(t)}},{key:"_pusherAudioVolumeNotify",value:function(t){this.TRTC.pusherAudioVolumeNotify(t)}},{key:"_updateUserProfile",value:function(t,e){return 0===e.length||0===t.length?e:e.map((function(e){var n=e,r=t.filter((function(t){return t.userID===e.userID}));return n.avatar=r[0]&&r[0].avatar?r[0].avatar:"",n.nick=r[0]&&r[0].nick?r[0].nick:"",n}))}},{key:"_getUserProfile",value:function(t){var e=this;this.tim.getUserProfile({userIDList:t}).then((function(t){mT.log("getUserProfile success",t),mT.log(t.data),e.data.remoteUsers=t.data})).catch((function(t){mT.warn("getUserProfile error:",t)}))}},{key:"getUserProfile",value:(d=c(a().mark((function t(e){var n,r,i,o,s=arguments;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:"array",0!==e.length){t.next=3;break}return t.abrupt("return",[]);case 3:return r=e.map((function(t){return t.userID})),t.next=6,this.tim.getUserProfile({userIDList:r});case 6:i=t.sent,o=null,t.t0=n,t.next="array"===t.t0?11:"map"===t.t0?13:16;break;case 11:return o=e.map((function(t,e){return t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,t})),t.abrupt("break",16);case 13:return o={},e.forEach((function(t,e){t.avatar=i.data[e].avatar,t.nick=i.data[e].nick,o[t.userID]=t})),t.abrupt("break",16);case 16:return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t,this)}))),function(t){return d.apply(this,arguments)})},{key:"setSelfInfo",value:function(t,e){return ab.getInstance().getAlert().checkSync(new XD({api:"setSelfInfo",attributes:{nickName:t,avatar:e},initReady:this._initReady})),this.tim.updateMyProfile({nick:t,avatar:e})}},{key:"deviceCheck",value:(l=c(a().mark((function t(e){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",dT(e));case 1:case"end":return t.stop()}}),t)}))),function(t){return l.apply(this,arguments)})},{key:"_pusherNetStatus",value:function(t){this.TRTC.pusherNetStatusHandler(t)}},{key:"_playNetStatus",value:function(t){this.TRTC.playerNetStatus(t)}},{key:"_toggleViewSize",value:function(t){var e=t.currentTarget.dataset.screen;return mT.log("get screen",e,t),1===this.data.playerList.length&&e!==this.data.screen&&this.data.invitation.type===pg.VIDEO&&(this.data.screen=e),this.data.screen}},{key:"getTim",value:function(){return this.tim}},{key:"_setInterfaceUpLoad",value:function(t){return mT.time(t),new ET(t)}},{key:"destroyed",value:(s=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()===sg.IDLE){t.next=3;break}return t.next=3,this.handleExceptionExit();case 3:if(this._resetTUICallEngine(),this._removeTSignalingEvent(),this._removeTRTCEvent(),this._timExternal){t.next=9;break}return t.next=9,this.logout();case 9:this._initReady=!1;case 10:case"end":return t.stop()}}),t,this)}))),function(){return s.apply(this,arguments)})},{key:"handleExceptionExit",value:(o=c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.getCallStatus()!==sg.CALLING){t.next=8;break}if(!this.isInviter()){t.next=6;break}return t.next=4,this.hangup();case 4:t.next=8;break;case 6:return t.next=8,this.reject();case 8:if(this.getCallStatus()!==sg.CONNECTED){t.next=11;break}return t.next=11,this.hangup();case 11:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"generateCallEndData",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.roomId,n=t.callMediaType,r=t.callRole,i=t.totalTime,a=t.userId;return e=e||this.getRoomID(),n=n||this.getCallType(),r||(r=this.isInviter()?gg:yg),{roomID:e,callMediaType:n,callRole:r,totalTime:i=sT(i)?Math.round((Date.now()-this.data.startTalkTime)/1e3):i,userID:a=a||this.getUserID(),callEnd:i,message:t.message||""}}}],[{key:"createInstance",value:function(t){return ab.getInstance().getAlert().checkSync(new XD({api:"createInstance",attributes:t})),r.instance||(r.instance=new r(t)),r.instance.initData(),r.instance}}]),r}();f(bb,"instance",null),f(bb,"AUDIO_PLAYBACK_DEVICE",_g),f(bb,"MEDIA_TYPE",pg),f(bb,"EVENT",og),f(bb,"STATUS",sg);export{_g as AUDIO_PLAYBACK_DEVICE,og as EVENT,pg as MEDIA_TYPE,sg as STATUS,bb as TUICallEngine,bb as default};
