!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("trtc-js-sdk"),require("@tencentcloud/chat"),require("rtc-ai-denoiser")):"function"==typeof define&&define.amd?define(["trtc-js-sdk","@tencentcloud/chat","rtc-ai-denoiser"],t):"object"==typeof exports?exports["tuicall-engine-webrtc"]=t(require("trtc-js-sdk"),require("@tencentcloud/chat"),require("rtc-ai-denoiser")):e["tuicall-engine-webrtc"]=t(e.TRTC,e.ChatSDK,e.RTCAIDenoiser)}(window,(function(e,t,n){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=31)}([function(e,t,n){"use strict";n.r(t),n.d(t,"mainUrl",(function(){return i})),n.d(t,"backupUrl",(function(){return r})),n.d(t,"Mode",(function(){return a})),n.d(t,"Role",(function(){return s})),n.d(t,"VIDEO_STAT_BIT",(function(){return o})),n.d(t,"AUDIO_STAT_BIT",(function(){return l})),n.d(t,"AUDIO_MUTE_BIT",(function(){return u})),n.d(t,"VIDEO_MUTE_BIT",(function(){return c})),n.d(t,"VIDEO_MUTED_MASK",(function(){return d})),n.d(t,"AUX_VIDEO_MUTED_MASK",(function(){return h})),n.d(t,"AUDIO_MUTED_MASK",(function(){return p})),n.d(t,"MAIN_STREAM_MSID",(function(){return _})),n.d(t,"AUX_STREAM_MSID",(function(){return f})),n.d(t,"StreamType",(function(){return E})),n.d(t,"TRTC_QUALITY_UNKNOWN",(function(){return I})),n.d(t,"TRTC_QUALITY_EXCELLENT",(function(){return g})),n.d(t,"TRTC_QUALITY_GOOD",(function(){return v})),n.d(t,"TRTC_QUALITY_POOR",(function(){return C})),n.d(t,"TRTC_QUALITY_BAD",(function(){return T})),n.d(t,"TRTC_QUALITY_VBAD",(function(){return m})),n.d(t,"TRTC_QUALITY_DISCONNECTED",(function(){return A})),n.d(t,"DTLS_STATE_UNKNOWN",(function(){return y})),n.d(t,"SuccessRate",(function(){return L})),n.d(t,"MTA_API_PENDING",(function(){return D})),n.d(t,"MTA_API_SUCCESS",(function(){return R})),n.d(t,"ConnectionState",(function(){return S})),n.d(t,"UPLINK_RECONNECTION_COUNT",(function(){return N})),n.d(t,"DOWNLINK_RECONNECTION_COUNT",(function(){return O})),n.d(t,"SIGNAL_RECONNECTION_COUNT",(function(){return b})),n.d(t,"KIBANA_EVENT",(function(){return w})),n.d(t,"SIGNAL_PING_TIMEOUT",(function(){return U})),n.d(t,"SIGNAL_PING_PONG_INTERVAL",(function(){return M})),n.d(t,"INNER_EVENT",(function(){return P})),n.d(t,"AI_NOISE_REDUCE_ASSETS_PATH",(function(){return V})),n.d(t,"MAX_NUMBER_ROOM_ID",(function(){return k})),n.d(t,"NAME",(function(){return x}));const i="wss://qcloud.rtc.qq.com:8687",r="wss://bk.rtc.qq.com:8687",a={RTC:1,LIVE:2},s={HOST:20,AUDIENCE:21},o=1,l=8,u=64,c=16,d=1,h=2,p=4,_="5Y2wZK8nANNAoVw6dSAHVjNxrD1ObBM2kBPV",f="224d130c-7b5c-415b-aaa2-79c2eb5a6df2",E={NONE:0,AUDIO:1,MAIN:2,AUX:7},I=0,g=1,v=2,C=3,T=4,m=5,A=6,y="unknown",L={JOIN:"join",PUBLISH:"publish",UNPUBLISH:"unpublish",LOCAL_STREAM_INITIALIZE:"local_stream_initialize",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscibe",UPLINK_CONNECTION:"uplink_connection",UPLINK_RECONNECTION:"uplink_reconnection",DOWNLINK_CONNECTION:"downlink_connection",DOWNLINK_RECONNECTION:"downlink_reconnection",SIGNAL_CONNECTION:"signal_connection",SIGNAL_RECONNECTION:"signal_reconnection",UPDATE_STREAM:"update_stream"},D="pending",R="success",S={CONNECTING:"connecting",CONNECTED:"connected",DISCONNECTED:"disconnected"},N=30,O=30,b=30,w={SDK_CONSTRUCT:"sdkConstruct",SDK_LOGIN:"sdkLogin",DELTA_JOIN:"delta-join",REJOIN:"rejoin",LEAVE:"leave",DELTA_LEAVE:"delta-leave",PUBLISH:"publish",DELTA_PUBLISH:"delta-publish",UNPUBLISH:"unpublish",SUBSCRIBE:"subscribe",UNSUBSCRIBE:"unsubscribe",UPLINK_CONNECTION:"uplink-connection",UPLINK_RECONNECTION:"uplink-reconnection",DOWNLINK_CONNECTION:"downlink-connection",DOWNLINK_RECONNECTION:"downlink-reconnection",ON_TRACK:"ontrack",SET_LOCAL_DESCRIPTION:"setLocalDescription",SET_REMOTE_DESCRIPTION:"setRemoteDescription",ICE_CONNECTION_STATE:"iceConnectionState",LOCAL_STREAM_INITIALIZE:"stream-initialize",SIGNAL_CONNECTION:"websocketConnectionState",SIGNAL_RECONNECTION:"websocketReconnectionState",UPDATE_STREAM:"update-stream",RECOVER_SUBSCRIPTION:"recover-subscription"},U=6e3,M=1e4,P={SET_REMOTE_OFFER_FINISHED:"set-remote-offer-finished"},V="https://web.sdk.qcloud.com/trtc/webrtc/download/aiNoiseReduce/",k=2147483647,x={DEFAULT:"default",BOOLEAN:"boolean",STRING:"string",NUMBER:"number",OBJECT:"object",ARRAY:"array",FUNCTION:"function",FILE:"file",MAP:"map",SET:"set",UNDEFINED:"undefined",VIDEO:"video",AUDIO:"audio",ON_ERROR:"onError",MAIN:"main",RTC:"rtc",LIVE:"live",SMALL:"small",BIG:"big",AUXILIARY:"auxiliary",INVITER:"inviter",INVITEE:"invitee",VIDEO_INPUT:"videoinput",AUDIO_INPUT:"audioinput",LOCAL:"local",REMOTE:"remote",TRTC:"TRTC",WEB:"web",NORMAL:"normal",REJECT:"reject",IGNORE:"ignore",TIMEOUT:"timeout",RIC:"ric",RAF:"raf",INTERVAL:"interval",CANCEL:"cancel",BUSYLINE:"busyline",UNKNOWN:"unknown",SINGLE_CALL:"SingleCall",GROUP_CALL:"groupCall",CALLER:"caller",CALLEE:"callee",COVER:"cover",CONTAIN:"contain",FILL:"fill",AV_CALL:"av_call",CALLKIT_RECORDS_SVR:"callkit_records_svr",SINGLE:"single",GROUP:"group",START_CALL:"start_call",RECEIVE_CALL:"receive_call",CALL_ACCEPTED:"call_accepted",ACCEPT_CALL:"accept_call",CALL_MISSED:"call_missed",NOT_ANSWER_CALL:"not_answer_call",CALL_REJECTED:"call_rejected",REJECT_CALL:"reject_call",CALL_BUSY:"call_busy",IGNORE_CALL:"ignore_call",CANCEL_CALL:"cancel_call",CALL_CANCELED:"call_canceled",CALL_FAILED:"call_failed",CALL_END:"call_end",CALL_INTERRUPTED:"call_interrupted",INVITE_USER:"invite_user",JOIN_IN_GROUP_CALL:"join_in_group_call",EVENT_REPORT:"event_report",HEART_BEAT:"heartbeat",CALLING:"calling",BANNED:"banned"}},function(e,t,n){"use strict";n.r(t),n.d(t,"isMap",(function(){return a})),n.d(t,"isSet",(function(){return s})),n.d(t,"isFile",(function(){return o})),n.d(t,"isNumber",(function(){return l})),n.d(t,"isString",(function(){return u})),n.d(t,"isObject",(function(){return c})),n.d(t,"isBoolean",(function(){return d})),n.d(t,"isPlainObject",(function(){return h})),n.d(t,"isArray",(function(){return p})),n.d(t,"isUndefined",(function(){return _})),n.d(t,"isNativeClass",(function(){return E})),n.d(t,"isArrayOrObject",(function(){return I})),n.d(t,"isFunction",(function(){return g})),n.d(t,"isInstanceOfError",(function(){return v})),n.d(t,"getType",(function(){return C})),n.d(t,"TimeUtil",(function(){return m})),n.d(t,"stringifyError",(function(){return A})),n.d(t,"map2String",(function(){return y})),n.d(t,"randomString",(function(){return R})),n.d(t,"isValidType",(function(){return S})),n.d(t,"mapKeys",(function(){return N})),n.d(t,"mapValues",(function(){return O})),n.d(t,"generateRandomRoomID",(function(){return b})),n.d(t,"formatDuration",(function(){return U})),n.d(t,"compareVersion",(function(){return M})),n.d(t,"date2ISOString",(function(){return P})),n.d(t,"getHostType",(function(){return V})),n.d(t,"isCallSignaling",(function(){return k})),n.d(t,"performanceNow",(function(){return x}));var i=n(7),r=n(0);const a=function(e){return C(e)===r.NAME.MAP},s=function(e){return C(e)===r.NAME.SET},o=function(e){return C(e)===r.NAME.FILE},l=function(e){return null!==e&&(typeof e===r.NAME.NUMBER&&!isNaN(e-0)||typeof e===r.NAME.OBJECT&&e.constructor===Number)},u=function(e){return typeof e===r.NAME.STRING},c=function(e){return null!==e&&typeof e===r.NAME.OBJECT},d=function(e){return typeof e===r.NAME.BOOLEAN},h=function(e){if(typeof e!==r.NAME.OBJECT||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n},p=function(e){return typeof Array.isArray===r.NAME.FUNCTION?Array.isArray(e):C(e)===r.NAME.ARRAY},_=function(e){return typeof e===r.NAME.UNDEFINED},f=/^class\s/,E=function(e){return typeof e===r.NAME.FUNCTION&&f.test(e.toString())},I=function(e){return p(e)||c(e)},g=function(e){return typeof e===r.NAME.FUNCTION},v=function(e){return e instanceof Error},C=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()};let T=0;Date.now||(Date.now=function(){return(new Date).getTime()});const m={now(){0===T&&(T=Date.now()-1);const e=Date.now()-T;return e>4294967295?(T+=4294967295,Date.now()-T):e},utc:()=>Math.round(Date.now()/1e3)},A=function(e){return JSON.stringify(e,["message","code"])},y=function(e){if(!a(e))return"not a map!!!";let t="";for(const[n,i]of e.entries()){if(a(i))return`[k=${n} -> ${y(i)}`;t+=`[k=${n} v=${i}] `}return t},L="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",D=L.length,R=function(){let e="";for(let t=32;t>0;--t)e+=L[Math.floor(Math.random()*D)];return e},S=function(e,t){for(const n in e)if(e[n]===t)return!0;return!1};function N(e,t){const n={};return Object.keys(e).forEach(i=>{n[t(e[i],i)]=e[i]}),n}function O(e,t){const n={};return Object.keys(e).forEach(i=>{n[i]=t(e[i],i)}),n}function b(){return Math.round(1e8*Math.random())}function w(e){return e<10?"0"+e:e}function U(e){if(e<60)return"00:00:"+w(e);if(e<3600){const t=parseInt(e/60),n=e-60*t;return`00:${w(t)}:${w(n)}`}const t=parseInt(e/3600),n=e-3600*t,i=parseInt(n/60),r=n-60*i;return`${w(t)}:${w(i)}:${w(r)}`}function M(e,t){e=e.split("."),t=t.split(".");const n=Math.max(e.length,t.length);for(;e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(let i=0;i<n;i++){const n=parseInt(e[i]),r=parseInt(t[i]);if(n>r)return 1;if(n<r)return-1}return 0}const P=function(){const e=new Date,t=e.toISOString(),n=e.getTimezoneOffset()/60;let i="";return i=n<0?n>-10?"+0"+Math.abs(100*n):"+"+Math.abs(100*n):n>=10?"-"+100*n:"-0"+100*n,t.replace("Z",i)};function V(){let e="unknown";return i.IS_MAC&&(e="mac"),i.IS_WIN&&(e="windows"),i.IS_IOS&&(e="ios"),i.IS_ANDROID&&(e="android"),e}function k(e){return e===r.NAME.AV_CALL}function x(){return performance&&performance.now?Math.floor(performance.now()):Date.now()}},function(e,t,n){"use strict";n.r(t);var i=n(8),r=n(1);let a=0;const s=new Map;function o(){const e=new Date;return`TUICallEngine ${e.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}:`}const l={_data:[],_length:0,_visible:!1,arguments2String(e){let t;if(1===e.length)t=o()+e[0];else{t=o();for(let n=0,{length:i}=e;n<i;n++)Object(r.isArrayOrObject)(e[n])?Object(r.isInstanceOfError)(e[n])?t+=Object(r.stringifyError)(e[n]):t+=JSON.stringify(e[n]):t+=e[n],t+=" "}return t},debug(){if(a<=-1){const e=this.arguments2String(arguments);l.record(e,"debug"),i.a.debug(e)}},log(){if(a<=0){const e=this.arguments2String(arguments);l.record(e,"log"),i.a.log(e)}},info(){if(a<=1){const e=this.arguments2String(arguments);l.record(e,"info"),i.a.info(e)}},warn(){if(a<=2){const e=this.arguments2String(arguments);l.record(e,"warn"),i.a.warn(e)}},error(){if(a<=3){const e=this.arguments2String(arguments);l.record(e,"error"),i.a.error(e)}},time(e){s.set(e,r.TimeUtil.now())},timeEnd(e){if(s.has(e)){const t=r.TimeUtil.now()-s.get(e);return s.delete(e),t}return i.a.warn(`未找到对应label: ${e}, 请在调用 logger.timeEnd 前，调用 logger.time`),0},setLevel(e){e<4&&i.a.log(`${o()}set level from ${a} to ${e}`),a=e},getLevel:()=>a,record(e,t){1100===l._length&&(l._data.splice(0,100),l._length=1e3),l._length++,l._data.push(`${e} [${t}] \n`)},getLog:()=>l._data};t.default=l},function(e,t,n){"use strict";var i=n(18),r=Object.prototype.toString;function a(e){return"[object Array]"===r.call(e)}function s(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function l(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===r.call(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),a(e))for(var n=0,i=e.length;n<i;n++)t.call(null,e[n],n,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:a,isArrayBuffer:function(e){return"[object ArrayBuffer]"===r.call(e)},isBuffer:function(e){return null!==e&&!s(e)&&null!==e.constructor&&!s(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isPlainObject:l,isUndefined:s,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return o(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function e(){var t={};function n(n,i){l(t[i])&&l(n)?t[i]=e(t[i],n):l(n)?t[i]=e({},n):a(n)?t[i]=n.slice():t[i]=n}for(var i=0,r=arguments.length;i<r;i++)c(arguments[i],n);return t},extend:function(e,t,n){return c(t,(function(t,r){e[r]=n&&"function"==typeof t?i(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={UNKNOWN:65535,NO_SDK_APPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USER_SIG:2003,NO_TINY_ID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,NO_NETWORK:2805,FAILURE_SWITCH_TO_AUDIO:60001,FAILURE_SWITCH_TO_VIDEO:60002,NOT_MICROPHONE_LIST:60003,NOT_CAMERA_LIST:60004,NOT_MEDIA_ACCESS:60005,NOT_SUPPORT:60006,ERROR_PACKAGE_NOT_PURCHASED:-1001,ERROR_PACKAGE_NOT_SUPPORTED:-1002,ERROR_TIM_VERSION_OUTDATED:-1003,ERROR_PERMISSION_DENIED:-1101,ERROR_GET_DEVICE_LIST_FAIL:-1102,ERROR_INIT_FAIL:-1201,ERROR_PARAM_INVALID:-1202,ERROR_REQUEST_REFUSED:-1203,ERROR_REQUEST_REPEATED:-1204,ERROR_SCENE_NOT_SUPPORTED:-1205,ERROR_SIGNALING_SEND_FAIL:-1401,ERROR_INVALID_INVITEID:8010,ERROR_INVALID_SEND_FAIL:20003,ERROR_HTTP:3e4}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DEVICEID_TYPE=t.DEVICE_TYPE=t.CALL_EXPERMENTEL_API_TYPE=t.LOG_LEVEL=t.MODE_TYPE=t.VALID_VIDEO_PROFILE_LIST=t.BUSINESS_ID=t.ACTION_TYPE=t.CALL_ROLE=t.CALL_STATUS=t.CMD_TYPE=t.CMD_TYPE_LIST=t.CALL_TYPE=void 0;var i=n(14);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.AUDIO_CALL=1]="AUDIO_CALL",e[e.VIDEO_CALL=2]="VIDEO_CALL"}(t.CALL_TYPE||(t.CALL_TYPE={})),t.CMD_TYPE_LIST=["","audioCall","videoCall"],function(e){e.AUDIO_CALL="audioCall",e.VIDEO_CALL="videoCall",e.HANG_UP="hangup",e.SWITCH_TO_AUDIO="switchToAudio",e.SWITCH_TO_AUDIO_CALL="switch_to_audio_call",e.SWITCH_TO_VIDEO="switchToVideo"}(t.CMD_TYPE||(t.CMD_TYPE={})),function(e){e.IDLE="idle",e.CALLING="calling",e.CONNECTED="connected"}(t.CALL_STATUS||(t.CALL_STATUS={})),function(e){e.UNKNOWN="",e.INVITER="inviter",e.INVITEE="invitee"}(t.CALL_ROLE||(t.CALL_ROLE={})),function(e){e[e.INVITE=1]="INVITE",e[e.CANCEL_INVITE=2]="CANCEL_INVITE",e[e.ACCEPT_INVITE=3]="ACCEPT_INVITE",e[e.REJECT_INVITE=4]="REJECT_INVITE",e[e.INVITE_TIMEOUT=5]="INVITE_TIMEOUT"}(t.ACTION_TYPE||(t.ACTION_TYPE={})),function(e){e[e.SIGNAL=1]="SIGNAL"}(t.BUSINESS_ID||(t.BUSINESS_ID={})),t.VALID_VIDEO_PROFILE_LIST=Object.keys(i.TUICommonDefine.VideoEncoderParams),function(e){e.AUDIO="audio",e.VIDEO="video"}(t.MODE_TYPE||(t.MODE_TYPE={})),function(e){e[e.NORMAL=0]="NORMAL",e[e.RELEASE=1]="RELEASE",e[e.WARNING=2]="WARNING",e[e.ERROR=3]="ERROR",e[e.NONE=4]="NONE"}(t.LOG_LEVEL||(t.LOG_LEVEL={})),function(e){e[e.BASE=Math.pow(2,16)]="BASE",e[e.PRO=Math.pow(2,17)]="PRO",e[e.ULTIMATE=Math.pow(2,18)]="ULTIMATE"}(t.CALL_EXPERMENTEL_API_TYPE||(t.CALL_EXPERMENTEL_API_TYPE={})),function(e){e.AUDIO="audio",e.VIDEO="video",e.CAMERA="camera",e.MICROPHONES="microphones"}(t.DEVICE_TYPE||(t.DEVICE_TYPE={})),function(e){e.audio="microphoneId",e.video="cameraId"}(t.DEVICEID_TYPE||(t.DEVICEID_TYPE={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ERROR_CN_MESSAGE=t.ERROR_MESSAGE=void 0,t.ERROR_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无 accountType",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"switch to audio call error",FAILURE_SWITCH_TO_VIDEO:"switch to video call error",NOT_MICROPHONE_LIST:"No microphone or microphone permission denied",NOT_CAMERA_LIST:"No camera or camera permission denied",ERROR_NULL:"success",ERROR_PACKAGE_NOT_PURCHASED:"You do not currently have TUICallKit package, please open the free experience in the console or purchase the official package",ERROR_PACKAGE_NOT_SUPPORTED:'The package you purchased does not support this ability. You can refer to "Activate TRTC and IM": https://www.tencentcloud.com/document/product/647/50993#step-1.-activate-trtc-and-im',ERROR_TIM_VERSION_OUTDATED:"TIM SDK version is too old, Please upgrade version",ERROR_PERMISSION_DENIED:"camera permission refused / microphone permission refused. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls",ERROR_GET_DEVICE_LIST_FAIL:"Failed to get device list",ERROR_INIT_FAIL:"init or login is not complete, this API needs to be used after init. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"The API is support use in the state of. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"The current method is being executed, please do not call it repeatedly",ERROR_REQUEST_REPEATED_SWITCH:"Consistent with the current call type, please do not switch repeatedly",ERROR_SCENE_NOT_SUPPORTED:"In the current call scene, this function is not supported",ERROR_SIGNALING_SEND_FAIL:"signaling failed to send",ERROR_INVALID_INVITEID:"inviteID is invalid or invitation has been processed. To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"Invalid sender or receiver identifier! To solve the problem, please go to: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"invalid parameter",ERROR_HTTP:"The current page is detected to be using the http protocol. To ensure smooth access and experience of all functions of TUICallEngine SDK for production environment users, please use the https protocol to access the audio and video application page. More Info: https://web.sdk.qcloud.com/trtc/webrtc/doc/en/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"The current page does not have webRTC capability. You can perform the trtc capability test at https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html to check whether the current environment supports audio and video calls"},t.ERROR_CN_MESSAGE={NO_SDK_APPID:"无 SDKAppID",NO_ACCOUNT_TYPE:"无帐户类型",NO_IDENTIFIER:"无 userID",NO_USER_SIG:"无 userSig",NO_NETWORK:"未连接到网络",FAILURE_SWITCH_TO_AUDIO:"切换语音通话失败",FAILURE_SWITCH_TO_VIDEO:"切换视频通话失败",NOT_MICROPHONE_LIST:"没有麦克风权限",NOT_CAMERA_LIST:"没有摄像头权限",ERROR_NULL:"成功",ERROR_PACKAGE_NOT_PURCHASED:"您目前没有 TUICallKit 包，请在控制台开启免费体验或购买官方包",ERROR_PACKAGE_NOT_SUPPORTED:"您购买的套餐不支持该功能。可参考开通方式：https://cloud.tencent.com/document/product/647/84363#ff45b4ad-f605-42b8-a0af-b2397c8f3e1a",ERROR_TIM_VERSION_OUTDATED:"TIM SDK 版本太旧,请升级版本",ERROR_PERMISSION_DENIED:"摄像头/麦克风权限被拒绝，可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话",ERROR_GET_DEVICE_LIST_FAIL:"获取设备列表失败",ERROR_INIT_FAIL:"TUICallEngine 初始化登录未完成，需要在 init 或 login 完成后使用此 API 。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#3a61f42b-e06f-49af-88bf-362d40025887",ERROR_REQUEST_REFUSED:"当前通话状态无法使用该 API。解决方案请前往: https://cloud.tencent.com/document/product/647/78769#5e65043d-e3dc-4bd3-8220-3ac7694dfa42",ERROR_REQUEST_REPEATED:"当前方法正在执行中，请勿重复调用",ERROR_REQUEST_REPEATED_SWITCH:"与当前通话类型一致，请勿重复切换",ERROR_SCENE_NOT_SUPPORTED:"当前通话场景不支持该功能",ERROR_SIGNALING_SEND_FAIL:"信令发送失败",ERROR_INVALID_INVITEID:"邀请 ID 无效或邀请已处理。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#e97ea97b-7812-42ed-89b7-2a3840ac0e3f",ERROR_INVALID_SEND_FAIL:"消息发送方或接收方 UserID 无效或不存在。解决方案请前往: https://cloud.tencent.com/document/product/647/84363#661be1b0-f649-4199-a343-958c3f4f4bbb",ERROR_PARAM_INVALID:"参数错误",ERROR_HTTP:"检测到当前页面正处于 http 协议下，为确保生产环境用户顺畅接入和体验 TUICallEngine SDK 的全部功能，请使用 https 协议访问音视频应用页面。详情请前往：https://web.sdk.qcloud.com/trtc/webrtc/doc/zh-cn/tutorial-05-info-browser.html#h2-3",NOT_SUPPORT:"当前页面不具备 webRTC 能力。可以前往: https://web.sdk.qcloud.com/trtc/webrtc/demo/detect/index.html 进行 trtc 能力测试，查看当前环境是否支持音视频通话"}},function(e,t,n){"use strict";n.r(t),n.d(t,"IN_Browser",(function(){return i})),n.d(t,"IN_WXMiniProgram",(function(){return r})),n.d(t,"USER_AGENT",(function(){return a})),n.d(t,"IS_IPAD",(function(){return l})),n.d(t,"IS_IPHONE",(function(){return u})),n.d(t,"IS_IPOD",(function(){return c})),n.d(t,"IS_IOS",(function(){return d})),n.d(t,"IOS_VERSION",(function(){return h})),n.d(t,"IS_ANDROID",(function(){return p})),n.d(t,"ANDROID_VERSION",(function(){return _})),n.d(t,"IS_OLD_ANDROID",(function(){return f})),n.d(t,"IS_NATIVE_ANDROID",(function(){return E})),n.d(t,"IS_FIREFOX",(function(){return I})),n.d(t,"FIREFOX_VERSION",(function(){return g})),n.d(t,"IS_EDGE",(function(){return v})),n.d(t,"EDGE_VERSION",(function(){return C})),n.d(t,"IS_EDG",(function(){return T})),n.d(t,"EDG_VERSION",(function(){return m})),n.d(t,"IS_CHROME",(function(){return A})),n.d(t,"CHROME_MAJOR_VERSION",(function(){return y})),n.d(t,"CHROME_VERSION",(function(){return L})),n.d(t,"IS_IE8",(function(){return D})),n.d(t,"IE_VERSION",(function(){return R})),n.d(t,"IS_SAFARI",(function(){return S})),n.d(t,"IS_ANY_SAFARI",(function(){return N})),n.d(t,"SAFARI_VERSION",(function(){return O})),n.d(t,"IS_TBS",(function(){return b})),n.d(t,"TBS_VERSION",(function(){return w})),n.d(t,"IS_X5MQQB",(function(){return U})),n.d(t,"IS_MQQB",(function(){return M})),n.d(t,"MQQB_VERSION",(function(){return P})),n.d(t,"IS_QQB",(function(){return V})),n.d(t,"IS_WECHAT",(function(){return k})),n.d(t,"WECHAT_VERSION",(function(){return x})),n.d(t,"IS_WIN",(function(){return j})),n.d(t,"IS_MAC",(function(){return G})),n.d(t,"IS_LINUX",(function(){return B})),n.d(t,"IS_WX",(function(){return H})),n.d(t,"IS_UCBROWSER",(function(){return Y})),n.d(t,"IS_MIUIBROWSER",(function(){return K})),n.d(t,"IS_HUAWEIBROWSER",(function(){return F})),n.d(t,"HUAWEI_VERSION",(function(){return J})),n.d(t,"BROWSER_VERSION",(function(){return W})),n.d(t,"IS_LOCAL",(function(){return $})),n.d(t,"getBrowserInfo",(function(){return Q})),n.d(t,"getOsInfo",(function(){return X}));const i="undefined"!=typeof window,r="undefined"!=typeof wx,a=window.navigator&&window.navigator.userAgent||"",s=/AppleWebKit\/([\d.]+)/i.exec(a),o=s?parseFloat(s.pop()):null,l=/iPad/i.test(a),u=/iPhone/i.test(a)&&!l,c=/iPod/i.test(a),d=u||l||c,h=function(){const e=a.match(/OS (\d+)_/i);return e&&e[1]?e[1]:null}(),p=/Android/i.test(a),_=function(){const e=a.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;const t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(`${e[1]}.${e[2]}`):t||null}(),f=p&&/webkit/i.test(a)&&_<2.3,E=p&&_<5&&o<537,I=/Firefox/i.test(a),g=function(){const e=a.match(/Firefox\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),v=/Edge\//i.test(a),C=v&&function(){const e=a.match(/Edge\/(\d+)/i);if(e&&e[1])return e[1]}(),T=/Edg\//i.test(a),m=function(){const e=a.match(/Edg\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),A=!v&&/Chrome/i.test(a),y=function(){const e=a.match(/Chrome\/(\d+)/);return e&&e[1]?parseFloat(e[1]):null}(),L=function(){const e=a.match(/Chrome\/([\d.]+)/);return e&&e[1]?e[1]:null}(),D=/MSIE\s8\.0/.test(a),R=function(){const e=/MSIE\s(\d+)\.\d/.exec(a);let t=e&&parseFloat(e[1]);return!t&&/Trident\/7.0/i.test(a)&&/rv:11.0/.test(a)&&(t=11),t}(),S=/Safari/i.test(a)&&!A&&!p&&!v,N=S||d,O=function(){const e=a.match(/Version\/([\d.]+)/);return e&&e[1]?e[1]:null}(),b=/TBS\/\d+/i.test(a),w=function(){const e=a.match(/TBS\/(\d+)/i);if(e&&e[1])return e[1]}(),U=!b&&/MQQBrowser\/\d+/i.test(a)&&/COVC\/\d+/i.test(a),M=!b&&/MQQBrowser\/\d+/i.test(a),P=(M||U)&&function(){const e=a.match(/ MQQBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),V=!b&&/ QQBrowser\/\d+/i.test(a),k=/(micromessenger|webbrowser)/i.test(a),x=k&&function(){const e=a.match(/MicroMessenger\/(\d+)/i);if(e&&e[1])return e[1]}(),j=/Windows/i.test(a),G=/MAC OS X/i.test(a),B=/Linux/i.test(a),H=/MicroMessenger/i.test(a),Y=/UCBrowser/i.test(a),K=/MiuiBrowser/i.test(a),F=/HuaweiBrowser/i.test(a),J=F&&function(){const e=a.match(/HuaweiBrowser\/([\d.]+)/);return e&&e[1]?e[1]:null}(),W=A?"Chrome/"+L:S?"Safari/"+O:"NotSupportedBrowser",$="file:"===location.protocol||"localhost"===location.hostname||/^\d+\.\d+\.\d+\.\d+$/.test(location.hostname),q=new Map([[I,["Firefox",g]],[T,["Edg",m]],[A,["Chrome",L]],[S,["Safari",O]],[b,["TBS",w]],[k&&u,["WeChat",x]],[M,["QQ(Mobile)",P]],[U,["QQ(Mobile X5)",P]],[F,["HW",J]],[v,["EDGE",C]]]);function Q(){let e="unknown",t="unknown";return q.get(!0)&&(e=q.get(!0)[0],t=q.get(!0)[1]),{name:e,version:t}}function X(){let e="unknown";return G&&(e="mac"),j&&(e="windows"),p&&(e="android"),d&&(e="iOS"),{name:e}}},function(e,t,n){"use strict";(function(e){let n,i;n="undefined"!=typeof console?console:void 0!==e&&e.console?e.console:"undefined"!=typeof window&&window.console?window.console:{};const r=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"];let{length:s}=a;for(;s--;)i=a[s],console[i]||(n[i]=r);n.methods=a,t.a=n}).call(this,n(35))},function(e,t,n){"use strict";var i,r=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),s=n(6),o=function(e){function t(t){var n=t.message,i=t.code,r=void 0===i?a.default.UNKNOWN:i,o=e.call(this,n+" "+function(e){for(var t in s.ERROR_CN_MESSAGE)if(a.default[t]===e)return s.ERROR_CN_MESSAGE[t];return"UNKNOWN"}(r)+" <"+function(e){for(var t in a.default)if(a.default[t]===e)return t;return"UNKNOWN"}(r)+": "+r+">")||this;return o.code=r,o.name="TUICallEngineError",o.message_=n,o}return r(t,e),t.prototype.getCode=function(){return this.code},t}(Error);t.default=o},function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(2),a=n(4),s=n.n(a),o=n(6);class l{constructor(e){this.sdkappid="",this.version="",this.userid="",this.platform="",this.useragent="",this.method=e,this.codeint=1,this.calltype=1,this.talktime=0,this.message="",this.text="",this.startts=Date.now(),this.endts=0,this.timespan=0,this.time="",this.networktype="",this.host=Object(i.getHostType)()}static bindController(e){l.prototype._eventStatController=e}setCommonInfo(e){const{SDKAppID:t,version:n,userID:r,platform:a,scene:s}=e;this.sdkappid=t,this.version=""+n,this.userid=r,this.platform=a,this.scene=s,this.time=Object(i.date2ISOString)(),this.startts&&this.endts&&!this.timespan&&(this.timespan=Math.abs(this.endts-this.startts))}setEnd(e=!1){this.endts=Date.now(),e?this._eventStatController.pushIn(this):setTimeout(()=>{this._eventStatController.pushIn(this)},0)}setError(e,t,n){return this.setNetworkType(n),t?(e.code&&this.setCode(e.code),e.message&&this.setMessage(e.message)):(this.setCode(s.a.NO_NETWORK),this.setMessage(o.ERROR_MESSAGE.NO_NETWORK)),this}setCode(e){return"ECONNABORTED"===e&&(this.codeint=103),Object(i.isNumber)(e)?this.codeint=e:r.default.warn("SSOLogData.setCode value not a number, please check!",e,typeof e),this}setMessage(e){return Object(i.isString)(e)?(this.message=e,this):this}setText(e){return Object(i.isNumber)(e)?this.text=e.toString():Object(i.isString)(e)&&(this.text=e),this}setTalkTime(e){return this.talktime=e,this}setMessageType(e){return this.msgType=e,this}setCallType(e){return this.calltype=e,this}setNetworkType(e){return Object(i.isUndefined)(e)?r.default.warn("SSOLogData.setNetworkType value is undefined, please check!"):this.networktype=e,this}}t.default=l},function(e,t,n){"use strict";n.r(t);t.default={SDK_CONSTRUCT:"sdkConstruct",SDK_READY:"sdkReady",SDK_NOT_READY:"sdkNotReady",LOGIN:"login",LOGOUT:"logout",CALL:"call",GROUP_CALL:"groupCall",ACCEPT:"accept",REJECT:"reject",HANGUP:"hangup",START_REMOTE_VIEW:"startRemoteView",STOP_REMOTE_VIEW:"stopRemoteView",START_LOCAL_VIEW:"startLocalView",STOP_LOCAL_VIEW:"stopLocalView",OPEN_CAMERA:"openCamera",CLOSE_CAMERA:"closeCamera",SET_MIC_MUTE:"setMicMute",SET_VIDEO_QUALITY:"setVideoQuality",SWITCH_TO_AUDIO_CALL:"switchToAudioCall",SWITCH_TO_VIDEO_CALL:"switchToVideoCall",CHANGE_CALL_STATUS:"changeCallStatus",TALK_TIME:"talktime",ERROR:"error",INVITED:"invited",GROUP_CALL_INVITEE_LIST_UPDATE:"group_call_invitee_list_update",USER_ENTER:"user_enter",USER_LEAVE:"user_leave",NO_RESP:"no_resp",LINE_BUSY:"line_busy",CALLING_CANCEL:"calling_cancel",KICKED_OUT:"kicked_out",CALLING_TIMEOUT:"calling_timeout",CALLING_END:"calling_end",USER_VIDEO_AVAILABLE:"user_video_available",USER_AUDIO_AVAILABLE:"user_audio_available",USER_VOICE_VOLUME:"user_voice_volume",CALL_TYPE_CHANGED:"call_type_changed",DEVICED_UPDATED:"deviced_updated",QUALITY_REPORT:"quality_report"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEvent=void 0,t.TUICallEvent={ERROR:"onError",SDK_READY:"sdkReady",ON_CALL_BEGIN:"onCallBegin",INVITED:"onInvited",ON_CALL_RECEIVED:"onCallReceived",USER_ACCEPT:"onUserAccept",USER_ENTER:"onUserEnter",USER_LEAVE:"onUserLeave",REJECT:"onReject",NO_RESP:"onNoResp",LINE_BUSY:"onLineBusy",CALLING_CANCEL:"onCallingCancel",ON_CALL_CANCELED:"onCallCanceled",KICKED_OUT:"onKickedOut",CALLING_TIMEOUT:"onCallingTimeout",CALL_END:"onCallEnd",CALLING_END:"onCallEnd",USER_VIDEO_AVAILABLE:"onUserVideoAvailable",USER_AUDIO_AVAILABLE:"onUserAudioAvailable",USER_VOICE_VOLUME:"onUserVoiceVolume",GROUP_CALL_INVITEE_LIST_UPDATE:"onGroupCallInviteeListUpdate",CALL_TYPE_CHANGED:"onCallTypeChanged",DEVICED_UPDATED:"onDeviceUpdated",MESSAGE_SENT_BY_ME:"onMessageSentByMe"}},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));var i=n(2),r=n(1);class a{constructor(){this._table="timweb-trtccalling",this._report=[]}pushIn(e){i.default.debug("SSOLogBody.pushIn",this._report.length,e),this._report.push(e)}backfill(e){Object(r.isArray)(e)&&0!==e.length&&(i.default.debug("SSOLogBody.backfill",this._report.length,e.length),this._report.unshift(...e))}getLogsNumInMemory(){return this._report.length}isEmpty(){return 0===this._report.length}_reset(){this._report.length=0,this._report=[]}getTable(){return this._table}getLogsInMemory(){const e=this._report.slice();return this._reset(),e}}var s=n(10),o=n(16),l=n(29),u=n.n(l);const c={CURRENT:{COMMON:"https://webim.tim.qq.com"},PRODUCTION:{COMMON:"https://webim.tim.qq.com"},OVERSEA_PRODUCTION:{COMMON:"https://api.im.qcloud.com"},SANDBOX:{COMMON:"https://events.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com"}},d={IM_OPEN_STAT:"imopenstat"},h={TIM_WEB_TRTCCALLING_REPORT:"tweb_trtccalling_report"},p={imopenstat:"v4"};class _{constructor(){this.TAG="trtccalling-ssolog-event",this._reportBody=new a,this._version=o.version||"",this.MIN_THRESHOLD=20,this.MAX_THRESHOLD=100,this.WAITING_TIME=6e4,this.INTERVAL=2e4,this._timerID=0,this._resetLastReportTime(),this._startReportTimer(),this._retryCount=0,this.MAX_RETRY_COUNT=3}reportAtOnce(){i.default.debug("EventStatController.reportAtOnce"),this._report()}pushIn(e){e instanceof s.default&&(e.setCommonInfo({SDKAppID:Number(sessionStorage.getItem("sdkAppId")),version:this._version,userID:sessionStorage.getItem("userId")}),this._reportBody.pushIn(e),this._report())}_resetLastReportTime(){this._lastReportTime=Date.now()}_startReportTimer(){this._timerID=setInterval(()=>{Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()},this.INTERVAL)}_stopReportTimer(){this._timerID>0&&(clearInterval(this._timerID),this._timerID=0)}_report(){if(this._reportBody.isEmpty())return;const e=Math.ceil(+new Date/1e3),t=sessionStorage.getItem("sdkAppId"),n=this._reportBody.getLogsInMemory(),a={table:this._reportBody.getTable(),report:n},s=`${c.CURRENT.COMMON}/${p.imopenstat}/${d.IM_OPEN_STAT}/${h.TIM_WEB_TRTCCALLING_REPORT}/?sdkappid=${t}&reqtime=${e}`;u.a.post(s,JSON.stringify(a)).then(()=>{this._resetLastReportTime(),this._retryCount>0&&(i.default.debug("EventStatController.report retry success"),this._retryCount=0)}).catch(e=>{i.default.warn("EventStatController.report, error:"+Object(r.stringifyError)(e)),this._reportBody.backfill(n);this._reportBody.getLogsNumInMemory()>this.MAX_THRESHOLD||this._retryCount===this.MAX_RETRY_COUNT||0===this._timerID?this._retryCount=0:this._retryCount+=1})}reset(){i.default.log("EventStatController.reset"),this._stopReportTimer(),this._report()}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICommonDefine=t.TUICallType=void 0,t.TUICallType={AUDIO_CALL:1,VIDEO_CALL:2,DEVCIED_CAMERA:"camera",DEVCIED_MICROPHONES:"microphones"},t.TUICommonDefine={VideoEncoderParams:{"120p":"120p","120p_2":"120p_2","180p":"180p","180p_2":"180p_2","240p":"240p","360p":"360p","360p_2":"360p_2","480p":"480p","480p_2":"480p_2","720p":"720p","1080p":"1080p","1440p":"1440p","4K":"4K"}}},function(e,t,n){"use strict";(function(t){var i=n(3),r=n(43),a=n(20),s={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!i.isUndefined(e)&&i.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var l,u={transitional:{silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(l=n(21)),l),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),i.isFormData(e)||i.isArrayBuffer(e)||i.isBuffer(e)||i.isStream(e)||i.isFile(e)||i.isBlob(e)?e:i.isArrayBufferView(e)?e.buffer:i.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):i.isObject(e)||t&&"application/json"===t["Content-Type"]?(o(t,"application/json"),function(e,t,n){if(i.isString(e))try{return(t||JSON.parse)(e),i.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(n||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,s=!n&&"json"===this.responseType;if(s||r&&i.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(s){if("SyntaxError"===e.name)throw a(e,this,"E_JSON_PARSE");throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},i.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),i.forEach(["post","put","patch"],(function(e){u.headers[e]=i.merge(s)})),e.exports=u}).call(this,n(42))},function(e){e.exports=JSON.parse('{"name":"tuicall-engine-webrtc","version":"2.0.1","description":"腾讯云 tuicall-engine-webrtc","main":"index","private":true,"dependencies":{"trtc-js-sdk":"^4.15.7","@tencentcloud/chat":"^3.0.0","rtc-ai-denoiser":"^1.1.3","EventEmitter":"^1.0.0","axios":"^0.21.0","dayjs":"^1.11.7"},"devDependencies":{"@babel/preset-typescript":"^7.12.7","@tencent/eslint-config-tencent":"^0.16.1","@typescript-eslint/eslint-plugin":"^4.33.0","@typescript-eslint/parser":"^4.33.0","docdash-blue":"^1.1.9","eslint":"^7.27.0","eslint-config-google":"^0.14.0","eslint-plugin-prettier":"^4.0.0","fs-extra":"^9.0.1","jsdoc":"^3.6.11","prettier":"^2.5.0","pretty":"^2.0.0","replace":"^1.2.2","rimraf":"^4.1.2","ts-loader":"^8.4.0","typescript":"^3.9.7","watch":"^1.0.2","webpack":"^4.44.1","webpack-cli":"^3.3.12"},"scripts":{"watch":"watch \'npm run build_withcopy3\' src","dev":"npm run watch","build":"webpack --config webpack.config.js","build_withcopy":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../../github/TUICalling/Web/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy2":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ../sdk/trtc-calling-webrtc-demo/node_modules/tuicall-engine-webrtc/tuicall-engine-webrtc.js","build_withcopy3":"npm run build && cp dist/npm/tuicall-engine-webrtc.js ./example-js/tuicall-engine-webrtc.js","build:package":"node build/package-bundle.js","lint":"./node_modules/.bin/eslint ./src; exit 0","fix":"./node_modules/.bin/eslint --fix ./src; exit 0","prerelease":"npm run lint && npm run build && npm run doc && npm run build:package","doc":"npm run doc:clean && tsc  --target ESNEXT && npm run doc:build","doc:build":"npm run changelog && npm run main && ./node_modules/.bin/jsdoc -c build/jsdoc/jsdoc.json && node ./build/jsdoc/fix-doc.js","doc:clean":"node ./build/jsdoc/clean-doc.js","changelog":"cp CHANGELOG.md build/jsdoc/tutorials/20-CHANGELOG.md","main":"cp README.md build/jsdoc/main.md"},"repository":{"type":"git","url":"https://github.com/tencentyun/TUICallKit/tree/main/Web"},"author":"Tencent Cloud Terminal R&D Center","license":"ISC"}')},function(t,n){t.exports=e},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return e.apply(t,n)}}},function(e,t,n){"use strict";var i=n(3);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var a;if(n)a=n(t);else if(i.isURLSearchParams(t))a=t.toString();else{var s=[];i.forEach(t,(function(e,t){null!=e&&(i.isArray(e)?t+="[]":e=[e],i.forEach(e,(function(e){i.isDate(e)?e=e.toISOString():i.isObject(e)&&(e=JSON.stringify(e)),s.push(r(t)+"="+r(e))})))})),a=s.join("&")}if(a){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+a}return e}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r){return e.config=t,n&&(e.code=n),e.request=i,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var i=n(3),r=n(44),a=n(45),s=n(19),o=n(46),l=n(49),u=n(50),c=n(22);e.exports=function(e){return new Promise((function(t,n){var d=e.data,h=e.headers,p=e.responseType;i.isFormData(d)&&delete h["Content-Type"];var _=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",E=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";h.Authorization="Basic "+btoa(f+":"+E)}var I=o(e.baseURL,e.url);function g(){if(_){var i="getAllResponseHeaders"in _?l(_.getAllResponseHeaders()):null,a={data:p&&"text"!==p&&"json"!==p?_.response:_.responseText,status:_.status,statusText:_.statusText,headers:i,config:e,request:_};r(t,n,a),_=null}}if(_.open(e.method.toUpperCase(),s(I,e.params,e.paramsSerializer),!0),_.timeout=e.timeout,"onloadend"in _?_.onloadend=g:_.onreadystatechange=function(){_&&4===_.readyState&&(0!==_.status||_.responseURL&&0===_.responseURL.indexOf("file:"))&&setTimeout(g)},_.onabort=function(){_&&(n(c("Request aborted",e,"ECONNABORTED",_)),_=null)},_.onerror=function(){n(c("Network Error",e,null,_)),_=null},_.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(c(t,e,e.transitional&&e.transitional.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",_)),_=null},i.isStandardBrowserEnv()){var v=(e.withCredentials||u(I))&&e.xsrfCookieName?a.read(e.xsrfCookieName):void 0;v&&(h[e.xsrfHeaderName]=v)}"setRequestHeader"in _&&i.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:_.setRequestHeader(t,e)})),i.isUndefined(e.withCredentials)||(_.withCredentials=!!e.withCredentials),p&&"json"!==p&&(_.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&_.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&_.upload&&_.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){_&&(_.abort(),n(e),_=null)})),d||(d=null),_.send(d)}))}},function(e,t,n){"use strict";var i=n(20);e.exports=function(e,t,n,r,a){var s=new Error(e);return i(s,t,n,r,a)}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){t=t||{};var n={},r=["url","method","data"],a=["headers","auth","proxy","params"],s=["baseURL","transformRequest","transformResponse","paramsSerializer","timeout","timeoutMessage","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","decompress","maxContentLength","maxBodyLength","maxRedirects","transport","httpAgent","httpsAgent","cancelToken","socketPath","responseEncoding"],o=["validateStatus"];function l(e,t){return i.isPlainObject(e)&&i.isPlainObject(t)?i.merge(e,t):i.isPlainObject(t)?i.merge({},t):i.isArray(t)?t.slice():t}function u(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(e[r],t[r])}i.forEach(r,(function(e){i.isUndefined(t[e])||(n[e]=l(void 0,t[e]))})),i.forEach(a,u),i.forEach(s,(function(r){i.isUndefined(t[r])?i.isUndefined(e[r])||(n[r]=l(void 0,e[r])):n[r]=l(void 0,t[r])})),i.forEach(o,(function(i){i in t?n[i]=l(e[i],t[i]):i in e&&(n[i]=l(void 0,e[i]))}));var c=r.concat(a).concat(s).concat(o),d=Object.keys(e).concat(Object.keys(t)).filter((function(e){return-1===c.indexOf(e)}));return i.forEach(d,u),n}},function(e,t,n){"use strict";function i(e){this.message=e}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,e.exports=i},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.validateBusiness=t.businessValidate=void 0;var a=n(9),s=n(4),o=n(6),l=n(5);function u(e,t,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this.tim.callExperimentalAPI("isCommercialAbilityEnabled",e)];case 1:if(i.sent().data.enabled)return[2,t.apply(this,n)];try{e===l.CALL_EXPERMENTEL_API_TYPE.BASE&&(this._callDataReport.setCodeAndMessage(s.default.ERROR_PACKAGE_NOT_SUPPORTED,o.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED),this._callDataReport.uploadToKibana())}catch(e){console.warn("base ability check failed, userId:"+this.getUserID()+", error: "+e)}throw new a.default({message:o.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:s.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new a.default({message:o.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:s.default.ERROR_TIM_VERSION_OUTDATED}):new a.default({message:o.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:s.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}t.businessValidate=function(e){return function(t,n,a){var s=a.value;return a.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,u.call(this,e,s,t)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},a}},t.validateBusiness=function(e,t){return i(this,void 0,void 0,(function(){var n;return r(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.callExperimentalAPI("isCommercialAbilityEnabled",t)];case 1:if((n=i.sent()).data.enabled)return[2,Promise.resolve(n.data.enabled)];throw new a.default({message:o.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:s.default.ERROR_PACKAGE_NOT_SUPPORTED});case 2:throw 2905===i.sent().code?new a.default({message:o.ERROR_MESSAGE.ERROR_TIM_VERSION_OUTDATED+" >= 2.21.2",code:s.default.ERROR_TIM_VERSION_OUTDATED}):new a.default({message:o.ERROR_MESSAGE.ERROR_PACKAGE_NOT_SUPPORTED,code:s.default.ERROR_PACKAGE_NOT_SUPPORTED});case 3:return[2]}}))}))}},function(e,n){e.exports=t},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.callRoleMapping=t.callTypeMapping=void 0;var i=n(5),r=n(0);t.callTypeMapping=function(e){var t=r.NAME.UNKNOWN;switch(e){case i.CALL_TYPE.AUDIO_CALL:t=r.NAME.AUDIO;break;case i.CALL_TYPE.VIDEO_CALL:t=r.NAME.VIDEO}return t},t.callRoleMapping=function(e){var t=e;return t===i.CALL_ROLE.INVITER?t=r.NAME.CALLER:t===i.CALL_ROLE.INVITEE&&(t=r.NAME.CALLEE),t}},function(e,t,n){e.exports=n(37)},function(e,t,n){e.exports=function(){"use strict";var e=6e4,t=36e5,n="millisecond",i="second",r="minute",a="hour",s="day",o="week",l="month",u="quarter",c="year",d="date",h="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},E=function(e,t,n){var i=String(e);return!i||i.length>=t?e:""+Array(t+1-i.length).join(n)+e},I={s:E,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),i=Math.floor(n/60),r=n%60;return(t<=0?"+":"-")+E(i,2,"0")+":"+E(r,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var i=12*(n.year()-t.year())+(n.month()-t.month()),r=t.clone().add(i,l),a=n-r<0,s=t.clone().add(i+(a?-1:1),l);return+(-(i+(n-r)/(a?r-s:s-r))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:c,w:o,d:s,D:d,h:a,m:r,s:i,ms:n,Q:u}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},g="en",v={};v[g]=f;var C=function(e){return e instanceof y},T=function e(t,n,i){var r;if(!t)return g;if("string"==typeof t){var a=t.toLowerCase();v[a]&&(r=a),n&&(v[a]=n,r=a);var s=t.split("-");if(!r&&s.length>1)return e(s[0])}else{var o=t.name;v[o]=t,r=o}return!i&&r&&(g=r),r||!i&&g},m=function(e,t){if(C(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new y(n)},A=I;A.l=T,A.i=C,A.w=function(e,t){return m(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var y=function(){function f(e){this.$L=T(e.locale,null,!0),this.parse(e)}var E=f.prototype;return E.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(A.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var i=t.match(p);if(i){var r=i[2]-1||0,a=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)):new Date(i[1],r,i[3]||1,i[4]||0,i[5]||0,i[6]||0,a)}}return new Date(t)}(e),this.$x=e.x||{},this.init()},E.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},E.$utils=function(){return A},E.isValid=function(){return!(this.$d.toString()===h)},E.isSame=function(e,t){var n=m(e);return this.startOf(t)<=n&&n<=this.endOf(t)},E.isAfter=function(e,t){return m(e)<this.startOf(t)},E.isBefore=function(e,t){return this.endOf(t)<m(e)},E.$g=function(e,t,n){return A.u(e)?this[t]:this.set(n,e)},E.unix=function(){return Math.floor(this.valueOf()/1e3)},E.valueOf=function(){return this.$d.getTime()},E.startOf=function(e,t){var n=this,u=!!A.u(t)||t,h=A.p(e),p=function(e,t){var i=A.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return u?i:i.endOf(s)},_=function(e,t){return A.w(n.toDate()[e].apply(n.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},f=this.$W,E=this.$M,I=this.$D,g="set"+(this.$u?"UTC":"");switch(h){case c:return u?p(1,0):p(31,11);case l:return u?p(1,E):p(0,E+1);case o:var v=this.$locale().weekStart||0,C=(f<v?f+7:f)-v;return p(u?I-C:I+(6-C),E);case s:case d:return _(g+"Hours",0);case a:return _(g+"Minutes",1);case r:return _(g+"Seconds",2);case i:return _(g+"Milliseconds",3);default:return this.clone()}},E.endOf=function(e){return this.startOf(e,!1)},E.$set=function(e,t){var o,u=A.p(e),h="set"+(this.$u?"UTC":""),p=(o={},o[s]=h+"Date",o[d]=h+"Date",o[l]=h+"Month",o[c]=h+"FullYear",o[a]=h+"Hours",o[r]=h+"Minutes",o[i]=h+"Seconds",o[n]=h+"Milliseconds",o)[u],_=u===s?this.$D+(t-this.$W):t;if(u===l||u===c){var f=this.clone().set(d,1);f.$d[p](_),f.init(),this.$d=f.set(d,Math.min(this.$D,f.daysInMonth())).$d}else p&&this.$d[p](_);return this.init(),this},E.set=function(e,t){return this.clone().$set(e,t)},E.get=function(e){return this[A.p(e)]()},E.add=function(n,u){var d,h=this;n=Number(n);var p=A.p(u),_=function(e){var t=m(h);return A.w(t.date(t.date()+Math.round(e*n)),h)};if(p===l)return this.set(l,this.$M+n);if(p===c)return this.set(c,this.$y+n);if(p===s)return _(1);if(p===o)return _(7);var f=(d={},d[r]=e,d[a]=t,d[i]=1e3,d)[p]||1,E=this.$d.getTime()+n*f;return A.w(E,this)},E.subtract=function(e,t){return this.add(-1*e,t)},E.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var i=e||"YYYY-MM-DDTHH:mm:ssZ",r=A.z(this),a=this.$H,s=this.$m,o=this.$M,l=n.weekdays,u=n.months,c=n.meridiem,d=function(e,n,r,a){return e&&(e[n]||e(t,i))||r[n].slice(0,a)},p=function(e){return A.s(a%12||12,e,"0")},f=c||function(e,t,n){var i=e<12?"AM":"PM";return n?i.toLowerCase():i};return i.replace(_,(function(e,i){return i||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return A.s(t.$y,4,"0");case"M":return o+1;case"MM":return A.s(o+1,2,"0");case"MMM":return d(n.monthsShort,o,u,3);case"MMMM":return d(u,o);case"D":return t.$D;case"DD":return A.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,l,2);case"ddd":return d(n.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(a);case"HH":return A.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return f(a,s,!0);case"A":return f(a,s,!1);case"m":return String(s);case"mm":return A.s(s,2,"0");case"s":return String(t.$s);case"ss":return A.s(t.$s,2,"0");case"SSS":return A.s(t.$ms,3,"0");case"Z":return r}return null}(e)||r.replace(":","")}))},E.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},E.diff=function(n,d,h){var p,_=this,f=A.p(d),E=m(n),I=(E.utcOffset()-this.utcOffset())*e,g=this-E,v=function(){return A.m(_,E)};switch(f){case c:p=v()/12;break;case l:p=v();break;case u:p=v()/3;break;case o:p=(g-I)/6048e5;break;case s:p=(g-I)/864e5;break;case a:p=g/t;break;case r:p=g/e;break;case i:p=g/1e3;break;default:p=g}return h?p:A.a(p)},E.daysInMonth=function(){return this.endOf(l).$D},E.$locale=function(){return v[this.$L]},E.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),i=T(e,t,!0);return i&&(n.$L=i),n},E.clone=function(){return A.w(this.$d,this)},E.toDate=function(){return new Date(this.valueOf())},E.toJSON=function(){return this.isValid()?this.toISOString():null},E.toISOString=function(){return this.$d.toISOString()},E.toString=function(){return this.$d.toUTCString()},f}(),L=y.prototype;return m.prototype=L,[["$ms",n],["$s",i],["$m",r],["$H",a],["$W",s],["$M",l],["$y",c],["$D",d]].forEach((function(e){L[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),m.extend=function(e,t){return e.$i||(e(t,y,m),e.$i=!0),m},m.locale=T,m.isDayjs=C,m.unix=function(e){return m(1e3*e)},m.en=v[g],m.Ls=v,m.p={},m}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(32),r=n(12),a=n(14);t.default={TUICallEngine:i.default,TUICallEvent:r.TUICallEvent,TUICallType:a.TUICallType}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__decorate||function(e,t,n,i){var r,a=arguments.length,s=a<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,i);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(a<3?r(s):a>3?r(t,n,s):r(t,n))||s);return a>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},l=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var u=n(33),c=n(1),d=n(34),h=n(17),p=n(27),_=n(57),f=n(58),E=n(10),I=n(11),g=n(13),v=n(7),C=n(59),T=n(2),m=n(5),A=n(9),y=n(4),L=n(6),D=n(0),R=n(60),S=n(67),N=n(69),O=h,b=n(16),w="TUICallEngine",U="设备授权: https://web.sdk.qcloud.com/component/trtccalling/doc/TUICallEngine/web/tutorial-33-device-permission.html; 页面能力检测: https://web.sdk.qcloud.com/component/trtccalling/doc/TUICallEngine/web/tutorial-34-detect.html",M=function(){function e(e){this._localPlayOptions={mirror:!1,muted:!0,objectFit:D.NAME.COVER},this._remotePlayOptions={mirror:!1,muted:!1,objectFit:D.NAME.COVER},this._permission={audio:!1,video:!1},this._initialCallId="",this._sdkAppID=e.SDKAppID,this._isLogin=!1,this._trtcClient=null,this._userID="",this._userSig="",this._switchCallModeStatus=!0,this._timExternal=!1,this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._callTimeout=30,this._callStatus=m.CALL_STATUS.IDLE,this._callType=m.CALL_TYPE.UNKNOWN,this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],sessionStorage.setItem("sdkAppId",""+this._sdkAppID),this._localViewId="",this._netMonitor=new C.default,this._outerEmitter=new u.default,this._delegate=new f.default(this._outerEmitter),this._callDataReport=new S.CallDataReport({version:b.version,sdkAppId:e.SDKAppID}),this._dataReportObserver=new S.TUICallEngineObserver(this._outerEmitter,this._callDataReport),this._connectStartTime=0,e.tim&&(this._timExternal=!0),this.tim=e.tim||p.create(e),this._tsignalingClient=new _.default(this,i(i({},e),{tim:this.tim,isRejectNotifyAll:!0})),this._callRecordReport=new N.CallRecordReport({version:b.version,tim:this.tim}),this._recordReportObserver=new N.TUICallEngineRecordObserver(this._outerEmitter,this._callRecordReport),this._quality="480p";var t=new E.default(I.default.SDK_CONSTRUCT);this._eventStatController=new g.default,E.default.bindController(this._eventStatController),t.setText("version="+b.version+"-ua="+v.USER_AGENT).setEnd(),T.default.info(w+" SDK Version:"+b.version+", SDKAppID:"+e.SDKAppID+", UserAgent:"+v.USER_AGENT)}return e.prototype.getDevicePermission=function(){return this._permission},e.prototype.setDevicePermission=function(e,t){this._permission[e]=t},e.prototype.getTrtcClient=function(){var e;return null===(e=this._trtcClient)||void 0===e?void 0:e.getClient()},e.prototype.getUserID=function(){return this._userID},e.prototype.setRoomID=function(e){this._roomID=e},e.prototype.getRoomID=function(){return this._roomID},e.prototype.getCallType=function(){return this._callType},e.prototype.setCallType=function(e){this._callType=e},e.prototype.isInviter=function(){return this._isInviter},e.prototype.setConnectStartTime=function(e){this._connectStartTime=e},e.prototype.getConnectStartTime=function(){return this._connectStartTime},e.prototype.getInviteeList=function(){return this._inviteeList},e.prototype.setInviteeList=function(e){this._inviteeList=l(e)},e.prototype.getCallDataReport=function(){return this._callDataReport},e.prototype.getCallRecordReport=function(){return this._callRecordReport},e.prototype.getUnHandledInviteeList=function(){return this._unHandledInviteeList||[]},e.prototype.setUnHandledInviteeList=function(e){this._unHandledInviteeList=l(e),T.default.log(w+".setUnHandledInviteeList",this._unHandledInviteeList)},e.prototype.addUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._unHandledInviteeList.indexOf(e)&&t._unHandledInviteeList.push(e)}))},e.prototype.deleteUnHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._unHandledInviteeList=t._unHandledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.getHandledInviteeList=function(){return this._handledInviteeList||[]},e.prototype.setHandledInviteeList=function(e){this._handledInviteeList=l(e),T.default.log(w+".setHandledInviteeList",this._handledInviteeList)},e.prototype.addHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){-1===t._handledInviteeList.indexOf(e)&&t._handledInviteeList.push(e)}))},e.prototype.deleteHandledInviteeList=function(e){var t=this;void 0===e&&(e=[]),0!==e.length&&e.forEach((function(e){t._handledInviteeList=t._handledInviteeList.filter((function(t){return t!==e}))}))},e.prototype.isGroupCall=function(){return this._isGroupCall},e.prototype.setIsGroupCall=function(e){this._isGroupCall=e},e.prototype.getGroupID=function(){return this._groupID},e.prototype.setGroupID=function(e){this._groupID=e},e.prototype.setLocalPlayOptions=function(e){void 0===e&&(e={}),this._localPlayOptions=i(i({},this._localPlayOptions),e)},e.prototype.getLocalPlayOptions=function(){return this._localPlayOptions||{}},e.prototype.setRemotePlayOptions=function(e){void 0===e&&(e={}),this._remotePlayOptions=i(i({},this._remotePlayOptions),e)},e.prototype.getRemotePlayOptions=function(){return this._remotePlayOptions||{}},e.prototype.addAcceptedUserList=function(e,t){var n=this;if(0!==t.length)if(e)0===(this._acceptedUserObject[e]||[]).length?this._acceptedUserObject[e]=t:t.forEach((function(t){-1===n._acceptedUserObject[e].indexOf(t)&&n._acceptedUserObject[e].push(t)}));else for(var i=this.getInviterInviteIdList(),r=function(e){var r=i[e],s=a.getInviterInviteIdUserList(r),o=t.filter((function(e){return-1!==s.indexOf(e)}));0===(a._acceptedUserObject[r]||[]).length?a._acceptedUserObject[r]=o:o.forEach((function(e){-1===n._acceptedUserObject[r].indexOf(e)&&n._acceptedUserObject[r].push(e)}))},a=this,s=0;s<i.length;s++)r(s)},e.prototype.getAcceptedUserList=function(e){return this._acceptedUserObject[e]||[]},e.prototype.setIsLogin=function(e){this._isLogin=e},e.prototype.getIsLogin=function(){return this._isLogin},e.createInstance=function(t){return e.instance||(e.instance=new e(t)),e.instance},e.prototype.destroyInstance=function(){return s(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this.getIsLogin()?this._timExternal?[4,this.logout()]:[3,2]:[3,4];case 1:return t.sent(),[3,4];case 2:return[4,this.tim.destroy()];case 3:t.sent(),t.label=4;case 4:return this._callDataReport.reset(),this._dataReportObserver.removeLister(),this._callRecordReport.reset(),this._recordReportObserver.removeLister(),e.instance=null,[2]}}))}))},e.prototype.setLogLevel=function(e){T.default.setLevel(e),this._tsignalingClient.setLogLevel(e),O.Logger.setLogLevel(1)},e.prototype.on=function(e,t,n){this._outerEmitter.on(e,t,n||this)},e.prototype.off=function(e,t,n){this._outerEmitter.off(e,t,n||this)},e.prototype.init=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.login(e)]}))}))},e.prototype.login=function(e){return s(this,void 0,void 0,(function(){var t,n,i,r,a;return o(this,(function(s){switch(s.label){case 0:if(this.getIsLogin())return T.default.warn(w+".login - userId has been login"),[2];s.label=1;case 1:return s.trys.push([1,3,,4]),T.default.debug(w+".login - params:",e),this._netMonitor.start(),t=e.userID,n=e.userSig,i=e.assetsPath,this._userID=t,this._callDataReport.setUserID(t),this._userSig=n,this._trtcClient=new d.default({sdkAppID:this._sdkAppID,userID:t,userSig:n,tuiCallEngine:this,assetsPath:i}),sessionStorage.setItem("userId",""+this._userID),[4,this._tsignalingClient.login({userID:t,userSig:n})];case 2:return r=s.sent(),this.setIsLogin(!0),this._setInterfaceUpLoad(I.default.LOGIN).setText("userId: "+this._userID+" login succeeded, assetsPath: "+i).setEnd(),[2,r];case 3:throw a=s.sent(),this._setInterfaceUpLoad(I.default.LOGIN).setText("userId: "+this._userID+" login failed, error: "+a).setEnd(),new Error(w+".login - userId: "+this._userID+" login failed, error: "+a+" ");case 4:return[2]}}))}))},e.prototype.logout=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:T.default.debug(w+".logout"),this._setInterfaceUpLoad(I.default.LOGOUT).setText("userId: "+this._userID+" logout").setEnd(),this._userID="",this._userSig="",t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this._resetTUICallEngine()];case 2:return t.sent(),this._trtcClient.removeTRTCEvents(),this._trtcClient=null,this.setIsLogin(!1),this._timExternal?[3,4]:[4,this._tsignalingClient.logout()];case 3:t.sent(),t.label=4;case 4:return[2,!0];case 5:throw e=t.sent(),new Error(w+".logout failed, error: "+e+" ");case 6:return[2]}}))}))},e.prototype.call=function(e){var t,n;return s(this,void 0,void 0,(function(){var r,a,s,l,u,d,h,p,_,f,E,g;return o(this,(function(o){switch(o.label){case 0:T.default.log(w+".call - params:",e),this._callDataReport.setAbilityBit(!0),this._callDataReport.setCallScene(D.NAME.SINGLE_CALL),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 2:return o.sent(),[3,4];case 3:throw r=o.sent(),this._delegate.onError(y.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.setCodeAndMessage(y.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),this._callDataReport.uploadToKibana(),new Error(w+".call failed. error: "+r+". "+U);case 4:if(a=e.userID,s=e.type,l=e.offlinePushInfo,u=e.roomID,d=e.timeout,h=e.userData,this.getUserID()===a)throw T.default.log(w+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+a),new Error(w+".call failed. Called id can't be yourself. userId:"+this.getUserID()+", inviteeId:"+a);this._callStatus=m.CALL_STATUS.CALLING,this._callType=s,this._isInviter=!0,this._inviterID=this._userID,this._inviteeID=a,this._isGroupCall=!1,this._groupID="",this._roomID=u||c.generateRandomRoomID(),this._callTimeout=d||this._callTimeout,T.default.info("roomID:"+this._roomID),p={callType:D.NAME.SINGLE,mediaType:s,inviteeList:[a]},o.label=5;case 5:return o.trys.push([5,11,,13]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(this._roomID)];case 6:return o.sent(),this._callDataReport.setEnterRoomTime((new Date).getTime()),this._tsignalingClient.setTSignalingIsJoined(!0),_=this._callDataReport.getCallData(),_=i(i({},_),{roomID:this._roomID,callRole:m.CALL_ROLE.INVITER,callType:this._callType,inviteeList:[a]}),this._callDataReport.setCallData(_),[4,this._tsignalingClient.invite({userID:a,type:s,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:l,userIDList:[a],userData:h})];case 7:return f=o.sent(),this._callDataReport.setSendSignalingTime((new Date).getTime()),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList([a]),E="callType: "+(s+1)+",\n        conversationType: "+f.data.message.conversationType+", \n        userId:{ "+f.data.message.from+" } invite userId:{ "+f.data.message.to+" }",0!==f.code?[3,8]:(this.addInviterInviteId(f.inviteID,[this._userID,a]),this._callDataReport.setInviteID(f.inviteID),this.setInitialCallId(f.inviteID),this._callRecordUpload(i({eventType:D.NAME.START_CALL},p)),this._setInterfaceUpLoad(I.default.CALL).setCallType(s+1).setText(E+" succeeded").setEnd(),[3,10]);case 8:return this._callDataReport.setCodeAndMessage(f.code,f.message),this._callDataReport.uploadToKibana(),this._callRecordUpload(i({eventType:D.NAME.CALL_FAILED},p)),this._setInterfaceUpLoad(I.default.CALL).setCallType(s+1).setText(E+" failed").setEnd(),[4,this._resetTUICallEngine()];case 9:o.sent(),o.label=10;case 10:return[2,f];case 11:return(g=o.sent()).getCode?this._callDataReport.setCodeAndMessage(g.getCode(),g.message):this._callDataReport.setCodeAndMessage(y.default.UNKNOWN,JSON.stringify(g)),this._callDataReport.uploadToKibana(),this._callRecordUpload(i({eventType:D.NAME.CALL_FAILED},p)),[4,this._resetTUICallEngine()];case 12:throw o.sent(),new A.default({message:w+"<call>: failed "+g.message,code:g.code});case 13:return[2]}}))}))},e.prototype.addAudioVideoSwitchIdList=function(e){e&&this._audioVideoSwitchIdList.push(e)},e.prototype.getAudioVideoSwitchIdList=function(){return this._audioVideoSwitchIdList||[]},e.prototype.addInviterInviteId=function(e,t){0!==t.length&&(0===(this._inviterInviteID[e]||[]).length?this._inviterInviteID[e]=t:this._inviterInviteID[e]=l(this._inviterInviteID[e],t))},e.prototype.getInviterInviteIdList=function(){return Object.keys(this._inviterInviteID||{})},e.prototype.getTotalInviterInviteIdList=function(){var e=this.getInviterInviteIdList();return l(this._audioVideoSwitchIdList,e)},e.prototype.getInviterInviteIdUserList=function(e){return this._inviterInviteID[e]||[]},e.prototype._setInterfaceUpLoad=function(e){return T.default.time(e),new E.default(e)},e.prototype.getInviterID=function(){return this._inviterID},e.prototype.setInviterID=function(e){this._inviterID=e},e.prototype.groupCall=function(e){var t,n;return s(this,void 0,void 0,(function(){var r,a,s,u,d,h,p,_,f,E,g,v;return o(this,(function(o){switch(o.label){case 0:if(0===(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length))throw new A.default({message:w+"<groupCall>: userIDList don'\t empty ",code:y.default.ERROR_PARAM_INVALID});T.default.debug(w+".groupCall - params:",e),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 2:return o.sent(),[3,4];case 3:throw r=o.sent(),this._delegate.onError(y.default.NOT_MEDIA_ACCESS,JSON.stringify(r)),new Error(w+".groupCall failed. error: "+r+". "+U);case 4:if(a=e.userIDList,s=e.type,u=e.groupID,d=e.offlinePushInfo,h=e.roomID,p=e.timeout,_=e.userData,-1!==(a=l(a)).indexOf(this.getUserID()))throw T.default.log(w+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+a),new Error(w+".groupCall failed. Called list can't contain yourself. userId:"+this.getUserID()+", inviteeIdList:"+a);this._callType=s,this._isInviter=!0,this._isGroupCall=!0,this._inviterID=this._userID,this._groupID=u||"",this.setInviteeList(a),this.setHandledInviteeList([this._userID]),this.setUnHandledInviteeList(a),this._roomID||(this._roomID=h||c.generateRandomRoomID(),this._callStatus=m.CALL_STATUS.CALLING),this._callTimeout=p||this._callTimeout,this._callDataReport.setCallScene(D.NAME.GROUP_CALL),f={callType:D.NAME.GROUP,mediaType:s,inviteeList:a},o.label=5;case 5:return o.trys.push([5,8,,10]),[4,this._trtcClient.join(this._roomID)];case 6:return o.sent(),this._tsignalingClient.setTSignalingIsJoined(!0),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:a,type:s,roomID:this._roomID,timeout:this._callTimeout,offlinePushInfo:d,userData:_})];case 7:return E=o.sent(),T.default.log("groupCall res",E),u&&(g="callType: "+(s+1)+",\n        conversationType: "+E.data.message.conversationType+",\n        userId:{ "+E.data.message.from+" } invite { "+E.data.message.to+": "+a+" }",0===E.code?(this.addInviterInviteId(E.inviteID,l([this._userID],a)),this.setInitialCallId(E.inviteID),this._callRecordUpload(i({eventType:D.NAME.START_CALL},f)),this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(s+1).setText(g+"  succeeded").setEnd()):(this._callRecordUpload(i({eventType:D.NAME.CALL_FAILED},f)),this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(s+1).setText(g+"  failed").setEnd())),[2,E];case 8:return v=o.sent(),this._callRecordUpload(i({eventType:D.NAME.CALL_FAILED},f)),[4,this._resetTUICallEngine()];case 9:throw o.sent(),new A.default({message:w+"<groupCall>: failed "+v.message,code:v.code});case 10:return[2]}}))}))},e.prototype.joinInGroupCall=function(e){var t,n;return s(this,void 0,void 0,(function(){var i,r,a,s,l,u;return o(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({audio:!0})];case 1:return o.sent(),[3,3];case 2:throw i=o.sent(),new Error(w+".joinInGroupCall failed, error: "+i);case 3:return o.trys.push([3,5,,7]),r=e.roomID,a=e.type,s=e.groupID,this._callType=a,this._groupID=s,this._roomID=r,this._isGroupCall=!0,this._isInviter=!1,this.addHandledInviteeList([this.getUserID()]),this.changeCallStatus(m.CALL_STATUS.CALLING),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.join(r)];case 4:return o.sent(),this.changeCallStatus(m.CALL_STATUS.CONNECTED),T.default.log(w+".joinInGroupCall roomID:"+r+",type:"+a+",userID:"+this.getUserID()),l={eventType:D.NAME.JOIN_IN_GROUP_CALL,callType:D.NAME.GROUP,mediaType:this._callType},this._callRecordUpload(l),this._callRecordReport.startHeartbeat(),[3,7];case 5:return u=o.sent(),[4,this._resetTUICallEngine()];case 6:throw o.sent(),new Error(w+".joinInGroupCall failed error: "+u);case 7:return[2]}}))}))},e.prototype.inviteUser=function(e){return s(this,void 0,void 0,(function(){var t,n,i,r,a,s,u,c,d,h,p,_,f=this;return o(this,(function(o){switch(o.label){case 0:if(!this.isGroupCall())throw T.default.error(w+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType),new Error(w+".inviteUser failed - groupID:"+this._groupID+", roomID:"+this._roomID+", type:"+this._callType);if(!this.isInviter()&&this._callStatus!==m.CALL_STATUS.CONNECTED)throw T.default.error(w+".inviteUser failed - current status:"+this._callStatus+" not support"),new Error(w+".inviteUser failed - current status:"+this._callStatus+" not support");if(t=e.userIDList,n=void 0===t?[]:t,i=e.offlinePushInfo,0===n.length)throw T.default.error(w+".inviteUser failed - userIDList is empty"),new Error(w+".inviteUser failed - userIDList is empty");if(r=this.getHandledInviteeList(),a=this.getUnHandledInviteeList(),s=l(r,a),0===(u=n.filter((function(e){return-1===s.indexOf(e)}))).length)return T.default.error(w+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(s)),[2,Promise.reject(w+".inviteUser failed - userIDList in call list. userIDList:"+JSON.stringify(n)+", call list:"+JSON.stringify(s))];n=u,o.label=1;case 1:return o.trys.push([1,3,,4]),c=this._handledInviteeList.filter((function(e){return e!==f._userID})),[4,this._tsignalingClient.inviteInGroup({groupID:this._groupID,userIDList:n,type:this._callType,roomID:this._roomID,timeout:this._callTimeout,inCallUserIDs:l(this._unHandledInviteeList,c),offlinePushInfo:i,initialCallId:this.getInitialCallId()})];case 2:return d=o.sent(),T.default.log("inviteUser res",d),h="callType: "+(this._callType+1)+",\n      conversationType: "+d.data.message.conversationType+",\n      userId:{ "+d.data.message.from+" } invite { "+d.data.message.to+": "+n+" }",0===d.code?(this.addUnHandledInviteeList(n),this.addInviterInviteId(d.inviteID,l([this._userID],n)),p={eventType:D.NAME.INVITE_USER,callType:D.NAME.GROUP,mediaType:this._callType,inviteeList:n},this._callRecordUpload(p),this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(this._callType+1).setText(h+" succeeded").setEnd()):this._setInterfaceUpLoad(I.default.GROUP_CALL).setCallType(this._callType+1).setText(h+"  failed").setEnd(),[2,d];case 3:throw _=o.sent(),new Error(w+".inviteUser failed, userId:"+this.getUserID()+", inviteeIdList:"+n+", error: "+_);case 4:return[2]}}))}))},e.prototype.accept=function(){var e,t,n,r,a,l;return s(this,void 0,void 0,(function(){var s,u,c,d,h,p,_,f,E,g,v;return o(this,(function(o){switch(o.label){case 0:if(T.default.debug(w+".accept"),this.getCallStatus()===m.CALL_STATUS.CONNECTED)return T.default.warn(w+".accept - already connected, avoid repeat accept"),[2];if(!this._tsignalingClient.getInviteData())return T.default.warn(w+".accept - there are no calls to accept"),[2];this._callDataReport.setCallAcceptTime((new Date).getTime()),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.getMediaDevicesAuth({audio:!0})];case 2:return o.sent().audio?[3,4]:[4,this._resetTUICallEngine()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:throw s=o.sent(),this.isGroupCall()&&(this._callDataReport.setCodeAndMessage(y.default.NOT_MEDIA_ACCESS,JSON.stringify(s)),this._callDataReport.uploadToKibana()),new Error(w+".accept failed, error: "+s+". "+U);case 6:u=this._tsignalingClient.getInviteData(),c=u.inviteID,d=u.inviteData,h=d.roomID,p=d.callType,T.default.debug(w+".accept - params","inviteID: "+c+",callType: "+p+",roomID: "+h+"."),this._callType=p,this._callStatus=m.CALL_STATUS.CALLING,console.log("accept roomId: "+h),_={},o.label=7;case 7:return o.trys.push([7,9,,11]),this._callDataReport.setEnterRoomTime((new Date).getTime()),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.join(h)];case 8:return _=o.sent(),this.addHandledInviteeList([this.getUserID()]),this.deleteUnHandledInviteeList([this.getUserID()]),this.addAcceptedUserList(c,[this.getUserID()]),this._tsignalingClient.setInviteData(null),this.changeCallStatus(m.CALL_STATUS.CONNECTED),[3,11];case 9:return f=o.sent(),this.isGroupCall()||(f.getCode?this._callDataReport.setCodeAndMessage(f.getCode(),f.message):this._callDataReport.setCodeAndMessage(y.default.UNKNOWN,JSON.stringify(f)),this._callDataReport.uploadToKibana()),[4,this._resetTUICallEngine()];case 10:throw o.sent(),new Error(w+".accept failed, error: "+f);case 11:_=i(i({},_),{roomID:h,callType:p}),o.label=12;case 12:return o.trys.push([12,14,,16]),[4,this._tsignalingClient.accept({inviteID:c,callType:p})];case 13:return E=o.sent(),v="callType: "+(p+1)+",\n      conversationType: "+E.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+E.data.message.to+" } succeeded",this._callRecordUpload({eventType:D.NAME.ACCEPT_CALL}),this._callRecordReport.startHeartbeat(),this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(p+1).setText(""+v).setEnd(),[3,16];case 14:return g=o.sent(),T.default.error(g),[4,this._resetTUICallEngine()];case 15:throw o.sent(),v="callType: "+(p+1)+",\n      conversationType: "+(null===(r=null===(n=null==E?void 0:E.data)||void 0===n?void 0:n.message)||void 0===r?void 0:r.conversationType)+",\n      userId:{ "+this._userID+" } accept userId:{ "+(null===(l=null===(a=null==E?void 0:E.data)||void 0===a?void 0:a.message)||void 0===l?void 0:l.to)+" } failed",this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(p+1).setText(""+v).setEnd(),this.isGroupCall()||(this._callDataReport.setCodeAndMessage(y.default.UNKNOWN,JSON.stringify(g)),this._callDataReport.uploadToKibana()),new A.default({message:w+"<accept>: failed "+g.message,code:g.code});case 16:return this.isGroupCall()&&(v="callType: "+(p+1)+",\n      conversationType: "+E.data.message.conversationType+",\n      userId:{ "+this._userID+" } accept userId:{ "+E.data.message.to+" } succeeded",this._setInterfaceUpLoad(I.default.ACCEPT).setCallType(p+1).setText(v).setEnd()),[2,i(i({},_),E)]}}))}))},e.prototype.reject=function(){return s(this,void 0,void 0,(function(){var e,t,n,r,a,s,l,u,c;return o(this,(function(o){switch(o.label){case 0:if(!this._tsignalingClient.getInviteData())return T.default.warn(w+".reject - there are no calls to reject"),[2];e=this._callStatus===m.CALL_STATUS.CONNECTED,t=this._tsignalingClient.getInviteData(),n=t.inviteID,r=t.inviteData,a=r.callType,T.default.warn(w+".reject - params","inviteID: "+n+",callType: "+a+",isBusy: "+e+"."),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,this._tsignalingClient.reject({inviteID:n,callType:a,isBusy:e})];case 2:return s=o.sent(),l="callType: "+(a+1)+",\n      conversationType: "+s.data.message.conversationType+",\n      userId:{ "+this._userID+" } reject userId:{ "+s.data.message.to+" } succeeded",this._setInterfaceUpLoad(I.default.REJECT).setCallType(a+1).setText(l).setEnd(),this._callRecordUpload({eventType:D.NAME.REJECT_CALL}),e?[3,4]:(u=this.generateEventData(),[4,this._resetTUICallEngine()]);case 3:o.sent(),this._delegate.onCallingCancel(i(i({userID:this._userID},u),{reason:D.NAME.REJECT})),o.label=4;case 4:return[2,s];case 5:throw c=o.sent(),new A.default({message:w+"<reject>: failed "+c.message,code:c.code});case 6:return[2]}}))}))},e.prototype.hangup=function(){var e;return s(this,void 0,void 0,(function(){var t,n,r,a,s,u,c,d,h,p,_,f,E,g,v,C,A,y,L,R;return o(this,(function(S){switch(S.label){case 0:if(T.default.warn(w+". - callStatus:"+this._callStatus+" _inviterInviteID:"+JSON.stringify(this._acceptedUserObject)),this._callStatus===m.CALL_STATUS.IDLE)throw new Error(w+".hangup failed. current status:"+this._callStatus);if(this._callStatus===m.CALL_STATUS.CALLING&&0===this.getInviterInviteIdList().length)throw new Error(w+".call/groupCall incomplete。please wait cancel");if(t=this.isGroupCall(),n=this.isInviter(),r=this.getUserID(),a=Math.round((Date.now()-this.getConnectStartTime())/1e3),s=this.getCallType(),c=this.getInviterInviteIdList(),this._callStatus!==m.CALL_STATUS.CONNECTED)return[3,8];S.label=1;case 1:return S.trys.push([1,5,,7]),[4,null===(e=this._trtcClient)||void 0===e?void 0:e.leave()];case 2:return S.sent(),0!==c.length?[3,4]:(f=this.generateCallEndData({callMediaType:s,totalTime:a}),this._delegate.onCallEnd(f),[4,this._resetTUICallEngine()]);case 3:S.sent(),S.label=4;case 4:return[3,7];case 5:return d=S.sent(),[4,this._resetTUICallEngine()];case 6:throw S.sent(),new Error(d);case 7:this._setInterfaceUpLoad(I.default.REJECT).setText("userId: "+this._userID+" hangup succeeded").setEnd(),S.label=8;case 8:h=this.getHandledInviteeList(),p=this.getUnHandledInviteeList(),_=this.generateEventData(),S.label=9;case 9:return S.trys.push([9,31,,32]),t?[3,16]:(f=this.generateCallEndData(),n?1!==p.length?[3,11]:[4,this._cancel()]:[3,13]);case 10:return u=S.sent(),this._delegate.onCallingCancel(i(i({userID:r},_),{reason:D.NAME.NORMAL})),[3,12];case 11:this._delegate.onCallEnd(f),S.label=12;case 12:return[3,14];case 13:this._delegate.onCallEnd(f),S.label=14;case 14:return[4,this._resetTUICallEngine()];case 15:return S.sent(),[3,30];case 16:return E=this.getCallStatus(),g={callType:s,userIDList:l(h.filter((function(e){return e!==r})),p),callEnd:a},n?E!==m.CALL_STATUS.CALLING?[3,19]:[4,this._cancel(this.getInviterInviteIdList())]:[3,24];case 17:return u=S.sent(),[4,this._resetTUICallEngine()];case 18:S.sent(),this._delegate.onCallingCancel(i(i({userID:r},_),{reason:D.NAME.NORMAL})),S.label=19;case 19:if(E!==m.CALL_STATUS.CONNECTED)return[3,23];v=function(e){var t,n,i,a,s,d;return o(this,(function(o){switch(o.label){case 0:return t=c[e],n=C.getInviterInviteIdUserList(t),(i=C.getAcceptedUserList(t)).length>0?(a=i.filter((function(e){return-1!==h.indexOf(e)})),s=n.filter((function(e){return-1!==p.indexOf(e)})),g.userIDList=l(a,s).filter((function(e){return e!==r})),T.default.warn("inviter emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,C._tsignalingClient.hangup(g)]):[3,2];case 1:return u=o.sent(),[3,4];case 2:return d=C.getUnHandledInviteeList(),n.filter((function(e){return-1!==d.indexOf(e)})).length>0?(T.default.warn("inviter emit cancel signal, userIdList:"+n),[4,C._cancel([t])]):[3,4];case 3:u=o.sent(),o.label=4;case 4:return[2]}}))},C=this,L=0,S.label=20;case 20:return L<c.length?[5,v(L)]:[3,23];case 21:S.sent(),S.label=22;case 22:return L++,[3,20];case 23:return[3,28];case 24:A=function(e){var t,n,i,a,s,d;return o(this,(function(o){switch(o.label){case 0:return t=c[e],n=y.getInviterInviteIdUserList(t),(i=y.getAcceptedUserList(t)).length>0?(a=i.filter((function(e){return-1!==h.indexOf(e)})),s=n.filter((function(e){return-1!==p.indexOf(e)})),g.userIDList=l(a,s).filter((function(e){return e!==r})),T.default.warn("invitee emit hangup signal, notify userIDList:"+JSON.stringify(g.userIDList)),[4,y._tsignalingClient.hangup(g)]):[3,2];case 1:return u=o.sent(),[3,4];case 2:return d=y.getUnHandledInviteeList(),n.filter((function(e){return-1!==d.indexOf(e)})).length>0?(T.default.warn("invitee emit cancel signal, inviteID:"+t),[4,y._cancel([t])]):[3,4];case 3:u=o.sent(),o.label=4;case 4:return[2]}}))},y=this,L=0,S.label=25;case 25:return L<c.length?[5,A(L)]:[3,28];case 26:S.sent(),S.label=27;case 27:return L++,[3,25];case 28:return[4,this._resetTUICallEngine()];case 29:S.sent(),S.label=30;case 30:return[2,u];case 31:throw R=S.sent(),T.default.warn(w+".hangup failed, error: "+R),new Error(w+".hangup failed, error: "+R);case 32:return[2]}}))}))},e.prototype._cancel=function(e){return s(this,void 0,void 0,(function(){var t,n,i,r,a,s;return o(this,(function(o){switch(o.label){case 0:T.default.log("_cancel _inviterInviteID",this._inviterInviteID),t=[],o.label=1;case 1:o.trys.push([1,6,,7]),0===(e||[]).length&&(e=this.getInviterInviteIdList().slice(0,1)),n=0,o.label=2;case 2:return n<e.length?(i=e[n],[4,this._tsignalingClient.cancel({inviteID:i})]):[3,5];case 3:r=o.sent(),t.push(r),o.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:throw a=o.sent(),new A.default({message:w+"<_cancel>: failed "+a.message,code:a.code});case 7:return s="cancel "+JSON.stringify(t)+" succeeded",T.default.log(w+"._cancel "+s),this._setInterfaceUpLoad(I.default.CALLING_CANCEL).setText(s).setEnd(),[2,t]}}))}))},e.prototype.startRemoteView=function(e){var t;return s(this,void 0,void 0,(function(){var n,i,r;return o(this,(function(a){return T.default.debug(w+".startRemoteView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._setInterfaceUpLoad(I.default.START_REMOTE_VIEW).setText("remote userId:{ "+n+" } startRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.playRemoteVideo({videoViewDomID:i,userID:n,options:r})]}))}))},e.prototype.stopRemoteView=function(e){var t;return s(this,void 0,void 0,(function(){var n;return o(this,(function(i){return T.default.debug(w+".stopRemoteView - params:",e),n=e.userID,this._setInterfaceUpLoad(I.default.STOP_REMOTE_VIEW).setText("remote userId:{ "+n+" } stopRemoveView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopRemoteVideo({userID:n})]}))}))},e.prototype.startLocalView=function(e){var t;return s(this,void 0,void 0,(function(){var n,i,r,a;return o(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),T.default.debug(w+".startLocalView - params:",e),n=e.userID,i=e.videoViewDomID,r=e.options,this._localViewId=i,this._setInterfaceUpLoad(I.default.START_LOCAL_VIEW).setText("remote userId:{ "+n+" } startLocalView succeeded").setEnd(),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.playLocalVideo({videoViewDomID:i,userID:n,options:r})];case 1:return s.sent(),[3,3];case 2:throw a=s.sent(),new Error(w+".startLocalView failed. error: "+a);case 3:return[2]}}))}))},e.prototype.stopLocalView=function(e){var t;return s(this,void 0,void 0,(function(){var n;return o(this,(function(i){return T.default.debug(w+".stopLocalView - params:",e),n=e.userID,this._localViewId="",this._setInterfaceUpLoad(I.default.STOP_LOCAL_VIEW).setText("remote userId:{ "+n+" } stopLocalView succeeded").setEnd(),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.stopLocalVideo()]}))}))},e.prototype.openCamera=function(e){var t;return s(this,void 0,void 0,(function(){var n,i,r;return o(this,(function(a){switch(a.label){case 0:if(a.trys.push([0,2,,3]),n=e,!e){if(!this._localViewId)return T.default.error(w+".openCamera failed. error: A DOM parameter is required to render the camera data"),[2];T.default.warn(w+".openCamera warning. warn: A DOM parameter is required to render the camera data. "+w+".startLocalView() will be deprecated soon."),n=this._localViewId}return i={videoViewDomID:n,userID:this.getUserID()},[4,null===(t=this._trtcClient)||void 0===t?void 0:t.playLocalVideo(i)];case 1:return a.sent(),[3,3];case 2:throw r=a.sent(),T.default.error(w+".openCamera failed. error: "+r),new Error(w+".openCamera failed. error: "+r);case 3:return[2]}}))}))},e.prototype.closeCamera=function(){var e;return s(this,void 0,void 0,(function(){return o(this,(function(t){try{return this._setInterfaceUpLoad(I.default.CLOSE_CAMERA).setText("close camera").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.stopLocalVideo()]}catch(e){throw new Error(w+".closeCamera failed. error: "+e)}return[2]}))}))},e.prototype.openMicrophone=function(){var e;return s(this,void 0,void 0,(function(){return o(this,(function(t){return this._setInterfaceUpLoad(I.default.SET_MIC_MUTE).setText("openMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.unMuteLocalAudio()]}))}))},e.prototype.closeMicrophone=function(){var e;return s(this,void 0,void 0,(function(){return o(this,(function(t){return this._setInterfaceUpLoad(I.default.SET_MIC_MUTE).setText("closeMicrophone").setEnd(),[2,null===(e=this._trtcClient)||void 0===e?void 0:e.muteLocalAudio()]}))}))},e.prototype.setVideoQuality=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return T.default.debug(w+".setVideoQuality - quality:"+JSON.stringify(e)),e===this.getVideoQuality()?(T.default.warn(w+".setVideoQuality failed - profile not change"),[2]):(this._setInterfaceUpLoad(I.default.SET_VIDEO_QUALITY).setText("setVideoQuality: "+JSON.stringify(e)).setEnd(),this._quality=e,this._trtcClient?[4,this._trtcClient._setVideoProfile(this._trtcClient.getLocalStream(),e)]:[3,2]);case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.getVideoQuality=function(){return this._quality},e.prototype.setVideoRenderParams=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return this._trtcClient?[4,this._trtcClient._setVideoRenderParams(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.switchCallMediaType=function(e){return s(this,void 0,void 0,(function(){var t,n;return o(this,(function(i){switch(i.label){case 0:if(this._callType===e)throw new A.default({message:w+"<switchCallMediaType>: "+L.ERROR_MESSAGE.ERROR_REQUEST_REPEATED_SWITCH,code:y.default.ERROR_REQUEST_REPEATED});if(!this._switchCallModeStatus)throw new Error(w+" audio and video call switching.");T.default.log(w+".switchCallMediaType",this._inviterID,this._inviteeID),this._setInterfaceUpLoad(I.default.SWITCH_TO_AUDIO_CALL).setText("switchCallMediaType").setEnd(),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this._tsignalingClient.switchCallMode({userID:this._isInviter?this._inviteeID:this._inviterID,callType:this._callType,roomID:this._roomID,timeout:this._callTimeout,mode:e===m.CALL_TYPE.AUDIO_CALL?m.MODE_TYPE.AUDIO:m.MODE_TYPE.VIDEO})];case 2:return t=i.sent(),this.setSwitchCallModeStatus(!1),[2,t];case 3:throw n=i.sent(),new Error(w+".switchCallMediaType failed, error: "+n);case 4:return[2]}}))}))},e.prototype.setSwitchCallModeStatus=function(e){this._switchCallModeStatus=e},e.prototype.getSwitchCallModeStatus=function(){return this._switchCallModeStatus},e.prototype.getDeviceList=function(e){var t,n;return s(this,void 0,void 0,(function(){return o(this,(function(i){switch(i.label){case 0:if(e!==m.DEVICE_TYPE.CAMERA)return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,null===(t=this._trtcClient)||void 0===t?void 0:t.getMediaDevicesAuth({video:!0,isThrowVideoError:!0})];case 2:return i.sent(),[4,O.getCameras()];case 3:return[2,i.sent()];case 4:throw i.sent(),new A.default({message:w+"<getDeviceList>: "+L.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:y.default.ERROR_PERMISSION_DENIED});case 5:if(e!==m.DEVICE_TYPE.MICROPHONES)return[3,10];i.label=6;case 6:return i.trys.push([6,9,,10]),[4,null===(n=this._trtcClient)||void 0===n?void 0:n.getMediaDevicesAuth({audio:!0})];case 7:return i.sent(),[4,O.getMicrophones()];case 8:return[2,i.sent()];case 9:throw i.sent(),new A.default({message:w+"<getDeviceList>: "+L.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:y.default.ERROR_PERMISSION_DENIED});case 10:return[2]}}))}))},e.prototype.switchDevice=function(e){var t;return s(this,void 0,void 0,(function(){var n,i;return o(this,(function(r){return n=e.deviceType,i=e.deviceId,T.default.debug(w+".switchDevice -params: deviceType:"+n+",deviceID:"+i),[2,null===(t=this._trtcClient)||void 0===t?void 0:t.switchDevice(n,i)]}))}))},e.prototype.setSelfInfo=function(e){return s(this,void 0,void 0,(function(){var t,n,i;return o(this,(function(r){return t=e.nickName,n=e.avatar,i={nick:t,avatar:n},!t&&delete i.nick,!n&&delete i.avatar,T.default.log(w+".setSelfInfo -params: nickName:"+i.nick+",avatar:"+i.avatar),[2,this.tim.updateMyProfile(i)]}))}))},e.prototype.generateCallEndData=function(e){var t=e||{},n=t.roomId,i=t.callMediaType,r=t.callRole,a=t.totalTime,s=t.userId;return n=n||this.getRoomID(),i=i||this.getCallType(),r||(r=this.isInviter()?m.CALL_ROLE.INVITER:m.CALL_ROLE.INVITEE),{roomID:n,callMediaType:i,callRole:r,totalTime:a=c.isUndefined(a)?Math.round((Date.now()-this.getConnectStartTime())/1e3):a,userID:s=s||this.getUserID()}},e.prototype.generateEventData=function(){return{callID:this.getInviterInviteIdList()[0],roomID:this._roomID,callRole:this._isInviter?D.NAME.INVITER:D.NAME.INVITEE,callMediaType:this._callType}},e.prototype.enableAIVoice=function(e){var t;return s(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return this._trtcClient?[4,null===(t=this._trtcClient)||void 0===t?void 0:t.enableAIVoice(e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},e.prototype._resetTUICallEngine=function(){var e;return s(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return T.default.debug(w+"._resetTUICallEngine"),this._roomID=0,this._isInviter=!1,this._isGroupCall=!1,this.setSwitchCallModeStatus(!0),this._groupID="",this._callStatus=m.CALL_STATUS.IDLE,this._inviteeList=[],this._unHandledInviteeList=[],this._handledInviteeList=[],this._inviterInviteID={},this._audioVideoSwitchIdList=[],this._acceptedUserObject={},this._connectStartTime=0,this._switchCallModeStatus=!0,this._callRecordReport.stopHeartbeat(),this._initialCallId="",this._localViewId="",[4,null===(e=this._trtcClient)||void 0===e?void 0:e.reset()];case 1:return n.sent(),this._tsignalingClient.setInviteData(null),this._tsignalingClient.resetJoined(),(t=document.getElementById("_trtc_calling_layer"))&&(t.innerHTML=""),[2]}}))}))},e.prototype.getCallStatus=function(){return this._callStatus},e.prototype.changeCallStatus=function(e){this._callStatus!==e&&(T.default.debug(w+".changeCallStatus from "+this._callStatus+" to "+e),this._setInterfaceUpLoad(I.default.CHANGE_CALL_STATUS).setText("changeCallStatus from "+this._callStatus+" to "+e).setEnd(),this._callStatus=e)},e.prototype._callRecordUpload=function(e){var t=i(i({},e),{callRole:this.isInviter()?D.NAME.INVITER:D.NAME.INVITEE,userID:this.getUserID(),roomID:this.getRoomID(),inviteID:this.getInitialCallId()});this._callRecordReport.eventUpload(t)},e.prototype.extractCallingInfoFromMessage=function(e){if(!e)return"";if("TIMCustomElem"!==e.type)return"";var t=JSON.parse(e.payload.data);if(T.default.debug(w+".extractCallingInfoFromMessage - signalingData:",e.payload.data),t.businessID!==m.BUSINESS_ID.SIGNAL)return"";switch(t.actionType){case m.ACTION_TYPE.INVITE:var n=JSON.parse(t.data);return n.call_end>0?"结束通话，通话时长："+c.formatDuration(n.call_end):0!==n.call_end&&n.room_id?"发起通话":"结束群聊";case m.ACTION_TYPE.CANCEL_INVITE:return"取消通话";case m.ACTION_TYPE.ACCEPT_INVITE:return"已接听";case m.ACTION_TYPE.REJECT_INVITE:return"拒绝通话";case m.ACTION_TYPE.INVITE_TIMEOUT:return"无应答";default:return""}},e.prototype.setInitialCallId=function(e){this._initialCallId=e},e.prototype.getInitialCallId=function(){return this._initialCallId},e.CALL_TYPE=m.CALL_TYPE,r([R.paramValidate(R.VALIDATE_PARAMS.login),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"init",null),r([R.paramValidate(R.VALIDATE_PARAMS.login),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"login",null),r([R.avoidRepeatedCall(),R.paramValidate(R.VALIDATE_PARAMS.call),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),R.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.BASE),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"call",null),r([R.avoidRepeatedCall(),R.paramValidate(R.VALIDATE_PARAMS.groupCall),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),R.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"groupCall",null),r([R.paramValidate(R.VALIDATE_PARAMS.joinInGroupCall),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.IDLE]}),R.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"joinInGroupCall",null),r([R.paramValidate(R.VALIDATE_PARAMS.inviteUser),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),R.businessValidate(m.CALL_EXPERMENTEL_API_TYPE.PRO),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"inviteUser",null),r([R.avoidRepeatedCall(),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"accept",null),r([R.avoidRepeatedCall(),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"reject",null),r([R.avoidRepeatedCall(),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"hangup",null),r([R.paramValidate(R.VALIDATE_PARAMS.startRemoteView),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"startRemoteView",null),r([R.paramValidate(R.VALIDATE_PARAMS.stopRemoteView),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"stopRemoteView",null),r([R.paramValidate(R.VALIDATE_PARAMS.startLocalView),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),R.apiCallQueue(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"startLocalView",null),r([R.paramValidate(R.VALIDATE_PARAMS.stopLocalView),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),R.apiCallQueue(),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"stopLocalView",null),r([R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"openCamera",null),r([R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"closeCamera",null),r([R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"openMicrophone",null),r([R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[]),a("design:returntype",Promise)],e.prototype,"closeMicrophone",null),r([R.paramValidate(R.VALIDATE_PARAMS.setVideoQuality),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"setVideoQuality",null),r([R.paramValidate(R.VALIDATE_PARAMS.setVideoRenderParams),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"setVideoRenderParams",null),r([R.paramValidate(R.VALIDATE_PARAMS.switchCallMediaType),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CONNECTED,m.CALL_STATUS.CALLING],scene:!0}),a("design:type",Function),a("design:paramtypes",[Number]),a("design:returntype",Promise)],e.prototype,"switchCallMediaType",null),r([R.paramValidate(R.VALIDATE_PARAMS.getDeviceList),R.statusValidate({init:!0}),a("design:type",Function),a("design:paramtypes",[String]),a("design:returntype",Promise)],e.prototype,"getDeviceList",null),r([R.paramValidate(R.VALIDATE_PARAMS.switchDevice),R.statusValidate({init:!0,callStatus:[m.CALL_STATUS.CALLING,m.CALL_STATUS.CONNECTED]}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"switchDevice",null),r([R.paramValidate(R.VALIDATE_PARAMS.setSelfInfo),R.statusValidate({init:!0}),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",Promise)],e.prototype,"setSelfInfo",null),r([R.statusValidate({init:!0}),a("design:type",Function),a("design:paramtypes",[Boolean]),a("design:returntype",Promise)],e.prototype,"enableAIVoice",null),r([R.paramValidate(R.VALIDATE_PARAMS.createInstance),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],e,"createInstance",null),e}();t.default=M},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));const i=Function.prototype.apply,r=new WeakMap;function a(e){return r.has(e)||r.set(e,{}),r.get(e)}class s{constructor(e=null,t=console){const n=a(this);return n._events=new Set,n._callbacks={},n._console=t,n._maxListeners=null===e?null:parseInt(e,10),this}_addCallback(e,t,n,i){return this._getCallbacks(e).push({callback:t,context:n,weight:i}),this._getCallbacks(e).sort((e,t)=>e.weight>t.weight),this}_getCallbacks(e){return a(this)._callbacks[e]}_getCallbackIndex(e,t){return this._has(e)?this._getCallbacks(e).findIndex(e=>e.callback===t):null}_achieveMaxListener(e){return null!==a(this)._maxListeners&&a(this)._maxListeners<=this.listenersNumber(e)}_callbackIsExists(e,t,n){const i=this._getCallbackIndex(e,t),r=-1!==i?this._getCallbacks(e)[i]:void 0;return-1!==i&&r&&r.context===n}_has(e){return a(this)._events.has(e)}on(e,t,n=null,i=1){const r=a(this);if("function"!=typeof t)throw new TypeError(t+" is not a function");return this._has(e)?(this._achieveMaxListener(e)&&r._console.warn(`Max listeners (${r._maxListeners}) for event "${e}" is reached!`),this._callbackIsExists(...arguments)&&r._console.warn(`Event "${e}" already has the callback ${t}.`)):(r._events.add(e),r._callbacks[e]=[]),this._addCallback(...arguments),this}once(e,t,n=null,r=1){const a=(...r)=>(this.off(e,a),i.call(t,n,r));return this.on(e,a,n,r)}off(e,t=null){const n=a(this);let i;return this._has(e)&&(null===t?(n._events.delete(e),n._callbacks[e]=null):(i=this._getCallbackIndex(e,t),-1!==i&&(n._callbacks[e].splice(i,1),this.off(...arguments)))),this}emit(e,...t){return this._has(e)&&this._getCallbacks(e).forEach(e=>i.call(e.callback,e.context,t)),this}clear(){const e=a(this);return e._events.clear(),e._callbacks={},this}listenersNumber(e){return this._has(e)?this._getCallbacks(e).length:null}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var o=n(17),l=n(2),u=n(36),c=n(5),d=n(1),h=n(10),p=n(11),_=n(13),f=n(9),E=n(4),I=n(6),g=n(5),v=n(56),C=n(26),T=n(0),m=n(0),A=n(7),y="TRTCClient",L=o,D=function(){function e(e){var t,n=this;this._sdkAppID=e.sdkAppID,this._userID=e.userID,this._userSig=e.userSig,this._tuiCallEngine=e.tuiCallEngine,this._videoAvailableMap=new Map,this._isJoined=!1,this._isPublished=!1,this._unPublishing=!1,this._localStream=null,this._remoteStreams=[],this._userIdDomMap=new Map,this._device={video:null,audio:null,microphoneList:[],cameraList:[]},this._prevDevices=[],this._assetsPath=e.assetsPath,this._eventStatController=new _.default,h.default.bindController(this._eventStatController),this._isAiNoiseSuppress=!0;var i=L.VERSION;d.compareVersion(i,"4.7.0")>=0?L.checkSystemRequirements().then((function(e){if(!e.result)throw n._tuiCallEngine._delegate.onError(E.default.NOT_SUPPORT,JSON.stringify(e)),new f.default({message:I.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:E.default.NOT_SUPPORT})})):L.checkSystemRequirements().then((function(e){if(!e)throw n._tuiCallEngine._delegate.onError(E.default.NOT_SUPPORT,e),new f.default({message:I.ERROR_MESSAGE.NOT_SUPPORT+" "+JSON.stringify(e),code:E.default.NOT_SUPPORT})})),this._frameWorkType=32,d.compareVersion(i,"4.15.1")>=0?(this._frameWorkType=30,this._component=14,((null===(t=null===window||void 0===window?void 0:window.localStorage)||void 0===t?void 0:t.getItem("_isTIMCallKit"))||(null===window||void 0===window?void 0:window._isTIMCallKit))&&(this._component=15)):this._component=3,this.init()}return e.prototype.init=function(){this._client=L.createClient({mode:m.NAME.RTC,sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig,frameWorkType:this._frameWorkType,component:this._component}),this.addTRTCEvents()},e.prototype.getClient=function(){return this._client},e.prototype.getRemoteStreams=function(){return this._remoteStreams},e.prototype.getLocalStream=function(){return this._localStream},e.prototype.getMicrophoneList=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,L.getMicrophones()];case 1:return e=t.sent(),this._device.microphoneList=e,[2]}}))}))},e.prototype.getCamerasList=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:return[4,L.getCameras()];case 1:return e=t.sent(),this._device.cameraList=e,[2]}}))}))},e.prototype.getDevices=function(e){return r(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){switch(n.label){case 0:return[4,this.getMicrophoneList()];case 1:return n.sent(),0!==this._device.microphoneList.length?[3,3]:[4,this._tuiCallEngine._resetTUICallEngine()];case 2:return n.sent(),this._tuiCallEngine._delegate.onError(E.default.NOT_MICROPHONE_LIST,I.ERROR_MESSAGE.NOT_MICROPHONE_LIST),[2];case 3:return this._device.audio=JSON.parse(JSON.stringify(this._device.microphoneList[0])),e===c.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video?[4,this.getCamerasList()]:[3,5];case 4:n.sent(),this._device.video=JSON.parse(JSON.stringify(this._device.cameraList[0])),n.label=5;case 5:return this._prevDevices.length>0||(this._prevDevices=s(this._device.microphoneList,this._device.cameraList),navigator.mediaDevices.addEventListener("devicechange",(function(){return r(t,void 0,void 0,(function(){var e,t,n,i,r,o=this;return a(this,(function(a){switch(a.label){case 0:return[4,L.getMicrophones()];case 1:return e=a.sent(),[4,L.getCameras()];case 2:return t=a.sent(),n=s(e,t),this.setDevcies(n),i=n.filter((function(e){return o._prevDevices.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),r=this._prevDevices.filter((function(e){return n.findIndex((function(t){var n=t.deviceId;return e.deviceId===n}))<0})),i.length>0&&this.handleDevices(i),r.length>0&&this.handleDevicesRemoved(r),this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),this._prevDevices=n,[2]}}))}))}))),[2]}}))}))},e.prototype.setDevcies=function(e){this._device.microphoneList=e.filter((function(e){return e.kind===m.NAME.AUDIO_INPUT}))||[],this._device.cameraList=e.filter((function(e){return e.kind===m.NAME.VIDEO_INPUT}))||[]},e.prototype.handleDevices=function(e,t){var n=this;e.forEach((function(e){e.kind===m.NAME.AUDIO_INPUT?n.switchDevice(c.DEVICE_TYPE.AUDIO,e.deviceId):e.kind===m.NAME.VIDEO_INPUT&&t&&n.switchDevice(c.DEVICE_TYPE.VIDEO,e.deviceId)}))},e.prototype.handleDevicesRemoved=function(e){var t=this;e.forEach((function(e){e.kind===m.NAME.AUDIO_INPUT?t.isCurrentMicrophoneRemoved(e.deviceId)&&t.handleDevices(t._prevDevices):e.kind===m.NAME.VIDEO_INPUT&&t.isCurrentCameraRemoved(e.deviceId)&&t.handleDevices(t._prevDevices,!0)}))},e.prototype.isCurrentMicrophoneRemoved=function(e){var t=this._localStream.getAudioTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.isCurrentCameraRemoved=function(e){var t=this._localStream.getVideoTrack();return!(!t||t.getSettings().deviceId!==e)},e.prototype.switchDevice=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return l.default.log(y+".switchDevice - params: deviceType:"+e+",deviceID:"+t),this._localStream?[4,this._localStream.switchDevice(e,t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return n={deviceType:e,deviceId:t},this._device[e]=n,this._tuiCallEngine._delegate.onDeviceUpdated(this._device.microphoneList,this._device.cameraList,this._device.audio,this._device.video),[2]}}))}))},e.prototype.join=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,s;return a(this,(function(a){switch(a.label){case 0:return(t=this.getCallType())!==c.CALL_TYPE.VIDEO_CALL||this._tuiCallEngine.getDevicePermission().video?[3,2]:[4,this.getMediaDevicesAuth({video:!0})];case 1:a.sent(),a.label=2;case 2:return[4,this.getDevices(t)];case 3:if(a.sent(),this._isJoined)return l.default.warn(y+".join - duplicate RtcClient.join() observed"),[2];a.label=4;case 4:return a.trys.push([4,6,,7]),[4,this._client.join({roomId:e})];case 5:return a.sent(),this._isJoined=!0,this._tuiCallEngine.isInviter()||(n=this._tuiCallEngine.generateEventData(),this._tuiCallEngine._delegate.onCallBegin(n)),l.default.log(y+".join - join room success, callType:"+t),[3,7];case 6:throw i=a.sent(),l.default.error(y+".join - join room failed! "+i),new Error(y+".join - join room failed! "+i);case 7:if(this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.IDLE)return l.default.warn(y+".join - early hangup"),[2,this._tuiCallEngine.hangup()];r={audio:!0,video:!1,userId:this._userID},t===c.CALL_TYPE.VIDEO_CALL&&this._tuiCallEngine.getDevicePermission().video&&(r.video=!0),a.label=8;case 8:return a.trys.push([8,15,,16]),this._localStream=L.createStream(r),[4,this._setVideoProfile(this._localStream)];case 9:return a.sent(),[4,this._localStream.initialize()];case 10:return a.sent(),this._tuiCallEngine.tim?[4,this._addAiNoiseReduce(this._tuiCallEngine.tim)]:[3,12];case 11:a.sent(),a.label=12;case 12:return l.default.log(y+".join - initialize local stream success"),this._tuiCallEngine.isInviter()?[3,14]:[4,this.publish()];case 13:a.sent(),a.label=14;case 14:return this._joinedTimestamp=new Date,[2,{audio:r.audio,video:r.video,userId:r.userId}];case 15:throw s=a.sent(),l.default.error(y+".join - failed to initialize local stream - "+s),new f.default({message:y+"<join>: "+I.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:E.default.ERROR_PERMISSION_DENIED});case 16:return[2]}}))}))},e.prototype._addAiNoiseReduce=function(e){return r(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,6,,7]),[4,C.validateBusiness(e,g.CALL_EXPERMENTEL_API_TYPE.PRO)];case 1:return t=r.sent(),l.default.info(y+"._addAiNoiseReduce - aiNoiseReduceSupport."+t),t&&v?(this._assetsPath||l.default.warn(y+"._addAiNoiseReduce - please pass validate assetsPath"),this._aiNoiseSuppression=new v({assetsPath:this._assetsPath||T.AI_NOISE_REDUCE_ASSETS_PATH}),n=this,[4,this._aiNoiseSuppression.createProcessor({sdkAppId:this._sdkAppID,userId:this._userID,userSig:this._userSig})]):[3,5];case 2:return n._aiNoiseSuppressionProcessor=r.sent(),[4,this._aiNoiseSuppressionProcessor.process(this._localStream)];case 3:return r.sent(),[4,this.enableAIVoice(this._isAiNoiseSuppress)];case 4:r.sent(),r.label=5;case 5:return[3,7];case 6:return i=r.sent(),l.default.warn(y+"._addAiNoiseReduce - error."+i),[3,7];case 7:return[2]}}))}))},e.prototype.playLocalVideo=function(e){var t;return r(this,void 0,void 0,(function(){var n,i,r,s,o,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),l.default.debug(y+".playLocalVideo - params:",e),n=e.videoViewDomID,i=e.userID,e.options&&this._tuiCallEngine.setLocalPlayOptions(e.options),r=this._tuiCallEngine.getLocalPlayOptions(),s=n,typeof n===m.NAME.STRING&&(s=document.getElementById(n)),this._userIdDomMap.set(i,s),!this._localStream||this._localStream.hasVideo()?[3,2]:(o=this._localStream.getVideoTrack(),[4,this.addTrack(o)]);case 1:a.sent(),a.label=2;case 2:return s?[4,null===(t=null==this?void 0:this._localStream)||void 0===t?void 0:t.play(s,r)]:[3,4];case 3:a.sent(),a.label=4;case 4:return[3,6];case 5:throw u=a.sent(),l.default.error(y+".playLocalVideo - failed, error:"+u),new Error(y+".playLocalVideo - failed, error:"+u);case 6:return[2]}}))}))},e.prototype.stopLocalVideo=function(){return r(this,void 0,void 0,(function(){var e,t;return a(this,(function(n){switch(n.label){case 0:return n.trys.push([0,6,,7]),this._localStream?this._localStream.hasAudio()?(e=this._localStream.getVideoTrack())?[4,this._localStream.removeTrack(e)]:[3,2]:[3,3]:[3,5];case 1:n.sent(),e.stop(),n.label=2;case 2:return[3,5];case 3:return[4,this.unpublish()];case 4:n.sent(),this._localStream.stop(),this._localStream.close(),this._localStream=null,this._userIdDomMap.delete(this._tuiCallEngine.getUserID()),n.label=5;case 5:return[3,7];case 6:throw t=n.sent(),l.default.error(y+".stopLocalVideo - failed to play local video "+t),new Error(y+".stopLocalVideo - failed to play local video "+t);case 7:return[2]}}))}))},e.prototype.playRemoteVideo=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,s,o;return a(this,(function(a){switch(a.label){case 0:l.default.debug(y+".playRemoteVideo - params:",e),t=e.videoViewDomID,n=e.userID,e.options&&this._tuiCallEngine.setRemotePlayOptions(e.options),i=this._tuiCallEngine.getRemotePlayOptions(),r=t,typeof t===m.NAME.STRING&&(r=document.getElementById(t)),this._userIdDomMap.set(n,r),a.label=1;case 1:if(a.trys.push([1,6,,7]),!(s=this._remoteStreams.find((function(e){return e.getUserId()===n}))))throw new Error("currentRemoteUserStream is empty");if(!r)throw new Error("domID is empty");return document.getElementById("_trtc_calling_audio_call-"+n)?[4,s.stop()]:[3,3];case 2:a.sent(),document.getElementById("_trtc_calling_audio_call-"+n).remove(),a.label=3;case 3:return[4,null==s?void 0:s.play(r,i)];case 4:return a.sent(),[4,null==s?void 0:s.unmuteVideo()];case 5:return a.sent(),[3,7];case 6:throw o=a.sent(),l.default.error(y+".playRemoteVideo - failed to play remote video reason: "+o),new Error(y+".playRemoteVideo - failed to play remote video reason: "+o);case 7:return[2]}}))}))},e.prototype.stopRemoteVideo=function(e){return r(this,void 0,void 0,(function(){var t,n,i;return a(this,(function(r){switch(r.label){case 0:l.default.debug(y+".stopRemoteVideo - params:",e),t=e.userID,r.label=1;case 1:return r.trys.push([1,4,,5]),(n=this._remoteStreams.find((function(e){return e.getUserId()===t})))&&n.hasVideo()?[4,n.muteVideo()]:[3,3];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:throw i=r.sent(),l.default.error(y+".stopRemoteVideo - failed to stop remote video "+i),new Error(y+".stopRemoteVideo - failed to stop remote video "+i);case 5:return[2]}}))}))},e.prototype.getCallType=function(){return this._tuiCallEngine.getCallType()},e.prototype.leave=function(){var e,t;return r(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return l.default.log(y+"-leave._isJoined:"+this._isJoined),this._isJoined?[4,this.unpublish()]:(l.default.warn(y+".leave - please join() firstly"),[2]);case 1:return i.sent(),this._tuiCallEngine.getCallDataReport().setExitRoomTime((new Date).getTime()),[4,this._client.leave()];case 2:return i.sent(),this._isJoined=!1,this._isPublished=!1,null===(e=null==this?void 0:this._localStream)||void 0===e||e.close(),this._localStream=null,this._remoteStreams=[],this._userIdDomMap.clear(),this._videoAvailableMap.clear(),this._leaveTimestamp=new Date,this._client.enableAudioVolumeEvaluation(-1),null===(t=null==this?void 0:this._aiNoiseSuppressionProcessor)||void 0===t||t.destroy(),this._aiNoiseSuppressionProcessor=null,this._isAiNoiseSuppress=!0,n=Math.floor((this._leaveTimestamp-this._joinedTimestamp)/1e3),new h.default(p.default.TALK_TIME).setTalkTime(n).setText("talkTime record").setEnd(),[2]}}))}))},e.prototype.publish=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){switch(t.label){case 0:if(!this._isJoined)return l.default.warn(y+".publish - please join() firstly"),[2];if(this._isPublished)return l.default.warn(y+".publish - duplicate RtcClient.publish() observed"),[2];if(this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.IDLE)return l.default.warn(y+".join - early hangup"),this._tuiCallEngine.hangup(),[2];if(!this._localStream)return[2];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._client.publish(this._localStream)];case 2:return t.sent(),this._isPublished=!0,l.default.log(y+".publish success"),[3,4];case 3:return e=t.sent(),l.default.error(y+".publish - failed to publish local stream "+e),this._isPublished=!1,[3,4];case 4:return[2]}}))}))},e.prototype.unpublish=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._isPublished?this._localStream?this._unPublishing?(l.default.log(y+".unpublish - _unPublishing"),[2]):(this._unPublishing=!0,[4,this._client.unpublish(this._localStream)]):(l.default.warn(y+".unpublish - RtcClient._localStream is null"),[2]):(l.default.warn(y+".unpublish - RtcClient.unpublish() called but not published yet"),[2]);case 1:return e.sent(),l.default.log(y+".unpublish - complete"),this._unPublishing=!1,this._isPublished=!1,[2]}}))}))},e.prototype.playAudioStream=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return a(this,(function(a){return t=e.getUserId(),n="_trtc_calling_audio_call-"+t,(i=document.getElementById("_trtc_calling_layer"))||((i=document.createElement("div")).setAttribute("id","_trtc_calling_layer"),i.style.display="none",document.body.appendChild(i)),(r=document.createElement("div")).setAttribute("id",n),i.appendChild(r),e&&(e.play(n),e.on("error",(function(t){if(16451===t.getCode()){var n=document.createElement("button");n.onclick=function(){l.default.log(y+".remoteStream - resume"),e.resume()},n.style.display="none",document.body.appendChild(n);var i=setTimeout((function(){n.click(),clearTimeout(i),document.body.removeChild(n)}),0)}}))),[2]}))}))},e.prototype.delegateVideoAvailableState=function(e,t){e&&this._videoAvailableMap.get(e)!==t&&(this._videoAvailableMap.set(e,t),this._tuiCallEngine._delegate.onUserVideoAvailable({userID:e,isVideoAvailable:t}))},e.prototype.querySubscribeSuccess=function(e){return void 0!==this._videoAvailableMap.get(e)},e.prototype.addTRTCEvents=function(){var e=this;this._client.on("error",(function(t){l.default.error(y+".handleEvents - client on error "+t);var n=t.getCode(),i=JSON.stringify({name:m.NAME.TRTC,error:t});e._tuiCallEngine._delegate.onError(n,i)})),this._client.on("client-banned",(function(t){return r(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return l.default.error(y+".handleEvents - client has been banned for "+t),this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.CONNECTED&&(e=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(e)),this._tuiCallEngine.getCallStatus()!==c.CALL_STATUS.CALLING?[3,2]:(n=i(i({},this._tuiCallEngine.generateEventData()),{reason:m.NAME.BANNED}),this._tuiCallEngine._delegate.onCallingCancel(i({userID:this._tuiCallEngine.getUserID()},n)),[4,this._tuiCallEngine._cancel()]);case 1:r.sent(),r.label=2;case 2:return[4,this._tuiCallEngine._resetTUICallEngine()];case 3:return r.sent(),[2]}}))}))})),this._client.on("peer-join",(function(t){return r(e,void 0,void 0,(function(){var e,n,i,r;return a(this,(function(a){switch(a.label){case 0:return e=t.userId,this._isPublished||!this._tuiCallEngine.isInviter()?[3,2]:[4,this.publish()];case 1:a.sent(),a.label=2;case 2:return l.default.log(y+".handleEvents - peer-join "+e),this._tuiCallEngine.getConnectStartTime()||(this._tuiCallEngine.setConnectStartTime(Date.now()),this._client.enableAudioVolumeEvaluation(1e3)),this._tuiCallEngine._delegate.onUserEnter(e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.addHandledInviteeList([e]),this._tuiCallEngine.deleteUnHandledInviteeList([e]),this._tuiCallEngine.addAcceptedUserList(null,[e]),this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.CALLING&&this._tuiCallEngine.isInviter()&&(i=this._tuiCallEngine.generateEventData(),this._tuiCallEngine._delegate.onCallBegin(i)),this._tuiCallEngine.changeCallStatus(c.CALL_STATUS.CONNECTED),n&&(r=this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(r)),[2]}}))}))})),this._client.on("peer-leave",(function(t){return r(e,void 0,void 0,(function(){var e,n,i,r,s,o,u,d;return a(this,(function(a){switch(a.label){case 0:return this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.IDLE?[2]:(e=t.userId,l.default.log(y+".handleEvents - peer-leave:"+e),n=this._tuiCallEngine.isGroupCall(),this._tuiCallEngine.deleteHandledInviteeList([e]),this._videoAvailableMap.delete(e),this._tuiCallEngine._delegate.onUserLeave(e),n?(i=this._tuiCallEngine.getHandledInviteeList(),r=this._tuiCallEngine.getUnHandledInviteeList(),0!==i.length&&this._tuiCallEngine._delegate.onGroupCallInviteeListUpdate(i),s=this._tuiCallEngine.getUserID(),1!==i.length||i[0]!==s||0!==r.length?[3,2]:(o=this._tuiCallEngine.generateCallEndData(),this._tuiCallEngine._delegate.onCallEnd(o),[4,this._tuiCallEngine._resetTUICallEngine()])):[3,3]);case 1:a.sent(),a.label=2;case 2:return[3,6];case 3:return u=this._tuiCallEngine.getHandledInviteeList(),d={callType:this._tuiCallEngine.getCallType(),userIDList:[e],callEnd:Math.round((Date.now()-this._tuiCallEngine.getConnectStartTime())/1e3)},1!==u.length?[3,6]:[4,this._tuiCallEngine._tsignalingClient.hangup(d)];case 4:return a.sent(),[4,this._tuiCallEngine._resetTUICallEngine()];case 5:a.sent(),a.label=6;case 6:return[2]}}))}))})),this._client.on("stream-added",(function(t){return r(e,void 0,void 0,(function(){var e,n,i,r,s,o;return a(this,(function(a){switch(a.label){case 0:e=t.stream,n=e.getId(),i=e.getUserId(),l.default.log(y+".handleEvents - remote stream added, userID:"+i+" streamID:"+n+" type:"+e.getType()),a.label=1;case 1:return a.trys.push([1,3,,5]),[4,this._client.subscribe(e)];case 2:return a.sent(),[3,5];case 3:return r=a.sent(),s=r.getCode(),o=JSON.stringify({name:"TRTC",error:r}),[4,this._tuiCallEngine._resetTUICallEngine()];case 4:return a.sent(),this._tuiCallEngine._delegate.onError(s,o),[3,5];case 5:return[2]}}))}))})),this._client.on("stream-subscribed",(function(t){return r(e,void 0,void 0,(function(){var e,n;return a(this,(function(i){return e=t.stream,n=e.getUserId(),l.default.log(y+".handleEvents - stream subscribed, _remoteStreams:"+this._remoteStreams+", userID:"+n+", video: "+e.hasVideo()),this._remoteStreams.push(e),this._tuiCallEngine.getCallType()===c.CALL_TYPE.VIDEO_CALL&&this.delegateVideoAvailableState(n,e.hasVideo()),(this.getCallType()===c.CALL_TYPE.AUDIO_CALL||this._tuiCallEngine.getCallType()===c.CALL_TYPE.VIDEO_CALL&&!e.hasVideo())&&this.playAudioStream(e),[2]}))}))})),this._client.on("stream-removed",(function(t){var n=t.stream,i=n.getId(),r=n.getUserId(),a="_trtc_calling_audio_call-"+r;if(l.default.log(y+".handleEvents - remote stream-removed, streamID:"+i+" type:"+n.getType()),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:r,isAudioAvailable:!1}),e._tuiCallEngine._delegate.onUserVideoAvailable({userID:r,isVideoAvailable:!1}),n.stop(),n.close(),e._remoteStreams=e._remoteStreams.filter((function(e){return e.getId()!==i})),e.getCallType()===c.CALL_TYPE.AUDIO_CALL){var s=document.getElementById("_trtc_calling_layer"),o=document.getElementById(a);s&&o&&s.removeChild(o)}e._videoAvailableMap.delete(r)})),this._client.on("stream-updated",(function(t){var n=t.stream,i=n.getUserId(),r=n.getType(),a=n.hasAudio(),s=n.hasVideo();l.default.log(y+".handleEvents - stream-updated, type:"+r+" hasAudio:"+a+" hasVideo:"+s),e.querySubscribeSuccess(i)&&e.delegateVideoAvailableState(i,!!s)})),this._client.on("mute-audio",(function(t){l.default.debug(y+".handleEvents - "+t.userId+" mute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!1})})),this._client.on("unmute-audio",(function(t){l.default.debug(y+".handleEvents - "+t.userId+" unmute audio"),e._tuiCallEngine._delegate.onUserAudioAvailable({userID:t.userId,isAudioAvailable:!0})})),this._client.on("mute-video",(function(t){l.default.debug(y+".handleEvents - "+t.userId+" mute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!1)})),this._client.on("unmute-video",(function(t){l.default.debug(y+".handleEvents - "+t.userId+" unmute video"),e.querySubscribeSuccess(t.userId)&&e.delegateVideoAvailableState(t.userId,!0)})),this._client.on("audio-volume",(function(t){l.default.debug(y+".handleEvents - "+t+" audio volume"),e._tuiCallEngine._delegate.onUserVoiceVolume(t.result)})),this._client.on("connection-state-changed",(function(e){l.default.log(y+".handleEvents - RtcClient state changed from "+e.prevState+" to "+e.state)}))},e.prototype.removeTRTCEvents=function(){this._client.off("*")},e.prototype.muteLocalAudio=function(){var e;null===(e=this._localStream)||void 0===e||e.muteAudio()},e.prototype.unMuteLocalAudio=function(){var e;null===(e=this._localStream)||void 0===e||e.unmuteAudio()},e.prototype.switchCallMode=function(e){return r(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:switch(l.default.log(y+".switchCallMode - type",e),t=this._localStream.getVideoTrack(),e){case c.CALL_TYPE.VIDEO_CALL:return[3,1];case c.CALL_TYPE.AUDIO_CALL:return[3,2]}return[3,6];case 1:try{this.removeTrack(t),this._tuiCallEngine.setCallType(c.CALL_TYPE.AUDIO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(c.CALL_TYPE.VIDEO_CALL,c.CALL_TYPE.AUDIO_CALL)}catch(e){this._tuiCallEngine._delegate.onError(E.default.FAILURE_SWITCH_TO_AUDIO,I.ERROR_MESSAGE.FAILURE_SWITCH_TO_AUDIO)}return[3,6];case 2:return n.trys.push([2,4,,5]),[4,this.addTrack(t)];case 3:return n.sent(),this._tuiCallEngine.setCallType(c.CALL_TYPE.VIDEO_CALL),this._tuiCallEngine.setSwitchCallModeStatus(!0),this._tuiCallEngine._delegate.onCallTypeChanged(c.CALL_TYPE.AUDIO_CALL,c.CALL_TYPE.VIDEO_CALL),[3,5];case 4:return n.sent(),this._tuiCallEngine._delegate.onError(E.default.FAILURE_SWITCH_TO_VIDEO,I.ERROR_MESSAGE.FAILURE_SWITCH_TO_VIDEO),[3,5];case 5:return[3,6];case 6:return[2]}}))}))},e.prototype.removeTrack=function(e){return r(this,void 0,void 0,(function(){var t;return a(this,(function(n){switch(n.label){case 0:if(l.default.log(y+".removeTrack ",!!e),!e)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._localStream.removeTrack(e)];case 2:return n.sent(),e.stop(),[3,4];case 3:throw t=n.sent(),l.default.error(y+".removeTrack - failed to removeTrack local stream "+t),new Error(t);case 4:return[2]}}))}))},e.prototype.addTrack=function(e){var t,n;return r(this,void 0,void 0,(function(){var i,r,s,o,u;return a(this,(function(a){switch(a.label){case 0:return l.default.log(y+".addTrack ",!e),e?[3,7]:(i={userId:this._tuiCallEngine.getUserID(),audio:!1,video:!0},(r=null===(t=null==this?void 0:this._localStream)||void 0===t?void 0:t.getCameraId())&&(i.cameraId=r),s=L.createStream(i),[4,this._setVideoProfile(s)]);case 1:return a.sent(),[4,s.initialize()];case 2:a.sent(),o=s.getVideoTrack(),a.label=3;case 3:return a.trys.push([3,6,,7]),o?[4,null===(n=this._localStream)||void 0===n?void 0:n.addTrack(o)]:[3,5];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:throw u=a.sent(),l.default.error(y+".addTrack - failed to addTrack local stream "+u),new Error(u);case 7:return[2]}}))}))},e.prototype.reset=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this._isJoined?[4,this.leave()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e.prototype.getMediaDevicesAuth=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return a(this,(function(a){switch(a.label){case 0:if(!u.checkProtocols())throw new f.default({message:""+I.ERROR_MESSAGE.ERROR_HTTP,code:E.default.ERROR_HTTP});if(t=this._tuiCallEngine.getDevicePermission(),!e.audio)return[3,4];if(A.IS_IOS&&t.audio)return[2,t];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:!1})];case 2:return i=a.sent(),this.releaseStream(i),this._tuiCallEngine.setDevicePermission(c.DEVICE_TYPE.AUDIO,!0),[3,4];case 3:throw n=a.sent(),this._tuiCallEngine.setDevicePermission(c.DEVICE_TYPE.AUDIO,!1),new Error(n);case 4:if(!e.video)return[3,8];if(A.IS_IOS&&t.video)return[2,t];a.label=5;case 5:return a.trys.push([5,7,,8]),[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 6:return i=a.sent(),this.releaseStream(i),this._tuiCallEngine.setDevicePermission(c.DEVICE_TYPE.VIDEO,!0),[3,8];case 7:if(r=a.sent(),this._tuiCallEngine.setDevicePermission(c.DEVICE_TYPE.VIDEO,!1),l.default.error(y+".getMediaDevicesAuth - failed to get user video steam - "+r),e.isThrowVideoError)throw new Error(r);return[3,8];case 8:return[2,this._tuiCallEngine.getDevicePermission()]}}))}))},e.prototype.enableAIVoice=function(e){return r(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._isAiNoiseSuppress=e,this._aiNoiseSuppressionProcessor?(l.default.info(y+".enableAIVoice "+e),e?[4,this._aiNoiseSuppressionProcessor.enable()]:[3,2]):[2];case 1:return t.sent(),[3,4];case 2:return[4,this._aiNoiseSuppressionProcessor.disable()];case 3:t.sent(),t.label=4;case 4:return[2]}}))}))},e.prototype.releaseStream=function(e){for(var t=e.getTracks(),n=0;n<t.length;n++)t[n].stop()},e.prototype._setVideoProfile=function(e,t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,7]),e?(t=t||this._tuiCallEngine.getVideoQuality(),e?[4,e.setVideoProfile(t)]:[3,2]):(l.default.warn(y+"._setVideoProfile - stream is empty"),[2]);case 1:i.sent(),i.label=2;case 2:return[3,7];case 3:return"OverconstrainedError"!==i.sent().name?[3,5]:(console.error("当前摄像头不支持该 profile"),[4,(n=L.createStream({video:!0,audio:!1})).initialize()]);case 4:return i.sent(),this._localStream.replaceTrack(n.getVideoTrack()),[3,6];case 5:console.error("当前浏览器不支持动态调用该接口"),i.label=6;case 6:return[3,7];case 7:return[2]}}))}))},e.prototype._setVideoRenderParams=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,s,o,u,c,h,p,_,f,E,I,g;return a(this,(function(v){switch(v.label){case 0:return v.trys.push([0,11,,12]),n=(t=e||{}).userID,i=t.objectFit,r=void 0===i?"":i,n&&!this._userIdDomMap.has(n)?(l.default.warn(y+"._setVideoRenderParams - failed the userID: "+n+" does not have a play node"),[2]):(s={},r!==m.NAME.CONTAIN&&r!==m.NAME.COVER&&r!==m.NAME.FILL||(s.objectFit=e.objectFit),d.isBoolean(e.muted)&&(s.muted=e.muted),d.isBoolean(e.mirror)&&(s.mirror=e.mirror),o=this._tuiCallEngine.getUserID(),n!==o&&n?[3,3]:(this._tuiCallEngine.setLocalPlayOptions(s),u=this._tuiCallEngine.getLocalPlayOptions(),E=this._userIdDomMap.get(o),this._localStream?[4,this._localStream.play(E,u)]:[3,2]));case 1:v.sent(),v.label=2;case 2:v.label=3;case 3:if(n)return[3,7];this._tuiCallEngine.setRemotePlayOptions(s),f=this._tuiCallEngine.getRemotePlayOptions(),c=(c=Array.from(this._userIdDomMap,(function(e){return e[0]}))).filter((function(e){return e!==o})),h=function(e){var t,n;return a(this,(function(i){switch(i.label){case 0:return t=p._userIdDomMap.get(c[e]),n=p._remoteStreams.find((function(t){return t.getUserId()===c[e]})),n?[4,n.play(t,f)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))},p=this,_=0,v.label=4;case 4:return _<c.length?[5,h(_)]:[3,7];case 5:v.sent(),v.label=6;case 6:return _++,[3,4];case 7:return n&&n!==o?(this._tuiCallEngine.setRemotePlayOptions(s),f=this._tuiCallEngine.getRemotePlayOptions(),E=this._userIdDomMap.get(n),I=this._remoteStreams.find((function(e){return e.getUserId()===n})),I?[4,I.play(E,f)]:[3,9]):[3,10];case 8:v.sent(),v.label=9;case 9:v.label=10;case 10:return[3,12];case 11:return g=v.sent(),l.default.warn(y+"._setVideoRenderParams - failed call stream.play error: "+g),[3,12];case 12:return[2]}}))}))},e}();t.default=D},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.checkProtocols=void 0,t.checkProtocols=function(){if(!window)return!1;if(!window.location)return!1;var e=window.location,t=e.protocol,n=e.hostname;return"http:"!==t||"localhost"===n||"127.0.0.1"===n}},function(e,t,n){"use strict";var i=n(3),r=n(18),a=n(38),s=n(24);function o(e){var t=new a(e),n=r(a.prototype.request,t);return i.extend(n,a.prototype,t),i.extend(n,t),n}var l=o(n(15));l.Axios=a,l.create=function(e){return o(s(l.defaults,e))},l.Cancel=n(25),l.CancelToken=n(53),l.isCancel=n(23),l.all=function(e){return Promise.all(e)},l.spread=n(54),l.isAxiosError=n(55),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";var i=n(3),r=n(19),a=n(39),s=n(40),o=n(24),l=n(51),u=l.validators;function c(e){this.defaults=e,this.interceptors={request:new a,response:new a}}c.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=e.transitional;void 0!==t&&l.assertOptions(t,{silentJSONParsing:u.transitional(u.boolean,"1.0.0"),forcedJSONParsing:u.transitional(u.boolean,"1.0.0"),clarifyTimeoutError:u.transitional(u.boolean,"1.0.0")},!1);var n=[],i=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(i=i&&t.synchronous,n.unshift(t.fulfilled,t.rejected))}));var r,a=[];if(this.interceptors.response.forEach((function(e){a.push(e.fulfilled,e.rejected)})),!i){var c=[s,void 0];for(Array.prototype.unshift.apply(c,n),c=c.concat(a),r=Promise.resolve(e);c.length;)r=r.then(c.shift(),c.shift());return r}for(var d=e;n.length;){var h=n.shift(),p=n.shift();try{d=h(d)}catch(e){p(e);break}}try{r=s(d)}catch(e){return Promise.reject(e)}for(;a.length;)r=r.then(a.shift(),a.shift());return r},c.prototype.getUri=function(e){return e=o(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},i.forEach(["delete","get","head","options"],(function(e){c.prototype[e]=function(t,n){return this.request(o(n||{},{method:e,url:t,data:(n||{}).data}))}})),i.forEach(["post","put","patch"],(function(e){c.prototype[e]=function(t,n,i){return this.request(o(i||{},{method:e,url:t,data:n}))}})),e.exports=c},function(e,t,n){"use strict";var i=n(3);function r(){this.handlers=[]}r.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){i.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},function(e,t,n){"use strict";var i=n(3),r=n(41),a=n(23),s=n(15);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=i.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),i.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||s.adapter)(e).then((function(t){return o(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return a(t)||(o(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var i=n(3),r=n(15);e.exports=function(e,t,n){var a=this||r;return i.forEach(n,(function(n){e=n.call(a,e,t)})),e}},function(e,t){var n,i,r=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&p())}function p(){if(!c){var e=o(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function _(e,t){this.fun=e,this.array=t}function f(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new _(e,t)),1!==u.length||c||o(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=f,r.addListener=f,r.once=f,r.off=f,r.removeListener=f,r.removeAllListeners=f,r.emit=f,r.prependListener=f,r.prependOnceListener=f,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){i.forEach(e,(function(n,i){i!==t&&i.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[i])}))}},function(e,t,n){"use strict";var i=n(22);e.exports=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(i("Request failed with status code "+n.status,n.config,null,n.request,n)):e(n)}},function(e,t,n){"use strict";var i=n(3);e.exports=i.isStandardBrowserEnv()?{write:function(e,t,n,r,a,s){var o=[];o.push(e+"="+encodeURIComponent(t)),i.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),i.isString(r)&&o.push("path="+r),i.isString(a)&&o.push("domain="+a),!0===s&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var i=n(47),r=n(48);e.exports=function(e,t){return e&&!i(t)?r(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var i=n(3),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,a,s={};return e?(i.forEach(e.split("\n"),(function(e){if(a=e.indexOf(":"),t=i.trim(e.substr(0,a)).toLowerCase(),n=i.trim(e.substr(a+1)),t){if(s[t]&&r.indexOf(t)>=0)return;s[t]="set-cookie"===t?(s[t]?s[t]:[]).concat([n]):s[t]?s[t]+", "+n:n}})),s):s}},function(e,t,n){"use strict";var i=n(3);e.exports=i.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var i=e;return t&&(n.setAttribute("href",i),i=n.href),n.setAttribute("href",i),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=i.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var i=n(52),r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var a={},s=i.version.split(".");function o(e,t){for(var n=t?t.split("."):s,i=e.split("."),r=0;r<3;r++){if(n[r]>i[r])return!0;if(n[r]<i[r])return!1}return!1}r.transitional=function(e,t,n){var r=t&&o(t);function s(e,t){return"[Axios v"+i.version+"] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new Error(s(i," has been removed in "+t));return r&&!a[i]&&(a[i]=!0,console.warn(s(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}},e.exports={isOlderVersion:o,assertOptions:function(e,t,n){if("object"!=typeof e)throw new TypeError("options must be an object");for(var i=Object.keys(e),r=i.length;r-- >0;){var a=i[r],s=t[a];if(s){var o=e[a],l=void 0===o||s(o,a,e);if(!0!==l)throw new TypeError("option "+a+" must be "+l)}else if(!0!==n)throw Error("Unknown option "+a)}},validators:r}},function(e){e.exports=JSON.parse('{"name":"axios","version":"0.21.4","description":"Promise based HTTP client for the browser and node.js","main":"index.js","scripts":{"test":"grunt test","start":"node ./sandbox/server.js","build":"NODE_ENV=production grunt build","preversion":"npm test","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json","postversion":"git push && git push --tags","examples":"node ./examples/server.js","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","fix":"eslint --fix lib/**/*.js"},"repository":{"type":"git","url":"https://github.com/axios/axios.git"},"keywords":["xhr","http","ajax","promise","node"],"author":"Matt Zabriskie","license":"MIT","bugs":{"url":"https://github.com/axios/axios/issues"},"homepage":"https://axios-http.com","devDependencies":{"coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.3.0","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^23.0.0","grunt-karma":"^4.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^4.0.2","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^6.3.2","karma-chrome-launcher":"^3.1.0","karma-firefox-launcher":"^2.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^4.3.6","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^8.2.1","sinon":"^4.5.0","terser-webpack-plugin":"^4.2.3","typescript":"^4.0.5","url-search-params":"^0.10.0","webpack":"^4.44.2","webpack-dev-server":"^3.11.0"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"jsdelivr":"dist/axios.min.js","unpkg":"dist/axios.min.js","typings":"./index.d.ts","dependencies":{"follow-redirects":"^1.14.0"},"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}]}')},function(e,t,n){"use strict";var i=n(25);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new i(e),t(n.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,n){"use strict";e.exports=function(e){return"object"==typeof e&&!0===e.isAxiosError}},function(e,t){e.exports=n},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}},s=this&&this.__rest||function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),r=0;for(t=0;t<n;t++)for(var a=arguments[t],s=0,o=a.length;s<o;s++,r++)i[r]=a[s];return i};Object.defineProperty(t,"__esModule",{value:!0});var l=n(27),u=n(2),c=n(5),d="TSignalClient",h=n(0),p=n(1),_=function(){function e(e,t){this._tuiCallEngine=e,this._chat=t.tim,this._joined=!1,this._newInvitationData=null,this._resolveMap=new Map,this.addTSignalEvents()}return e.prototype.setTSignalingIsJoined=function(e){this._joined=e},e.prototype.getTSignalingIsJoined=function(){return this._joined},e.prototype.setLogLevel=function(e){this._chat.setLogLevel(e)},e.prototype.addTSignalEvents=function(){var e=l,t=e.EVENT,n=e.TSignaling;this._chat.on(t.SDK_READY,this.onSdkReady,this),this._chat.on(t.SDK_NOT_READY,this.onSdkNotReady,this),this._chat.on(t.KICKED_OUT,this.onKickedOut,this),this._chat.on(t.NET_STATE_CHANGE,this.onNetStateChange,this),this._chat.addSignalingListener(n.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),this._chat.addSignalingListener(n.INVITEE_ACCEPTED,this.onInviteeAccepted,this),this._chat.addSignalingListener(n.INVITEE_REJECTED,this.onInviteeRejected,this),this._chat.addSignalingListener(n.INVITATION_CANCELLED,this.onInvitationCancelled,this),this._chat.addSignalingListener(n.INVITATION_TIMEOUT,this.onInvitationTimeout,this)},e.prototype.removeTSignalEvents=function(){var e=l,t=e.EVENT,n=e.TSignaling;this._chat.off(t.SDK_READY,this.onSdkReady,this),this._chat.off(t.SDK_NOT_READY,this.onSdkNotReady,this),this._chat.off(t.KICKED_OUT,this.onKickedOut,this),this._chat.off(t.NET_STATE_CHANGE,this.onNetStateChange,this),this._chat.removeSignalingListener(n.NEW_INVITATION_RECEIVED,this.onNewInvitationReceived,this),this._chat.removeSignalingListener(n.INVITEE_ACCEPTED,this.onInviteeAccepted,this),this._chat.removeSignalingListener(n.INVITEE_REJECTED,this.onInviteeRejected,this),this._chat.removeSignalingListener(n.INVITATION_CANCELLED,this.onInvitationCancelled,this),this._chat.removeSignalingListener(n.INVITATION_TIMEOUT,this.onInvitationTimeout,this)},e.prototype.onSdkReady=function(e){this._tuiCallEngine._delegate.onSdkReady(e);var t=this._resolveMap.get("login");t&&(t.resolve(t.value),this._resolveMap.delete("login"))},e.prototype.onSdkNotReady=function(){u.default.warn("onSdkNotReady")},e.prototype.onNewInvitationReceived=function(e){var t,n,i;return r(this,void 0,void 0,(function(){var r,s,o,l,_,f,E,I,g,v,C;return a(this,(function(a){switch(a.label){case 0:return r=this._tuiCallEngine.getCallStatus(),u.default.log(d+".onNewInvitationReceived - params:",e,"currentCallStatus:"+r),s=e.data,o=s.inviter,l=s.inviteeList,_=s.data,f=s.inviteID,E=s.groupID,I=JSON.parse(_),p.isCallSignaling(null==I?void 0:I.businessID)?(I.room_id||(I.room_id=null===(t=null==I?void 0:I.data)||void 0===t?void 0:t.room_id),g=(null===(n=null==I?void 0:I.data)||void 0===n?void 0:n.initialCallId)||"",this._tuiCallEngine.getUserID()===o?[2]:(C={inviter:o,inviteeList:l,inviteID:f,isGroupCall:v=!!E,inviteData:I,groupID:E,initialCallId:g,currentCallStatus:r,inCallUserIDs:(null==I?void 0:I.inCallUserIDs)||[]},(null===(i=null==I?void 0:I.data)||void 0===i?void 0:i.cmd)!==c.CMD_TYPE.HANG_UP?[3,2]:(u.default.log(d+".hangup - params:",o,I,this._tuiCallEngine.getHandledInviteeList(),this._tuiCallEngine.getUnHandledInviteeList(),r,v),r===c.CALL_STATUS.IDLE?[2]:[4,this.handleHangupSignal(C)]))):[2];case 1:return a.sent(),[2];case 2:return!E&&this.judgeSwitchCallMode(I)?(r!==c.CALL_STATUS.IDLE&&this._tuiCallEngine.getRoomID()===I.room_id&&(this.handleSwitchCallMode(f,I),this._tuiCallEngine.addAudioVideoSwitchIdList(f)),[2]):r===c.CALL_STATUS.IDLE?[3,4]:[4,this.reject({inviteID:f,callType:I.call_type,isBusy:!0})];case 3:return a.sent(),this._tuiCallEngine.getCallRecordReport().eventUploadNotSave({inviteID:g||f,callRole:h.NAME.INVITEE,eventType:h.NAME.IGNORE_CALL,roomID:I.room_id,mediaType:I.call_type,callType:E?h.NAME.GROUP:h.NAME.SINGLE}),[2];case 4:return this.handleInvitedSignal(C),[2]}}))}))},e.prototype.handleHangupSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,l,u,d,p,_;return a(this,(function(a){switch(a.label){case 0:if(t=e.inviter,n=e.inviteData,r=e.currentCallStatus,s=e.inviteeList,o=this._tuiCallEngine.isGroupCall(),l=this._tuiCallEngine.isInviter(),r===c.CALL_STATUS.CALLING){if(d=this._tuiCallEngine.getHandledInviteeList(),-1!==(p=this._tuiCallEngine.getUnHandledInviteeList()).indexOf(t)&&this._tuiCallEngine.deleteUnHandledInviteeList([t]),-1===d.indexOf(t))return[2]}else if(this._tuiCallEngine.deleteHandledInviteeList([t]),-1===(d=this._tuiCallEngine.getHandledInviteeList()).indexOf(t)&&d.length>1)return[2];return u=this._tuiCallEngine.generateCallEndData({totalTime:n.call_end||0}),o?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return a.sent(),this._tuiCallEngine._delegate.onCallEnd(u),[3,10];case 2:return this._tuiCallEngine.deleteHandledInviteeList([t]),d=this._tuiCallEngine.getHandledInviteeList(),p=this._tuiCallEngine.getUnHandledInviteeList(),l?1!==d.length||0!==p.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:a.sent(),this._tuiCallEngine._delegate.onCallEnd(u),a.label=4;case 4:return[3,10];case 5:return r!==c.CALL_STATUS.CALLING?[3,8]:(-1!==s.indexOf(this._tuiCallEngine.getUserID())&&this._tuiCallEngine._delegate.onUserLeave(t),0!==d.length||1!==p.length?[3,7]:(_=this._tuiCallEngine.generateEventData(),[4,this._tuiCallEngine._resetTUICallEngine()]));case 6:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({userID:t},_),{reason:h.NAME.NORMAL})),a.label=7;case 7:return[3,10];case 8:return 1!==d.length||0!==p.length?[3,10]:[4,this._tuiCallEngine._resetTUICallEngine()];case 9:a.sent(),this._tuiCallEngine._delegate.onCallEnd(u),a.label=10;case 10:return[2]}}))}))},e.prototype.handleInvitedSignal=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,l,u,d,p,_,f,E,I,g,v;return a(this,(function(a){return t=e.inviter,n=e.inviteeList,r=e.isGroupCall,s=e.groupID,l=e.inviteID,u=e.inviteData,d=e.inCallUserIDs,p=void 0===d?[]:d,_=e.initialCallId,f=void 0===_?"":_,this._tuiCallEngine.changeCallStatus(c.CALL_STATUS.CALLING),this._tuiCallEngine.setInviterID(t),this._tuiCallEngine.setInviteeList(n),this._tuiCallEngine.setRoomID(u.room_id),this._tuiCallEngine.setCallType(u.call_type),this._tuiCallEngine.addUnHandledInviteeList(o(n,p)),this._tuiCallEngine.addHandledInviteeList([t]),this._tuiCallEngine.addAcceptedUserList(l,[t]),this._tuiCallEngine.setInitialCallId(f),r&&(this._tuiCallEngine.setIsGroupCall(r),this._tuiCallEngine.setGroupID(s)),this._tuiCallEngine.addInviterInviteId(l,o([t],n)),E=p.filter((function(e){return-1===n.indexOf(e)})),this._newInvitationData={sponsor:t,userIDList:o(n,E),isFromGroup:r,inviteID:l,groupID:s,inviteData:{version:u.version,callType:u.call_type,roomID:u.room_id},userData:u.extInfo,calleeIdList:n},I=this._tuiCallEngine.getCallDataReport().getCallData(),I=i(i({},I),{roomID:u.room_id,inviteID:l,callRole:c.CALL_ROLE.INVITEE,callType:u.call_type,inviteeList:n,callScene:s?h.NAME.GROUP_CALL:h.NAME.SINGLE_CALL}),g=this._tuiCallEngine.generateEventData()||{},this._tuiCallEngine.getCallDataReport().setCallData(I),v={eventType:h.NAME.RECEIVE_CALL,callType:s?h.NAME.GROUP:h.NAME.SINGLE,mediaType:u.call_type,callRole:h.NAME.INVITEE,userID:this._tuiCallEngine.getUserID(),roomID:u.room_id,inviteID:f||l},this._tuiCallEngine.getCallRecordReport().eventUpload(v),this._tuiCallEngine._delegate.onInvited(i(i({},g),this._newInvitationData)),[2]}))}))},e.prototype.getInviteData=function(){return this._newInvitationData},e.prototype.setInviteData=function(e){this._newInvitationData=e},e.prototype.handleSwitchCallMode=function(e,t){var n={inviteID:e,callType:t.call_type,switch_to_audio_call:null},i={cmd:c.CMD_TYPE.SWITCH_TO_VIDEO};t.call_type===c.CALL_TYPE.VIDEO_CALL?(n.switch_to_audio_call=c.CMD_TYPE.SWITCH_TO_AUDIO_CALL,i.cmd=c.CMD_TYPE.SWITCH_TO_AUDIO):delete n.switch_to_audio_call;var r=this._tuiCallEngine.getCallStatus();if(this.accept(n,i),r===c.CALL_STATUS.CALLING){var a=t.call_type===c.CALL_TYPE.VIDEO_CALL?c.CALL_TYPE.AUDIO_CALL:c.CALL_TYPE.VIDEO_CALL;this._tuiCallEngine._delegate.onCallTypeChanged(t.call_type,a),this._newInvitationData.inviteData.callType=a,this._tuiCallEngine.setSwitchCallModeStatus(!1)}else r===c.CALL_STATUS.CONNECTED&&(this._tuiCallEngine.setSwitchCallModeStatus(!1),this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()))},e.prototype.judgeSwitchCallMode=function(e){var t=e.switch_to_audio_call&&e.switch_to_audio_call===c.CMD_TYPE.SWITCH_TO_AUDIO_CALL||e.data&&e.data.cmd===c.CMD_TYPE.SWITCH_TO_AUDIO||e.data&&e.data.cmd===c.CMD_TYPE.SWITCH_TO_VIDEO;return u.default.log(d+".switchCallMode:",e,"isSwitchCallMode-"+t),t},e.prototype.onInviteeAccepted=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o;return a(this,(function(a){switch(a.label){case 0:return u.default.log(d+".onInviteeAccepted - params:",e),t=JSON.parse(e.data.data),p.isCallSignaling(null==t?void 0:t.businessID)?(n=e.data.invitee,r=e.data.inviteID,-1===this._tuiCallEngine.getTotalInviterInviteIdList().indexOf(r)?[2]:this._tuiCallEngine.isGroupCall()||!this.judgeSwitchCallMode(t)||this._tuiCallEngine.getSwitchCallModeStatus()?(s=this._tuiCallEngine.getCallStatus(),n!==this._tuiCallEngine.getUserID()||s!==c.CALL_STATUS.CALLING?[3,2]:(o=this._tuiCallEngine.generateEventData(),[4,this._tuiCallEngine._resetTUICallEngine()])):(this._tuiCallEngine._trtcClient.switchCallMode(this._tuiCallEngine.getCallType()),[2])):[2];case 1:return a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i({userID:n},o)),[2];case 2:return s===c.CALL_STATUS.CALLING&&this._tuiCallEngine.isInviter()&&(o=this._tuiCallEngine.generateEventData(),this._tuiCallEngine._delegate.onCallBegin(o)),this._tuiCallEngine.isInviter()&&this._tuiCallEngine.changeCallStatus(c.CALL_STATUS.CONNECTED),this._tuiCallEngine._delegate.onUserAccept(n),this._tuiCallEngine.addHandledInviteeList([n]),this._tuiCallEngine.deleteUnHandledInviteeList([n]),this._tuiCallEngine.addAcceptedUserList(r,[n]),[2]}}))}))},e.prototype.onInviteeRejected=function(e){var t;return r(this,void 0,void 0,(function(){var n,r,s,o,l,_,f,E,I,g,v,C,T;return a(this,(function(a){switch(a.label){case 0:return u.default.log(d+".onInviteeRejected - params:",e),n=e.data.inviteID,r=JSON.parse(e.data.data),p.isCallSignaling(null==r?void 0:r.businessID)?this._tuiCallEngine.isGroupCall()||this._tuiCallEngine.getSwitchCallModeStatus()||-1===this._tuiCallEngine.getAudioVideoSwitchIdList().indexOf(n)?(s=e.data.invitee,o=e.data.inviter,l=this._tuiCallEngine.getUserID(),(_=this._tuiCallEngine.getCallStatus())===c.CALL_STATUS.IDLE?[2]:-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(n)?(this._tuiCallEngine.deleteUnHandledInviteeList([s]),[2]):(f=this._tuiCallEngine.generateEventData(),E=i({userID:s},f),l!==s||_!==c.CALL_STATUS.CALLING?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()])):(u.default.log(d+".onInviteeRejected - Audio and video switching is not available"),this._tuiCallEngine.setSwitchCallModeStatus(!0),[2]):[2];case 1:return a.sent(),this._tuiCallEngine._delegate.onCallingCancel(E),[2];case 2:return I=this._tuiCallEngine.isGroupCall(),g=this._tuiCallEngine.isInviter(),this._tuiCallEngine.deleteUnHandledInviteeList([s]),v=this._tuiCallEngine.getUnHandledInviteeList(),C=this._tuiCallEngine.getHandledInviteeList(),_===c.CALL_STATUS.CONNECTED&&-1!==C.indexOf(s)?[2]:"line_busy"===r.line_busy||""===r.line_busy||(null===(t=null==r?void 0:r.data)||void 0===t?void 0:t.message)&&"lineBusy"===r.data.message?I?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,7];case 3:return a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({},E),{reason:h.NAME.BUSYLINE})),[3,6];case 4:return 0!==v.length||1!==C.length?[3,6]:[4,this._tuiCallEngine._resetTUICallEngine()];case 5:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({},E),{reason:h.NAME.BUSYLINE})),a.label=6;case 6:return o===this._tuiCallEngine.getInviterID()&&this._tuiCallEngine._delegate.onLineBusy(s),[3,18];case 7:return I?[3,9]:[4,this._tuiCallEngine._resetTUICallEngine()];case 8:return a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({},E),{reason:h.NAME.REJECT})),this._tuiCallEngine._delegate.onReject(s),[3,18];case 9:return _!==c.CALL_STATUS.CALLING?[3,15]:g?0!==v.length||1!==C.length?[3,11]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,12];case 10:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({},E),{reason:h.NAME.REJECT})),a.label=11;case 11:return[3,14];case 12:return 1!==v.length||0!==C.length?[3,14]:[4,this._tuiCallEngine._resetTUICallEngine()];case 13:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({},E),{reason:h.NAME.REJECT})),a.label=14;case 14:return[3,17];case 15:return 0!==v.length||1!==C.length?[3,17]:(T=this._tuiCallEngine.generateCallEndData({userId:s}),[4,this._tuiCallEngine._resetTUICallEngine()]);case 16:a.sent(),this._tuiCallEngine._delegate.onCallEnd(T),a.label=17;case 17:this._tuiCallEngine._delegate.onReject(s),a.label=18;case 18:return[2]}}))}))},e.prototype.onInvitationCancelled=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(r){switch(r.label){case 0:return u.default.log(d+".onInvitationCancelled - params:",e,this._tuiCallEngine.getCallStatus()),t=JSON.parse(e.data.data),p.isCallSignaling(null==t?void 0:t.businessID)?this._tuiCallEngine.getCallStatus()===c.CALL_STATUS.IDLE||-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(e.data.inviteID)?[2]:(n=this._tuiCallEngine.generateEventData(),[4,this._tuiCallEngine._resetTUICallEngine()]):[2];case 1:return r.sent(),this._tuiCallEngine._delegate.onCallingCancel(i(i({userID:this._tuiCallEngine.getUserID()},n),{reason:h.NAME.NORMAL})),[2]}}))}))},e.prototype.onInvitationTimeout=function(e){var t;return r(this,void 0,void 0,(function(){var n,r,s,o,l,p,_,f,E,I,g,v,C,T,m;return a(this,(function(a){switch(a.label){case 0:return n=e.data,r=n.inviter,s=n.inviteeList,o=void 0===s?[]:s,l=n.inviteID,p=this._tuiCallEngine.getUserID(),_=this._tuiCallEngine.isGroupCall(),f=this._tuiCallEngine.isInviter(),E=this._tuiCallEngine.getCallStatus(),this._tuiCallEngine.deleteUnHandledInviteeList(o),u.default.log(d+".onInvitationTimeout - params:",e,"currentUserID:"+p+" isInviter:"+f+" isGroupCall:"+_+" currentCallStatus:"+E+" inviteID:"+(null===(t=null==this?void 0:this._newInvitationData)||void 0===t?void 0:t.inviteID)),-1===this._tuiCallEngine.getInviterInviteIdList().indexOf(l)?[2]:E===c.CALL_STATUS.IDLE?[2]:(I=this._tuiCallEngine.getHandledInviteeList(),g=this._tuiCallEngine.getUnHandledInviteeList(),v=i(i({},this._tuiCallEngine.generateEventData()),{reason:h.NAME.TIMEOUT}),_?[3,2]:[4,this._tuiCallEngine._resetTUICallEngine()]);case 1:return a.sent(),f?(this._tuiCallEngine._delegate.onCallingCancel(i({userID:o[0]},v)),this._tuiCallEngine._delegate.onNoResp(r,o)):(this._tuiCallEngine._delegate.onCallingCancel(i({userID:o[0]||""},v)),C=this._tuiCallEngine.getCallRecordReport().getCallRecordData().head,this._tuiCallEngine.getCallRecordReport().eventUpload(i(i({},C),{eventType:h.NAME.NOT_ANSWER_CALL,inviteID:this._tuiCallEngine.getInitialCallId()}))),[3,12];case 2:return E!==c.CALL_STATUS.CALLING?[3,10]:f?0!==g.length?[3,4]:[4,this._tuiCallEngine._resetTUICallEngine()]:[3,5];case 3:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i({userID:o.join(",")},v)),a.label=4;case 4:return this._tuiCallEngine._delegate.onNoResp(r,o),[3,9];case 5:return-1!==o.indexOf(p)?[3,6]:(this._tuiCallEngine._delegate.onNoResp(r,o),[3,8]);case 6:return[4,this._tuiCallEngine._resetTUICallEngine()];case 7:a.sent(),this._tuiCallEngine._delegate.onCallingCancel(i({userID:p},v)),a.label=8;case 8:T=this._tuiCallEngine.getCallRecordReport().getCallRecordData().head,this._tuiCallEngine.getCallRecordReport().eventUpload(i(i({},T),{eventType:h.NAME.NOT_ANSWER_CALL,inviteID:this._tuiCallEngine.getInitialCallId()})),a.label=9;case 9:return[3,12];case 10:return this._tuiCallEngine._delegate.onNoResp(r,o),1!==I.length||0!==g.length?[3,12]:(m=this._tuiCallEngine.generateCallEndData(),[4,this._tuiCallEngine._resetTUICallEngine()]);case 11:a.sent(),this._tuiCallEngine._delegate.onCallEnd(m),a.label=12;case 12:return[2]}}))}))},e.prototype.onKickedOut=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return u.default.log(d+".onKickedOut"),this._tuiCallEngine.setIsLogin(!1),this._tuiCallEngine._trtcClient.removeTRTCEvents(),[4,this._tuiCallEngine._resetTUICallEngine()];case 1:return e.sent(),this._tuiCallEngine._delegate.onKickedOut(),[2]}}))}))},e.prototype.onNetStateChange=function(){u.default.debug(d+".onNetStateChange")},e.prototype.onMessageSentByMe=function(e){this._tuiCallEngine._delegate.onMessageSentByMe(e)},e.prototype.login=function(e){return r(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,new Promise((function(n,i){t._chat.isReady()?n():t._chat.login(e).then((function(e){var i;if(null===(i=e.data)||void 0===i?void 0:i.repeatLogin)return u.default.warn(d+".login - success: The TIM login status has been inherited into Call. IM 登录状态已成功被 Call 继承。"),void n();t._resolveMap.set("login",{resolve:n,value:e})})).catch((function(e){i(e)}))}))]}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return a(this,(function(e){return this._joined=!1,[2,this._chat.logout()]}))}))},e.prototype.invite=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,l,u,c,d;return a(this,(function(a){switch(a.label){case 0:return t=e.userID,n=e.type,r=e.roomID,s=e.timeout,o=e.offlinePushInfo,l=e.userIDList,u=e.userData,c=void 0===u?"":u,[4,this._chat.invite({userID:t,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:n,room_id:r},{userIDs:l},c)),timeout:s,offlinePushInfo:o})];case 1:return d=a.sent(),[2,i(i({},d),{roomID:r,userID:t})]}}))}))},e.prototype.inviteInGroup=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,o,l,u,c,d,h,p,_;return a(this,(function(a){switch(a.label){case 0:return t=e.groupID,n=e.userIDList,r=e.roomID,s=e.type,o=e.timeout,l=e.offlinePushInfo,u=e.inCallUserIDs,c=e.userData,d=void 0===c?"":c,h=e.initialCallId,p=void 0===h?"":h,[4,this._chat.inviteInGroup({groupID:t,inviteeList:n,data:JSON.stringify(this.handleNewSignaling({version:0,call_type:s,room_id:r,inCallUserIDs:u},{initialCallId:p},d)),timeout:o,offlinePushInfo:l})];case 1:return _=a.sent(),[2,i(i({},_),{roomID:r,groupID:t})]}}))}))},e.prototype.hangup=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,s,o,l,h;return a(this,(function(a){switch(a.label){case 0:return u.default.log(d+".hangup - params:",e),t=e.userIDList,n=e.callType,i=e.callEnd,s={version:0,call_type:n,call_end:r=void 0===i?0:i},o={cmd:c.CMD_TYPE.HANG_UP},l=JSON.stringify(this.handleNewSignaling(s,o)),this._tuiCallEngine.isGroupCall()&&this._tuiCallEngine.getGroupID()?[4,this._chat.inviteInGroup({inviteeList:t,groupID:this._tuiCallEngine.getGroupID(),data:l,timeout:0})]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,this._chat.invite({userID:t[0],data:l,timeout:0})];case 3:a.sent(),a.label=4;case 4:return this._joined=!1,h=this._tuiCallEngine.generateCallEndData({callMediaType:n,totalTime:r}),this._tuiCallEngine._delegate.onCallEnd(h),[2]}}))}))},e.prototype.accept=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o;return a(this,(function(a){switch(a.label){case 0:return n=e.inviteID,r=e.callType,o=s(e,["inviteID","callType"]),[4,this._chat.accept({inviteID:n,data:JSON.stringify(this.handleNewSignaling(i({version:0,call_type:r},o),t))})];case 1:return[2,a.sent()]}}))}))},e.prototype.reject=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r;return a(this,(function(a){return t=e.inviteID,n=e.callType,i=e.isBusy,r={version:0,call_type:n},i&&(r.line_busy="line_busy"),[2,this._chat.reject({inviteID:t,data:JSON.stringify(this.handleNewSignaling(r,{message:i?"lineBusy":""}))})]}))}))},e.prototype.cancel=function(e){return r(this,void 0,void 0,(function(){var t,n;return a(this,(function(i){return t=e.inviteID,n=JSON.stringify(this.handleNewSignaling({version:4,businessID:h.NAME.AV_CALL,call_type:this._tuiCallEngine.getCallType()})),[2,this._chat.cancel({inviteID:t,data:n})]}))}))},e.prototype.resetJoined=function(){this._joined=!1},e.prototype.switchCallMode=function(e){return r(this,void 0,void 0,(function(){var t,n,i,r,s,o,l,u;return a(this,(function(a){switch(a.label){case 0:return t=e.userID,n=e.callType,i=e.roomID,r=e.timeout,s=e.mode,o={version:0,call_type:n,room_id:i,switch_to_audio_call:null},l={cmd:c.CMD_TYPE.SWITCH_TO_VIDEO},s===c.MODE_TYPE.AUDIO?(o.switch_to_audio_call=c.CMD_TYPE.SWITCH_TO_AUDIO_CALL,l.cmd=c.CMD_TYPE.SWITCH_TO_AUDIO):delete o.switch_to_audio_call,[4,this._chat.invite({userID:t,data:JSON.stringify(this.handleNewSignaling(o,l)),timeout:r})];case 1:return(u=a.sent()).inviteID&&this._tuiCallEngine.addAudioVideoSwitchIdList(u.inviteID),[2]}}))}))},e.prototype.handleNewSignaling=function(e,t,n){return i(i({extInfo:n||""},e),{version:4,businessID:h.NAME.AV_CALL,platform:"Web",data:i({cmd:c.CMD_TYPE_LIST[e.call_type],room_id:e.room_id,message:""},t)})},e}();t.default=_},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(12),a=n(2),s=n(10),o=n(11),l=n(13),u="TUICallObserver",c=function(){function e(e){this._eventEmitter=e,this._eventStatController=new l.default,s.default.bindController(this._eventStatController)}return e.prototype._setInterfaceUpLoad=function(e){return a.default.time(e),new s.default(e)},e.prototype.onError=function(e,t){a.default.debug(u+".onError code:"+e+" msg:"+t),this._eventEmitter.emit(r.TUICallEvent.ERROR,{code:e,msg:t}),this._setInterfaceUpLoad(o.default.ERROR).setText("").setEnd()},e.prototype.onSdkReady=function(e){a.default.debug(u+".onSdkReady params:"+e),this._eventEmitter.emit(r.TUICallEvent.SDK_READY,e),this._setInterfaceUpLoad(o.default.SDK_READY).setText("").setEnd()},e.prototype.onInvited=function(e){a.default.debug(u+".onInvited params:",e);var t=e.sponsor,n=e.userIDList,s=e.isFromGroup,l=e.inviteData,c=e.inviteID,d=e.userData,h=void 0===d?"":d,p=e.calleeIdList,_=e.callID,f=e.roomID,E=e.callMediaType,I=e.callRole,g={callID:_,calleeIdList:p,groupID:e.groupID,callMediaType:E,roomID:f,callRole:I,userData:h},v=i({sponsor:t,userIDList:n,isFromGroup:s,inviteData:l,inviteID:c},g);this._eventEmitter.emit(r.TUICallEvent.INVITED,v),this._eventEmitter.emit(r.TUICallEvent.ON_CALL_RECEIVED,g),this._setInterfaceUpLoad(o.default.INVITED).setText("TUICallEvent.INVITED emitted").setEnd()},e.prototype.onUserAccept=function(e){a.default.debug(u+".onUserAccept userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ACCEPT,{userID:e})},e.prototype.onCallBegin=function(e){a.default.debug(u+".onCallBegin params:"+JSON.stringify(e)),this._eventEmitter.emit(r.TUICallEvent.ON_CALL_BEGIN,e)},e.prototype.onUserEnter=function(e){a.default.debug(u+".onUserEnter userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_ENTER,{userID:e}),this._setInterfaceUpLoad(o.default.USER_ENTER).setText("TUICallEvent.USER_ENTER emitted").setEnd()},e.prototype.onUserLeave=function(e){a.default.debug(u+".onUserLeave userID:"+e),this._eventEmitter.emit(r.TUICallEvent.USER_LEAVE,{userID:e}),this._setInterfaceUpLoad(o.default.USER_LEAVE).setText("TUICallEvent.USER_LEAVE emitted").setEnd()},e.prototype.onReject=function(e){a.default.debug(u+".onReject userID:"+e),this._eventEmitter.emit(r.TUICallEvent.REJECT,{userID:e}),this._setInterfaceUpLoad(o.default.REJECT).setText("TUICallEvent.REJECT emitted").setEnd()},e.prototype.onNoResp=function(e,t){a.default.debug(u+".onNoResp userIDList:",e,t),this._eventEmitter.emit(r.TUICallEvent.NO_RESP,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(o.default.NO_RESP).setText("TUICallEvent.NO_RESP emitted").setEnd()},e.prototype.onLineBusy=function(e){a.default.debug(u+".onLineBusy userID:"+e),this._eventEmitter.emit(r.TUICallEvent.LINE_BUSY,{userID:e}),this._setInterfaceUpLoad(o.default.LINE_BUSY).setText("TUICallEvent.LINE_BUSY emitted").setEnd()},e.prototype.onCallingCancel=function(e,t){void 0===t&&(t=""),a.default.debug(u+".onCallingCancel ",e),this._eventEmitter.emit(r.TUICallEvent.CALLING_CANCEL,e),this._eventEmitter.emit(r.TUICallEvent.ON_CALL_CANCELED,e),this._setInterfaceUpLoad(o.default.CALLING_CANCEL).setText("TUICallEvent.CALLING_CANCEL emitted").setEnd()},e.prototype.onKickedOut=function(){a.default.debug(u+".onKickedOut"),this._eventEmitter.emit(r.TUICallEvent.KICKED_OUT,{}),this._setInterfaceUpLoad(o.default.KICKED_OUT).setText("TUICallEvent.KICKED_OUT emitted").setEnd()},e.prototype.onCallingTimeout=function(e,t){a.default.debug(u+".onCallingTimeout userIDList:",t),this._eventEmitter.emit(r.TUICallEvent.CALLING_TIMEOUT,{sponsor:e,userIDList:t}),this._setInterfaceUpLoad(o.default.CALLING_TIMEOUT).setText("TUICallEvent.CALLING_TIMEOUT emitted").setEnd()},e.prototype.onCallEnd=function(e){a.default.debug(u+".onCallEnd params:"+e),this._eventEmitter.emit(r.TUICallEvent.CALLING_END,i(i({},e),{callEnd:e.totalTime})),this._setInterfaceUpLoad(o.default.CALLING_END).setText("TUICallEvent.CALLING_END emitted").setEnd()},e.prototype.onUserVideoAvailable=function(e){a.default.debug(u+".onUserVideoAvailable params:",e);var t=e.userID,n=e.isVideoAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_VIDEO_AVAILABLE,{userID:t,isVideoAvailable:n});var i="TUICallEvent.USER_VIDEO_AVAILABLE emitted, userID: "+t+", video: "+n;this._setInterfaceUpLoad(o.default.USER_VIDEO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserAudioAvailable=function(e){a.default.debug(u+".onUserAudioAvailable params:",e);var t=e.userID,n=e.isAudioAvailable;this._eventEmitter.emit(r.TUICallEvent.USER_AUDIO_AVAILABLE,{userID:t,isAudioAvailable:n});var i="TUICallEvent.USER_AUDIO_AVAILABLE emitted, userID: "+t+", mic: "+n;this._setInterfaceUpLoad(o.default.USER_AUDIO_AVAILABLE).setText(i).setEnd()},e.prototype.onUserVoiceVolume=function(e){this._eventEmitter.emit(r.TUICallEvent.USER_VOICE_VOLUME,{volumeMap:e}),this._setInterfaceUpLoad(o.default.USER_VOICE_VOLUME).setText("TUICallEvent.USER_VOICE_VOLUME emitted").setEnd()},e.prototype.onGroupCallInviteeListUpdate=function(e){this._eventEmitter.emit(r.TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE,{userIDList:e}),this._setInterfaceUpLoad(o.default.GROUP_CALL_INVITEE_LIST_UPDATE).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onCallTypeChanged=function(e,t){this._eventEmitter.emit(r.TUICallEvent.CALL_TYPE_CHANGED,{oldCallType:e,newCallType:t}),this._setInterfaceUpLoad(o.default.CALL_TYPE_CHANGED).setText("TUICallEvent.CALL_TYPE_CHANGED "+t).setEnd()},e.prototype.onDeviceUpdated=function(e,t,n,i){this._eventEmitter.emit(r.TUICallEvent.DEVICED_UPDATED,{microphoneList:e,cameraList:t,currentMicrophone:n,currentCamera:i}),this._setInterfaceUpLoad(o.default.DEVICED_UPDATED).setText("TUICallEvent.GROUP_CALL_INVITEE_LIST_UPDATE emitted").setEnd()},e.prototype.onMessageSentByMe=function(e){this._eventEmitter.emit(r.TUICallEvent.MESSAGE_SENT_BY_ME,e)},e}();t.default=c},function(e,t,n){"use strict";n.r(t);var i=n(2);const r="none",a="online",s=function(){let e=window.location.protocol;return["http:","https:"].indexOf(e)<0&&(e="http:"),e};t.default=class{constructor(){this._networkType="",this.maxWaitTime=3e3}start(){this._networkType=a}_onNetworkStatusChange(e){this._networkType=e.networkType,e.isConnected?i.default.info("NetMonitor networkType:"+e.networkType):i.default.warn("NetMonitor no network, please check!")}probe(){return new Promise(e=>{if(window&&window.fetch)fetch(`${s()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`).then(t=>{t.ok?e([!0,a]):e([!1,r])}).catch(()=>{e([!1,r])});else{const t=new XMLHttpRequest,n=setTimeout(()=>{i.default.warn("NetMonitor fetch timeout. Probably no network, please check!"),t.abort(),this._networkType=r,e([!1,r])},this.maxWaitTime);t.onreadystatechange=function(){4===t.readyState&&(clearTimeout(n),200===t.status||304===t.status?(this._networkType=a,e([!0,a])):(i.default.warn(`NetMonitor fetch status:${t.status}. Probably no network, please check!`),this._networkType=r,e([!1,r])))},t.open("GET",`${s()}//webim-1252463788.file.myqcloud.com/assets/test/speed.xml?random=${Math.random()}`),t.send()}})}getNetworkType(){return this._networkType}reset(){this._networkType=""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=t.avoidRepeatedCall=t.statusValidate=t.deviceValidate=t.businessValidate=t.paramValidate=t.VALIDATE_PARAMS=void 0;var i=n(61);Object.defineProperty(t,"VALIDATE_PARAMS",{enumerable:!0,get:function(){return i.VALIDATE_PARAMS}});var r=n(62);Object.defineProperty(t,"paramValidate",{enumerable:!0,get:function(){return r.paramValidate}});var a=n(26);Object.defineProperty(t,"businessValidate",{enumerable:!0,get:function(){return a.businessValidate}});var s=n(63);Object.defineProperty(t,"deviceValidate",{enumerable:!0,get:function(){return s.deviceValidate}});var o=n(64);Object.defineProperty(t,"statusValidate",{enumerable:!0,get:function(){return o.statusValidate}});var l=n(65);Object.defineProperty(t,"avoidRepeatedCall",{enumerable:!0,get:function(){return l.avoidRepeatedCall}});var u=n(66);Object.defineProperty(t,"apiCallQueue",{enumerable:!0,get:function(){return u.apiCallQueue}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VALIDATE_PARAMS=void 0;var i=n(14),r=n(0);t.VALIDATE_PARAMS={createInstance:{SDKAppID:{required:!0,rules:[r.NAME.NUMBER],allowEmpty:!1},tim:{required:!1,rules:[r.NAME.OBJECT],allowEmpty:!0}},login:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},userSig:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},call:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},roomID:{required:!1,rules:[r.NAME.NUMBER],range:"1~"+r.MAX_NUMBER_ROOM_ID,allowEmpty:!1},timeout:{required:!1,rules:[r.NAME.NUMBER],allowEmpty:!1}},groupCall:{userIDList:{required:!0,rules:[r.NAME.ARRAY],allowEmpty:!1},type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},roomID:{required:!1,rules:[r.NAME.NUMBER],range:"1~"+r.MAX_NUMBER_ROOM_ID,allowEmpty:!1},timeout:{required:!1,rules:[r.NAME.NUMBER],allowEmpty:!1}},joinInGroupCall:{type:{required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1},groupID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},roomID:{required:!0,rules:[r.NAME.NUMBER],allowEmpty:!1}},inviteUser:{userIDList:{required:!0,rules:[r.NAME.ARRAY],allowEmpty:!1}},startRemoteView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},stopRemoteView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},startLocalView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},videoViewDomID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},stopLocalView:{userID:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},switchDevice:{deviceType:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1},deviceId:{required:!0,rules:[r.NAME.STRING],allowEmpty:!1}},setVideoQuality:[{key:"profile",required:!0,rules:[r.NAME.STRING,r.NAME.OBJECT],range:Object.keys(i.TUICommonDefine.VideoEncoderParams),allowEmpty:!1}],switchCallMediaType:[{key:"newMediaType",required:!0,rules:[r.NAME.NUMBER],range:[1,2],allowEmpty:!1}],getDeviceList:[{key:"deviceType",required:!0,rules:[r.NAME.STRING],range:["camera","microphones"],allowEmpty:!1}],setSelfInfo:{nickName:{required:!1,rules:[r.NAME.STRING],allowEmpty:!1},avatar:{required:!1,rules:[r.NAME.STRING],allowEmpty:!1}},setVideoRenderParams:{objectFit:{require:!1,rules:[r.NAME.STRING],range:[r.NAME.CONTAIN,r.NAME.COVER,r.NAME.FILL],allowEmpty:!1},muted:{require:!1,rules:[r.NAME.BOOLEAN],allowEmpty:!1},mirror:{require:!1,rules:[r.NAME.BOOLEAN],allowEmpty:!1}}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.paramValidate=void 0;var r=n(1),a=n(9),s=n(4);function o(e,t,n){try{if(r.isArray(e))for(var a=0;a<e.length;a++)l.call(this,i(i({},e[a]),{value:t[a],name:n}));else for(var s in e)l.call(this,i(i({},e[s]),{value:t[0][s],name:n,key:s}))}catch(e){throw e}}function l(e){var t=e.required,n=e.rules,i=e.range,o=e.value,l=e.allowEmpty,u=e.name,c=e.key;if(r.isUndefined(o)){if(t)throw new a.default({message:"API<"+u+">: "+c+" is required.",code:s.default.ERROR_PARAM_INVALID})}else{var d="";if(!n.some((function(e){return e===r.getType(o)}))){for(var h=0;h<n.length;h++){var p=n[h];d+=(p=p.replace(p[0],p[0].toUpperCase()))+"/"}throw d=d.substring(0,d.length-1),new a.default({message:"API<"+u+">: "+c+" must be "+d+", current "+c+" is "+typeof o+".",code:s.default.ERROR_PARAM_INVALID})}if(!1===l)if(r.isString(o)&&""===o.trim())throw new a.default({message:"API<"+u+">: "+c+" is blank.",code:s.default.ERROR_PARAM_INVALID});if(r.isArray(i)&&i&&-1===i.indexOf(o))throw new a.default({message:"API<"+u+">: "+c+" error, only be "+i+", current "+c+" is "+o+".",code:s.default.ERROR_PARAM_INVALID});if(r.isString(i)&&-1!==i.indexOf("~")){var _=i.split("~");if(o<+_[0]||o>+_[1]||r.isNumber(o)&&Number.isNaN(o))throw new a.default({message:"API<"+u+">: "+c+" error, only be "+i+", current "+c+" is "+o+".",code:s.default.ERROR_PARAM_INVALID})}}}t.paramValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return o.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.deviceValidate=void 0;var a=n(9),s=n(4),o=n(6);function l(e,t,n){return i(this,void 0,void 0,(function(){var i,l;return r(this,(function(r){switch(r.label){case 0:if(this._permission[n])return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._trtcClient.getMediaDevicesAuth((l={},l[n]=!0,l.isThrowVideoError=!0,l))];case 2:return r.sent(),[3,4];case 3:throw i=r.sent(),this._delegate.onError(s.default.NOT_MEDIA_ACCESS,JSON.stringify(i)),new a.default({message:"<doValidate>: "+o.ERROR_MESSAGE.ERROR_PERMISSION_DENIED,code:s.default.ERROR_PERMISSION_DENIED});case 4:return e.apply(this,t),[2]}}))}))}t.deviceValidate=function(e){return function(t,n,a){var s=a.value;return a.value=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return i(this,void 0,void 0,(function(){return r(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,l.call(this,s,t,e)];case 1:return[2,n.sent()];case 2:throw n.sent();case 3:return[2]}}))}))},a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.statusValidate=void 0;var i=n(9),r=n(4),a=n(6);function s(e,t,n){var s;if((null==e?void 0:e.init)&&!this._isLogin)throw new i.default({message:"API<"+n+">: "+a.ERROR_MESSAGE.ERROR_INIT_FAIL,code:r.default.ERROR_INIT_FAIL});if(-1===(null===(s=null==e?void 0:e.callStatus)||void 0===s?void 0:s.indexOf(this._callStatus)))throw new i.default({message:"API<"+n+">: "+a.ERROR_MESSAGE.ERROR_REQUEST_REFUSED+". support status: ["+e.callStatus.join(",")+"], current status: "+this._callStatus,code:r.default.ERROR_REQUEST_REFUSED});if((null==e?void 0:e.scene)&&this._isGroupCall)throw new i.default({message:"API<"+n+">: "+a.ERROR_MESSAGE.ERROR_SCENE_NOT_SUPPORTED,code:r.default.ERROR_SCENE_NOT_SUPPORTED})}t.statusValidate=function(e){return function(t,n,i){var r=i.value;return i.value=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return s.call(this,e,t,n),r.apply(this,t)},i}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.avoidRepeatedCall=void 0,t.avoidRepeatedCall=function(){return function(e,t,n){var a=n.value,s=new Set;return n.value=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return i(this,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:if(s.has(this))throw new Error("previous "+t+"() is ongoing, please avoid repeated calls");r.label=1;case 1:return r.trys.push([1,3,,4]),s.add(this),[4,a.apply(this,e)];case 2:return n=r.sent(),s.delete(this),[2,n];case 3:throw i=r.sent(),s.delete(this),i;case 4:return[2]}}))}))},n}}},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.apiCallQueue=void 0;var r=new WeakMap;t.apiCallQueue=function(){return function(e,t,n){var a=n.value,s=function(e){var t=e.fn,n=e.args,a=e.context,o=e.resolve,l=e.reject;t.apply(a,n).then(o,l).finally((function(){var e=r.get(a);e.shift(),e[0]&&s(i({},e[0]))}))};return n.value=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new Promise((function(n,i){if(r.has(e)){var o=r.get(e),l=o.length;o.push({fn:a,args:t,context:e,resolve:n,reject:i}),0===l&&s({fn:a,args:t,context:e,resolve:n,reject:i})}else r.set(e,[{fn:a,args:t,context:e,resolve:n,reject:i}]),s({fn:a,args:t,context:e,resolve:n,reject:i})}))},n}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEngineObserver=t.CallDataReport=void 0;var i=n(5),r=n(12),a=n(10),s=n(11),o=n(13),l=n(0),u=n(68),c=n(1),d=n(28),h=function(){function e(e){this._eventStatController=new o.default,a.default.bindController(this._eventStatController),this.initializeCallData(e),this._ssoLog=new a.default(s.default.QUALITY_REPORT)}return e.prototype.setCallData=function(e){this._callData=e},e.prototype.getCallData=function(){return this._callData},e.prototype.setInviteID=function(e){this._callData.inviteID=e},e.prototype.setTotalTime=function(e){this._callData.totalTime=e},e.prototype.setAbilityBit=function(e){this._callData.abilityBit=!!e},e.prototype.setEnterRoomTime=function(e){this._callData.enterRoomTime=u.convertTimeStampToString(e)},e.prototype.setSendSignalingTime=function(e){this._callData.sendSignalingTime=u.convertTimeStampToString(e)},e.prototype.setCallAcceptTime=function(e){this._callData.callAcceptTime=u.convertTimeStampToString(e)},e.prototype.setExitRoomTime=function(e){this._callData.exitRoomTime=u.convertTimeStampToString(e)},e.prototype.setCallEndTime=function(e){this._callData.callEndTime=e},e.prototype.setCodeAndMessage=function(e,t){this._callData.code=e||0,this._callData.message=t||""},e.prototype.setCallScene=function(e){this._callData.callScene=e||""},e.prototype.getResult=function(){return this._callData.result},e.prototype.setResult=function(e){this._callData.result=e||""},e.prototype.setUserID=function(e){this._callData.userID=e||""},e.prototype.packageCallDataToKibana=function(){var e=d.callTypeMapping(this._callData.callType),t=d.callRoleMapping(this._callData.callRole);return"CallData{version='"+this._callData.version+", platform="+this._callData.platform+", framework="+this._callData.framework+", sdk_app_id="+this._callData.sdkAppId+", user_id="+this._callData.userID+", room_id="+this._callData.roomID+", invite_id="+this._callData.inviteID+", invitee_list="+this._callData.inviteeList+", media_type="+e+", role="+t+", call_scene="+this._callData.callScene+", result="+this._callData.result+", total_time="+this._callData.totalTime+", total_score="+this._callData.totalScore+", ability_bit="+this._callData.abilityBit+", enter_room="+this._callData.enterRoomTime+", send_signaling="+this._callData.sendSignalingTime+", call_accept="+this._callData.callAcceptTime+", exit_room="+this._callData.exitRoomTime+", call_end="+this._callData.callEndTime+", code="+this._callData.code+", message="+this._callData.message+", network="+this._callData.network+", audio="+this._callData.audio+", video="+this._callData.video+"}"},e.prototype.initializeCallData=function(e){var t=e||{},n=t.version,r=void 0===n?"":n,a=t.sdkAppId,s=void 0===a?0:a,o=t.userID,u=void 0===o?"":o,d=c.getHostType();this._callData={version:r,platform:d,framework:l.NAME.WEB,sdkAppId:s,userID:u,roomID:0,inviteID:"",callRole:i.CALL_ROLE.UNKNOWN,callScene:"",callType:i.CALL_TYPE.UNKNOWN,inviteeList:[],result:l.NAME.UNKNOWN,totalTime:0,totalScore:0,code:0,message:"",abilityBit:!1,enterRoomTime:"",sendSignalingTime:"",callAcceptTime:"",exitRoomTime:"",callEndTime:"",network:0,audio:0,video:0}},e.prototype.reset=function(){this.initializeCallData(),this._ssoLog=null},e.prototype.clearCallDataAfterUpload=function(){var e=this.getCallData(),t=e.version,n=e.sdkAppId,i=e.userID;this.initializeCallData({version:t,sdkAppId:n,userID:i})},e.prototype.uploadToKibana=function(){try{this._ssoLog.setText(this.packageCallDataToKibana()).setEnd(),this.clearCallDataAfterUpload()}catch(e){}},e}();t.CallDataReport=h;var p=function(){function e(e,t){this._eventEmitter=e,this._callDataReport=t,this.registerListener()}return e.prototype.registerListener=function(){this._eventEmitter.on(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.on(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.removeLister=function(){this._eventEmitter.off(r.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.off(r.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.off(r.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.off(r.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.off(r.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.onCallEnd=function(e){var t=e.totalTime,n=void 0===t?0:t;this._callDataReport.setTotalTime(n),this._callDataReport.setResult(l.NAME.NORMAL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onCallingCancel=function(){this._callDataReport.getResult()||this._callDataReport.setResult(l.NAME.CANCEL),this._callDataReport.setCodeAndMessage(),this._callDataReport.uploadToKibana()},e.prototype.onNoResponse=function(){this._callDataReport.setResult(l.NAME.TIMEOUT)},e.prototype.onLineBusy=function(){this._callDataReport.setResult(l.NAME.BUSYLINE)},e.prototype.onReject=function(){this._callDataReport.setResult(l.NAME.REJECT)},e}();t.TUICallEngineObserver=p},function(e,t,n){"use strict";n.r(t),n.d(t,"setBaseTime",(function(){return l})),n.d(t,"getCurrentTime",(function(){return u})),n.d(t,"getTimestamp",(function(){return c})),n.d(t,"convertTimeStampToString",(function(){return d}));var i=n(2),r=n(30),a=n.n(r);let s=(new Date).getTime(),o=0;const l=function(e){s=e,o=s-(new Date).getTime();const t=new Date;t.setTime(e),i.default.info("baseTime from server: "+t+" offset: "+o)},u=function(){return(new Date).getTime()+o},c=function(){const e=new Date;return e.setTime(u()),e.toLocaleString()},d=e=>e<=0?"":a()(e).format("YYYY-MM-DD HH:mm:ss")},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,o)}l((i=i.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,i,r,a,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.TUICallEngineRecordObserver=t.CallRecordReport=void 0;var s=n(5),o=n(12),l=n(0),u=n(2),c=n(70),d=n(7),h=n(28),p={serviceCommand:l.NAME.CALLKIT_RECORDS_SVR+".*"},_=function(){function e(e){this._tim=e.tim,this._heartbeat=-1,this._lastHeartBeatTime=-1,this.initializeCallData(e)}return e.prototype.getCallRecordData=function(){return this._callRecordData},e.prototype.initializeCallData=function(e){var t=e||{},n=t.version,i=void 0===n?"":n,r=t.userID,a=void 0===r?"":r,o=d.getOsInfo().name,u={version:1,command:l.NAME.EVENT_REPORT,sdk_version:i,seq:0,os_name:l.NAME.WEB,os_version:"0.0",device_name:o,framework:l.NAME.WEB,call_type:"",media_type:"",client_ts:0,role:s.CALL_ROLE.UNKNOWN,user_id:a,room_id:"",call_id:""};this._callRecordData={head:u,body:{event_type:"",code:0,message:"",invitee_list:[]}}},e.prototype.reset=function(){this.initializeCallData()},e.prototype._setCallType=function(e){e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{call_type:e}))},e.prototype._setMediaType=function(e){e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{media_type:h.callTypeMapping(e)}))},e.prototype._setCallRole=function(e){e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{role:e}))},e.prototype._setUserID=function(e){e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{user_id:e}))},e.prototype._setRoomID=function(e){e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{room_id:""+e}))},e.prototype._setInviteID=function(e){void 0===e&&(e=""),e&&(this._callRecordData.head=i(i({},this._callRecordData.head),{call_id:e}))},e.prototype._setEventType=function(e){e&&(this._callRecordData.body=i(i({},this._callRecordData.body),{event_type:e}))},e.prototype._setInviteeList=function(e){void 0===e&&(e=[]),this._callRecordData.body=i(i({},this._callRecordData.body),{invitee_list:e})},e.prototype._setSeq=function(){var e=this.getCallRecordData().head.seq;this._callRecordData.head=i(i({},this._callRecordData.head),{seq:e+1})},e.prototype.eventUpload=function(e){var t;return r(this,void 0,void 0,(function(){var n,r,s,o,u,c,d,_,f,E,I,g,v,C,T;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.eventType,r=e.callType,s=e.mediaType,o=e.callRole,u=e.userID,c=e.roomID,d=e.inviteID,_=e.inviteeList,f=void 0===_?[]:_,n?(this._callRecordData.head=i(i({},this._callRecordData.head),{command:l.NAME.EVENT_REPORT,client_ts:Math.floor(Date.now()/1e3)}),this._setCallType(r),this._setMediaType(s),this._setCallRole(o),this._setUserID(u),this._setRoomID(c),this._setInviteID(d),this._setEventType(n),this._setInviteeList(f),this._setSeq(),E=this.getCallRecordData(),I=E.head,g=E.body,v={head:i(i({},I),{role:h.callRoleMapping(I.role)}),body:g},C=i(i({},p),{data:JSON.stringify(v)}),[4,null===(t=null==this?void 0:this._tim)||void 0===t?void 0:t.callExperimentalAPI("sendTRTCCustomData",C)]):[2];case 1:return a.sent(),[3,3];case 2:return T=a.sent(),console.warn("eventUpload failed. error: "+JSON.stringify(T)),[3,3];case 3:return[2]}}))}))},e.prototype.eventUploadNotSave=function(e){var t;return r(this,void 0,void 0,(function(){var n,r,s,o,l,u,c,d,_,f,E,I;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),n=e.eventType,r=e.callType,s=e.mediaType,o=e.callRole,l=e.roomID,u=e.inviteID,this._setSeq(),c=this.getCallRecordData(),d=c.head,_=c.body,f={head:i(i({},d),{role:h.callRoleMapping(o),call_id:u,call_type:r,media_type:h.callTypeMapping(s),room_id:""+l,client_ts:Math.floor(Date.now()/1e3)}),body:i(i({},_),{event_type:n})},E=i(i({},p),{data:JSON.stringify(f)}),[4,null===(t=null==this?void 0:this._tim)||void 0===t?void 0:t.callExperimentalAPI("sendTRTCCustomData",E)];case 1:return a.sent(),[3,3];case 2:return I=a.sent(),console.warn("eventUploadNotSave failed. error: "+JSON.stringify(I)),[3,3];case 3:return[2]}}))}))},e.prototype.heartBeatUpload=function(){var e;return r(this,void 0,void 0,(function(){var t,n,r,s;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),this._setSeq(),t=this._callRecordData.head,n={head:i(i({},t),{role:h.callRoleMapping(t.role),clientTs:Date.now(),command:l.NAME.HEART_BEAT}),body:{status:l.NAME.CALLING}},r=i(i({},p),{data:n}),[4,null===(e=null==this?void 0:this._tim)||void 0===e?void 0:e.callExperimentalAPI("sendTRTCCustomData",r)];case 1:return a.sent(),[3,3];case 2:return s=a.sent(),console.warn("heartBeatUpload failed. error: "+JSON.stringify(s)),[3,3];case 3:return[2]}}))}))},e.prototype.startHeartbeat=function(){-1===this._heartbeat&&(u.default.info("start heart beat..."),this._heartbeat=c.default.run(l.NAME.TIMEOUT,this.doHeartbeat.bind(this),{delay:2e3,count:0,backgroundTask:!0}))},e.prototype.stopHeartbeat=function(){-1!==this._heartbeat&&(u.default.info("stop heart beat"),c.default.clearTask(this._heartbeat),this._heartbeat=-1,this._lastHeartBeatTime=-1)},e.prototype.doHeartbeat=function(){return r(this,void 0,void 0,(function(){var e;return a(this,(function(t){return this.heartBeatUpload(),e=Date.now(),this._lastHeartBeatTime>0&&e-this._lastHeartBeatTime>1e4&&u.default.warn("heartbeat took "+(e-this._lastHeartBeatTime)),this._lastHeartBeatTime=e,[2]}))}))},e}();t.CallRecordReport=_;var f=function(){function e(e,t){this._eventEmitter=e,this._callRecordDataReport=t,this._isCallAccepted=!1,this.registerListener()}return e.prototype.registerListener=function(){this._eventEmitter.on(o.TUICallEvent.USER_ACCEPT,this.onCallAccepted.bind(this)),this._eventEmitter.on(o.TUICallEvent.CALLING_END,this.onCallEnd.bind(this)),this._eventEmitter.on(o.TUICallEvent.CALLING_CANCEL,this.onCallingCancel.bind(this)),this._eventEmitter.on(o.TUICallEvent.NO_RESP,this.onNoResponse.bind(this)),this._eventEmitter.on(o.TUICallEvent.LINE_BUSY,this.onLineBusy.bind(this)),this._eventEmitter.on(o.TUICallEvent.REJECT,this.onReject.bind(this))},e.prototype.removeLister=function(){this._eventEmitter.off(o.TUICallEvent.USER_ACCEPT,this.onCallAccepted),this._eventEmitter.off(o.TUICallEvent.CALLING_END,this.onCallEnd),this._eventEmitter.off(o.TUICallEvent.CALLING_CANCEL,this.onCallingCancel),this._eventEmitter.off(o.TUICallEvent.NO_RESP,this.onNoResponse),this._eventEmitter.off(o.TUICallEvent.LINE_BUSY,this.onLineBusy),this._eventEmitter.off(o.TUICallEvent.REJECT,this.onReject)},e.prototype.onCallAccepted=function(){var e=this._callRecordDataReport.getCallRecordData().head;if((null==e?void 0:e.role)===l.NAME.INVITER){if(this._isCallAccepted&&e.call_type===l.NAME.GROUP)return;this._isCallAccepted=!0;var t={eventType:l.NAME.CALL_ACCEPTED};this._callRecordDataReport.eventUpload(t),this._callRecordDataReport.startHeartbeat()}},e.prototype.onCallEnd=function(){var e={eventType:l.NAME.CALL_END};this._isCallAccepted=!1,this._callRecordDataReport.eventUpload(e)},e.prototype.onCallingCancel=function(e){var t=this._callRecordDataReport.getCallRecordData().head,n=t.role===l.NAME.INVITER?l.NAME.CANCEL_CALL:l.NAME.CALL_CANCELED;this._isCallAccepted=!1;var i=(e||{}).reason;((void 0===i?"":i)===l.NAME.NORMAL||t.role===l.NAME.INVITER&&t.call_type===l.NAME.GROUP)&&this._callRecordDataReport.eventUpload({eventType:n})},e.prototype.onNoResponse=function(){this._uploadInC2C(l.NAME.TIMEOUT)},e.prototype.onLineBusy=function(){this._uploadInC2C(l.NAME.BUSYLINE)},e.prototype.onReject=function(){this._uploadInC2C(l.NAME.REJECT)},e.prototype._uploadInC2C=function(e){var t=this._callRecordDataReport.getCallRecordData().head;if((null==t?void 0:t.call_type)===l.NAME.SINGLE){var n="";switch(e){case l.NAME.TIMEOUT:n=t.role===l.NAME.INVITER?l.NAME.CALL_MISSED:l.NAME.NOT_ANSWER_CALL;break;case l.NAME.REJECT:n=t.role===l.NAME.INVITER&&l.NAME.CALL_REJECTED;break;case l.NAME.BUSYLINE:n=t.role===l.NAME.INVITER?l.NAME.CALL_BUSY:l.NAME.NOT_ANSWER_CALL;break;default:return}this._callRecordDataReport.eventUpload({eventType:n})}},e}();t.TUICallEngineRecordObserver=f},function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),a=n(0),s=null===window||void 0===window?void 0:window.cancelAnimationFrame,o=function(){function e(){}return e.generateTaskID=function(){return this.currentTaskID++},e.run=function(e,t,n){void 0===e&&(e=a.NAME.TIMEOUT),n=e===a.NAME.INTERVAL?i({delay:2e3,count:0,backgroundTask:!0},n):e===a.NAME.RAF?i({fps:60,delay:16.6,count:0,backgroundTask:!0},n):i({delay:2e3,count:0,backgroundTask:!0},n),r.isObject(t)&&(n=i(i({},n),t)),r.isFunction(e)&&(t=e,e=a.NAME.TIMEOUT);var s=i({taskID:this.generateTaskID(),loopCount:0,intervalID:null,timeoutID:null,rafID:null,taskName:e,callback:t},n);return this.taskMap.set(s.taskID,s),this[e](s),s.taskID},e.interval=function(e){var t=this;return e.intervalID=setInterval((function(){e.callback(),e.loopCount+=1,t.isBreakLoop(e)}),e.delay)},e.timeout=function(e){var t=this,n=function(){if(e.callback(),e.loopCount+=1,!t.isBreakLoop(e))return e.timeoutID=setTimeout(n,e.delay)};return e.timeoutID=setTimeout(n,e.delay)},e.raf=function(e){var t=this;e.delay=(1e3/e.fps).toFixed(2);var n,i=r.performanceNow(),a=function(){if(document.hidden&&e.backgroundTask){if(n=r.performanceNow()-i,i=r.performanceNow(),e.callback(),e.loopCount+=1,t.isBreakLoop(e))return;return e.timeoutID=setTimeout(a,e.delay-Math.floor(n%e.delay))}if((n=r.performanceNow()-i)>=e.delay&&(i=r.performanceNow()-Math.floor(n%e.delay),e.callback(),e.loopCount+=1),!t.isBreakLoop(e))return e.rafID=requestAnimationFrame(a)};if(e.rafID=requestAnimationFrame(a),e.backgroundTask){var s=function(){if(document.hidden){var t=r.performanceNow()-i;t>=e.delay?a():e.timeoutID=setTimeout(a,e.delay-t)}};document.addEventListener("visibilitychange",s),e.onVisibilitychange=s,document.hidden&&s()}return e.taskID},e.hasTask=function(e){return this.taskMap.has(e)},e.clearTask=function(e){if(!this.taskMap.has(e))return!0;var t=this.taskMap.get(e),n=t.intervalID,i=t.timeoutID,r=t.rafID,a=t.onVisibilitychange;return n&&clearInterval(n),i&&clearTimeout(i),r&&s(r),a&&document.removeEventListener("visibilitychange",a),this.taskMap.delete(e),!0},e.isBreakLoop=function(e){return!this.taskMap.has(e.taskID)||0!==e.count&&e.loopCount>=e.count&&(this.clearTask(e.taskID),!0)},e.taskMap=new Map,e.currentTaskID=1,e}();t.default=o}]).default}));